/*! For license information please see background.js.LICENSE.txt */
(()=>{var e={1719:(e,t,i)=>{"use strict";const r=i(6561);class n extends Error{constructor(e,...t){let i;super(...t),Error.captureStackTrace&&Error.captureStackTrace(this,n),this.name="StatusError",this.message=e.statusMessage,this.statusCode=e.status,this.res=e,this.json=e.json.bind(e),this.text=e.text.bind(e),this.arrayBuffer=e.arrayBuffer.bind(e),Object.defineProperty(this,"responseBody",{get:()=>(i||(i=this.arrayBuffer()),i)}),this.headers={};for(const[t,i]of e.headers.entries())this.headers[t.toLowerCase()]=i}}e.exports=r(((e,t,i,r,s)=>async(o,a,c={})=>{o=s+(o||"");let p=new URL(o);if(r||(r={}),p.username&&(r.Authorization="Basic "+btoa(p.username+":"+p.password),p=new URL(p.protocol+"//"+p.host+p.pathname+p.search)),"https:"!==p.protocol&&"http:"!==p.protocol)throw new Error(`Unknown protocol, ${p.protocol}`);if(a)if(a instanceof ArrayBuffer||ArrayBuffer.isView(a)||"string"==typeof a);else{if("object"!=typeof a)throw new Error("Unknown body type.");a=JSON.stringify(a),r["Content-Type"]="application/json"}c=new Headers({...r||{},...c});const h=await fetch(p,{method:t,headers:c,body:a});if(h.statusCode=h.status,!e.has(h.status))throw new n(h);return"json"===i?h.json():"buffer"===i?h.arrayBuffer():"string"===i?h.text():h}))},6561:e=>{"use strict";const t=new Set(["json","buffer","string"]);e.exports=e=>(...i)=>{const r=new Set;let n,s,o,a="";return i.forEach((e=>{if("string"==typeof e)if(e.toUpperCase()===e){if(n)throw new Error(`Can't set method to ${e}, already set to ${n}.`);n=e}else if(e.startsWith("http:")||e.startsWith("https:"))a=e;else{if(!t.has(e))throw new Error(`Unknown encoding, ${e}`);s=e}else if("number"==typeof e)r.add(e);else{if("object"!=typeof e)throw new Error("Unknown type: "+typeof e);if(Array.isArray(e)||e instanceof Set)e.forEach((e=>r.add(e)));else{if(o)throw new Error("Cannot set headers twice.");o=e}}})),n||(n="GET"),0===r.size&&r.add(200),e(r,n,s,o,a)}},7811:(e,t)=>{"use strict";var i=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,r=/\\([\u000b\u0020-\u00ff])/g,n=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function s(e){this.parameters=Object.create(null),this.type=e}t.Q=function(e){if(!e)throw new TypeError("argument string is required");var t="object"==typeof e?function(e){var t;if("function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]),"string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(e):e;if("string"!=typeof t)throw new TypeError("argument string is required to be a string");var o=t.indexOf(";"),a=-1!==o?t.slice(0,o).trim():t.trim();if(!n.test(a))throw new TypeError("invalid media type");var c=new s(a.toLowerCase());if(-1!==o){var p,h,u;for(i.lastIndex=o;h=i.exec(t);){if(h.index!==o)throw new TypeError("invalid parameter format");o+=h[0].length,p=h[1].toLowerCase(),34===(u=h[2]).charCodeAt(0)&&-1!==(u=u.slice(1,-1)).indexOf("\\")&&(u=u.replace(r,"$1")),c.parameters[p]=u}if(o!==t.length)throw new TypeError("invalid parameter format")}return c}},7574:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=[239,187,191];t.createParser=function(e){let t,r,n,s,o,a,c;return p(),{feed:function(e){r=r?r+e:e,t&&function(e){return i.every(((t,i)=>e.charCodeAt(i)===t))}(r)&&(r=r.slice(i.length)),t=!1;const o=r.length;let a=0,c=!1;for(;a<o;){c&&("\n"===r[a]&&++a,c=!1);let e,t=-1,i=s;for(let s=n;t<0&&s<o;++s)e=r[s],":"===e&&i<0?i=s-a:"\r"===e?(c=!0,t=s-a):"\n"===e&&(t=s-a);if(t<0){n=o-a,s=i;break}n=0,s=-1,h(r,a,i,t),a+=t+1}a===o?r="":a>0&&(r=r.slice(a))},reset:p};function p(){t=!0,r="",n=0,s=-1,o=void 0,a=void 0,c=""}function h(t,i,r,n){if(0===n)return c.length>0&&(e({type:"event",id:o,event:a||void 0,data:c.slice(0,-1)}),c="",o=void 0),void(a=void 0);const s=r<0,p=t.slice(i,i+(s?n:r));let h=0;h=s?n:" "===t[i+r+1]?r+2:r+1;const u=i+h,d=n-h,l=t.slice(u,u+d).toString();if("data"===p)c+=l?"".concat(l,"\n"):"\n";else if("event"===p)a=l;else if("id"!==p||l.includes("\0")){if("retry"===p){const t=parseInt(l,10);Number.isNaN(t)||e({type:"reconnect-interval",value:t})}}else o=l}}},5047:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ActivityReceivedEventArgs:()=>Cr,AudioConfig:()=>mt,AudioFormatTag:()=>Z,AudioInputStream:()=>ve,AudioOutputStream:()=>Be,AudioStreamFormat:()=>ee,AutoDetectSourceLanguageConfig:()=>nn,AutoDetectSourceLanguageResult:()=>sn,BaseAudioPlayer:()=>Or,BotFrameworkConfig:()=>gr,CancellationDetails:()=>ur,CancellationDetailsBase:()=>hr,CancellationErrorCode:()=>he,CancellationReason:()=>pe,Connection:()=>nr,ConnectionEventArgs:()=>tr,ConnectionMessage:()=>Yi,ConnectionMessageEventArgs:()=>ir,Conversation:()=>Yn,ConversationExpirationEventArgs:()=>En,ConversationParticipantsChangedEventArgs:()=>Gn,ConversationTranscriber:()=>ms,ConversationTranscriptionCanceledEventArgs:()=>cs,ConversationTranscriptionEventArgs:()=>xt,ConversationTranslationCanceledEventArgs:()=>bn,ConversationTranslationEventArgs:()=>$n,ConversationTranslationResult:()=>kn,ConversationTranslator:()=>as,CustomCommandsConfig:()=>fr,Diagnostics:()=>Ds,DialogServiceConfig:()=>lr,DialogServiceConnector:()=>Dr,IntentRecognitionCanceledEventArgs:()=>Li,IntentRecognitionEventArgs:()=>Pt,IntentRecognitionResult:()=>Tt,IntentRecognizer:()=>Fi,KeywordRecognitionModel:()=>Ct,LanguageIdMode:()=>Xr,LanguageUnderstandingModel:()=>bt,LogLevel:()=>d,NoMatchDetails:()=>pr,NoMatchReason:()=>sr,OutputFormat:()=>dt,Participant:()=>Zn,ParticipantChangedReason:()=>Wn,PhraseListGrammar:()=>dr,ProfanityOption:()=>lt,PronunciationAssessmentConfig:()=>ks,PronunciationAssessmentGradingSystem:()=>Is,PronunciationAssessmentGranularity:()=>As,PronunciationAssessmentResult:()=>xs,PropertyCollection:()=>Oe,PropertyId:()=>l,PullAudioInputStream:()=>me,PullAudioInputStreamCallback:()=>oe,PullAudioOutputStream:()=>qe,PushAudioInputStream:()=>ge,PushAudioOutputStream:()=>Fe,PushAudioOutputStreamCallback:()=>ut,RecognitionEventArgs:()=>Rt,RecognitionResult:()=>It,Recognizer:()=>ai,ResultReason:()=>ue,ServiceEventArgs:()=>rr,ServicePropertyChannel:()=>kr,SessionEventArgs:()=>wt,SourceLanguageConfig:()=>on,SpeakerAudioDestination:()=>ht,SpeakerIdentificationModel:()=>tn,SpeakerRecognitionCancellationDetails:()=>$r,SpeakerRecognitionResult:()=>Gr,SpeakerRecognitionResultType:()=>jr,SpeakerRecognizer:()=>en,SpeakerVerificationModel:()=>rn,SpeechConfig:()=>_t,SpeechConfigImpl:()=>Bt,SpeechRecognitionCanceledEventArgs:()=>Ot,SpeechRecognitionEventArgs:()=>kt,SpeechRecognitionResult:()=>At,SpeechRecognizer:()=>Ni,SpeechSynthesisBookmarkEventArgs:()=>ze,SpeechSynthesisBoundaryType:()=>Ps,SpeechSynthesisEventArgs:()=>ke,SpeechSynthesisOutputFormat:()=>de,SpeechSynthesisResult:()=>De,SpeechSynthesisVisemeEventArgs:()=>Me,SpeechSynthesisWordBoundaryEventArgs:()=>Ne,SpeechSynthesizer:()=>bs,SpeechTranslationConfig:()=>qt,SpeechTranslationConfigImpl:()=>Ut,SynthesisResult:()=>xe,SynthesisVoicesResult:()=>Rs,TranslationRecognitionCanceledEventArgs:()=>Wi,TranslationRecognitionEventArgs:()=>Nt,TranslationRecognitionResult:()=>Mt,TranslationRecognizer:()=>cr,TranslationSynthesisEventArgs:()=>zt,TranslationSynthesisResult:()=>Lt,Translations:()=>ji,TurnStatusReceivedEventArgs:()=>Rr,User:()=>Qn,VoiceInfo:()=>ws,VoiceProfile:()=>Nr,VoiceProfileCancellationDetails:()=>_r,VoiceProfileClient:()=>Vr,VoiceProfileEnrollmentCancellationDetails:()=>Mr,VoiceProfileEnrollmentResult:()=>zr,VoiceProfilePhraseResult:()=>Br,VoiceProfileResult:()=>Lr,VoiceProfileType:()=>qi});var r=i(3034);const n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let s;const o=new Uint8Array(16);function a(){if(!s&&(s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!s))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(o)}const c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));const p=function(e,t,i){if(n.randomUUID&&!t&&!e)return n.randomUUID();const r=(e=e||{}).random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=r[e];return t}return function(e,t=0){return(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase()}(r)},h=()=>p(),u=()=>h().replace(new RegExp("-","g"),"").toUpperCase();var d,l,v,g,f,m,S,y;(y=d||(d={}))[y.Debug=0]="Debug",y[y.Info=1]="Info",y[y.Warning=2]="Warning",y[y.Error=3]="Error",y[y.None=4]="None";class C{constructor(e,t){this.privName=e,this.privEventId=u(),this.privEventTime=(new Date).toISOString(),this.privEventType=t,this.privMetadata={}}get name(){return this.privName}get eventId(){return this.privEventId}get eventTime(){return this.privEventTime}get eventType(){return this.privEventType}get metadata(){return this.privMetadata}}class w{static throwIfNullOrUndefined(e,t){if(null==e)throw new Error("throwIfNullOrUndefined:"+t)}static throwIfNull(e,t){if(null===e)throw new Error("throwIfNull:"+t)}static throwIfNullOrWhitespace(e,t){if(w.throwIfNullOrUndefined(e,t),(""+e).trim().length<1)throw new Error("throwIfNullOrWhitespace:"+t)}static throwIfNullOrTooLong(e,t,i){if(w.throwIfNullOrUndefined(e,t),(""+e).length>i)throw new Error("throwIfNullOrTooLong:"+t+" (more than "+i.toString()+" characters)")}static throwIfNullOrTooShort(e,t,i){if(w.throwIfNullOrUndefined(e,t),(""+e).length<i)throw new Error("throwIfNullOrTooShort:"+t+" (less than "+i.toString()+" characters)")}static throwIfDisposed(e){if(e)throw new Error("the object is already disposed")}static throwIfArrayEmptyOrWhitespace(e,t){if(w.throwIfNullOrUndefined(e,t),0===e.length)throw new Error("throwIfArrayEmptyOrWhitespace:"+t);for(const i of e)w.throwIfNullOrWhitespace(i,t)}static throwIfFileDoesNotExist(e,t){w.throwIfNullOrWhitespace(e,t)}static throwIfNotUndefined(e,t){if(void 0!==e)throw new Error("throwIfNotUndefined:"+t)}}class R{constructor(e=d.None){this.privLogPath=void 0,this.privEnableConsoleOutput=!0,this.privLogLevelFilter=e}set logPath(e){w.throwIfNullOrUndefined(r.openSync,"\nFile System access not available"),this.privLogPath=e}set enableConsoleOutput(e){this.privEnableConsoleOutput=e}onEvent(e){if(e.eventType>=this.privLogLevelFilter){const t=this.toString(e);if(this.privLogPath&&r.writeFileSync(this.privLogPath,t+"\n",{flag:"a+"}),this.privEnableConsoleOutput)switch(e.eventType){case d.Debug:console.debug(t);break;case d.Info:console.info(t);break;case d.Warning:console.warn(t);break;case d.Error:console.error(t);break;default:console.log(t)}}}toString(e){const t=[`${e.eventTime}`,`${e.name}`],i=e;for(const r in i)if(r&&e.hasOwnProperty(r)&&"eventTime"!==r&&"eventType"!==r&&"eventId"!==r&&"name"!==r&&"constructor"!==r){const e=i[r];let n="<NULL>";null!=e&&(n="number"==typeof e||"string"==typeof e?e.toString():JSON.stringify(e)),t.push(`${r}: ${n}`)}return t.join(" | ")}}class P extends Error{constructor(e){super(e),this.name="ArgumentNull",this.message=e}}class I extends Error{constructor(e){super(e),this.name="InvalidOperation",this.message=e}}class A extends Error{constructor(e,t){super(t),this.name=e+"ObjectDisposed",this.message=t}}class T{constructor(e){this.privEventListeners={},this.privIsDisposed=!1,this.privConsoleListener=void 0,this.privMetadata=e}onEvent(e){if(this.isDisposed())throw new A("EventSource");if(this.metadata)for(const t in this.metadata)t&&e.metadata&&(e.metadata[t]||(e.metadata[t]=this.metadata[t]));for(const t in this.privEventListeners)t&&this.privEventListeners[t]&&this.privEventListeners[t](e)}attach(e){const t=u();return this.privEventListeners[t]=e,{detach:()=>(delete this.privEventListeners[t],Promise.resolve())}}attachListener(e){return this.attach((t=>e.onEvent(t)))}attachConsoleListener(e){return this.privConsoleListener&&this.privConsoleListener.detach(),this.privConsoleListener=this.attach((t=>e.onEvent(t))),this.privConsoleListener}isDisposed(){return this.privIsDisposed}dispose(){this.privEventListeners=null,this.privIsDisposed=!0}get metadata(){return this.privMetadata}}class b{static setEventSource(e){if(!e)throw new P("eventSource");b.privInstance=e}static get instance(){return b.privInstance}}b.privInstance=new T;class E{constructor(e,t){this.privActualSampleRate=e,this.privDesiredSampleRate=t}encode(e){const t=this.downSampleAudioFrame(e,this.privActualSampleRate,this.privDesiredSampleRate);if(!t)return null;const i=2*t.length,r=new ArrayBuffer(i),n=new DataView(r);return this.floatTo16BitPCM(n,0,t),r}setString(e,t,i){for(let r=0;r<i.length;r++)e.setUint8(t+r,i.charCodeAt(r))}floatTo16BitPCM(e,t,i){for(let r=0;r<i.length;r++,t+=2){const n=Math.max(-1,Math.min(1,i[r]));e.setInt16(t,n<0?32768*n:32767*n,!0)}}downSampleAudioFrame(e,t,i){if(!e)return null;if(i===t||i>t)return e;const r=t/i,n=Math.round(e.length/r),s=new Float32Array(n);let o=0,a=0;for(;a<n;){const t=Math.round((a+1)*r);let i=0,n=0;for(;o<t&&o<e.length;)i+=e[o++],n++;s[a++]=i/n}return s}}class k{constructor(e){this.privStopInputOnRelease=e}record(e,t,i){const r=new E(e.sampleRate,16e3),n=e.createMediaStreamSource(t),s=()=>{const s=(()=>{let t=0;try{return e.createScriptProcessor(t,1,1)}catch(i){t=2048;let r=e.sampleRate;for(;t<16384&&r>=32e3;)t<<=1,r>>=1;return e.createScriptProcessor(t,1,1)}})();s.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0);if(i&&!i.isClosed){const e=r.encode(t);e&&i.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}},n.connect(s),s.connect(e.destination),this.privMediaResources={scriptProcessorNode:s,source:n,stream:t}};if(e.audioWorklet){if(!this.privSpeechProcessorScript){const e=new Blob(["class SP extends AudioWorkletProcessor {\n                    constructor(options) {\n                      super(options);\n                    }\n                    process(inputs, outputs) {\n                      const input = inputs[0];\n                      const output = [];\n                      for (let channel = 0; channel < input.length; channel += 1) {\n                        output[channel] = input[channel];\n                      }\n                      this.port.postMessage(output[0]);\n                      return true;\n                    }\n                  }\n                  registerProcessor('speech-processor', SP);"],{type:"application/javascript; charset=utf-8"});this.privSpeechProcessorScript=URL.createObjectURL(e)}e.audioWorklet.addModule(this.privSpeechProcessorScript).then((()=>{const s=new AudioWorkletNode(e,"speech-processor");s.port.onmessage=e=>{const t=e.data;if(i&&!i.isClosed){const e=r.encode(t);e&&i.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}},n.connect(s),s.connect(e.destination),this.privMediaResources={scriptProcessorNode:s,source:n,stream:t}})).catch((()=>{s()}))}else try{s()}catch(e){throw new Error(`Unable to start audio worklet node for PCMRecorder: ${e}`)}}releaseMediaResources(e){this.privMediaResources&&(this.privMediaResources.scriptProcessorNode&&(this.privMediaResources.scriptProcessorNode.disconnect(e.destination),this.privMediaResources.scriptProcessorNode=null),this.privMediaResources.source&&(this.privMediaResources.source.disconnect(),this.privStopInputOnRelease&&this.privMediaResources.stream.getTracks().forEach((e=>e.stop())),this.privMediaResources.source=null))}setWorkletUrl(e){this.privSpeechProcessorScript=e}}!function(e){e[e.SpeechServiceConnection_Key=0]="SpeechServiceConnection_Key",e[e.SpeechServiceConnection_Endpoint=1]="SpeechServiceConnection_Endpoint",e[e.SpeechServiceConnection_Region=2]="SpeechServiceConnection_Region",e[e.SpeechServiceAuthorization_Token=3]="SpeechServiceAuthorization_Token",e[e.SpeechServiceAuthorization_Type=4]="SpeechServiceAuthorization_Type",e[e.SpeechServiceConnection_EndpointId=5]="SpeechServiceConnection_EndpointId",e[e.SpeechServiceConnection_TranslationToLanguages=6]="SpeechServiceConnection_TranslationToLanguages",e[e.SpeechServiceConnection_TranslationVoice=7]="SpeechServiceConnection_TranslationVoice",e[e.SpeechServiceConnection_TranslationFeatures=8]="SpeechServiceConnection_TranslationFeatures",e[e.SpeechServiceConnection_IntentRegion=9]="SpeechServiceConnection_IntentRegion",e[e.SpeechServiceConnection_ProxyHostName=10]="SpeechServiceConnection_ProxyHostName",e[e.SpeechServiceConnection_ProxyPort=11]="SpeechServiceConnection_ProxyPort",e[e.SpeechServiceConnection_ProxyUserName=12]="SpeechServiceConnection_ProxyUserName",e[e.SpeechServiceConnection_ProxyPassword=13]="SpeechServiceConnection_ProxyPassword",e[e.SpeechServiceConnection_RecoMode=14]="SpeechServiceConnection_RecoMode",e[e.SpeechServiceConnection_RecoLanguage=15]="SpeechServiceConnection_RecoLanguage",e[e.Speech_SessionId=16]="Speech_SessionId",e[e.SpeechServiceConnection_SynthLanguage=17]="SpeechServiceConnection_SynthLanguage",e[e.SpeechServiceConnection_SynthVoice=18]="SpeechServiceConnection_SynthVoice",e[e.SpeechServiceConnection_SynthOutputFormat=19]="SpeechServiceConnection_SynthOutputFormat",e[e.SpeechServiceConnection_AutoDetectSourceLanguages=20]="SpeechServiceConnection_AutoDetectSourceLanguages",e[e.SpeechServiceResponse_RequestDetailedResultTrueFalse=21]="SpeechServiceResponse_RequestDetailedResultTrueFalse",e[e.SpeechServiceResponse_RequestProfanityFilterTrueFalse=22]="SpeechServiceResponse_RequestProfanityFilterTrueFalse",e[e.SpeechServiceResponse_JsonResult=23]="SpeechServiceResponse_JsonResult",e[e.SpeechServiceResponse_JsonErrorDetails=24]="SpeechServiceResponse_JsonErrorDetails",e[e.CancellationDetails_Reason=25]="CancellationDetails_Reason",e[e.CancellationDetails_ReasonText=26]="CancellationDetails_ReasonText",e[e.CancellationDetails_ReasonDetailedText=27]="CancellationDetails_ReasonDetailedText",e[e.LanguageUnderstandingServiceResponse_JsonResult=28]="LanguageUnderstandingServiceResponse_JsonResult",e[e.SpeechServiceConnection_Url=29]="SpeechServiceConnection_Url",e[e.SpeechServiceConnection_InitialSilenceTimeoutMs=30]="SpeechServiceConnection_InitialSilenceTimeoutMs",e[e.SpeechServiceConnection_EndSilenceTimeoutMs=31]="SpeechServiceConnection_EndSilenceTimeoutMs",e[e.Speech_SegmentationSilenceTimeoutMs=32]="Speech_SegmentationSilenceTimeoutMs",e[e.SpeechServiceConnection_EnableAudioLogging=33]="SpeechServiceConnection_EnableAudioLogging",e[e.SpeechServiceConnection_LanguageIdMode=34]="SpeechServiceConnection_LanguageIdMode",e[e.SpeechServiceConnection_RecognitionEndpointVersion=35]="SpeechServiceConnection_RecognitionEndpointVersion",e[e.SpeechServiceConnection_SpeakerIdMode=36]="SpeechServiceConnection_SpeakerIdMode",e[e.SpeechServiceResponse_ProfanityOption=37]="SpeechServiceResponse_ProfanityOption",e[e.SpeechServiceResponse_PostProcessingOption=38]="SpeechServiceResponse_PostProcessingOption",e[e.SpeechServiceResponse_RequestWordLevelTimestamps=39]="SpeechServiceResponse_RequestWordLevelTimestamps",e[e.SpeechServiceResponse_StablePartialResultThreshold=40]="SpeechServiceResponse_StablePartialResultThreshold",e[e.SpeechServiceResponse_OutputFormatOption=41]="SpeechServiceResponse_OutputFormatOption",e[e.SpeechServiceResponse_TranslationRequestStablePartialResult=42]="SpeechServiceResponse_TranslationRequestStablePartialResult",e[e.SpeechServiceResponse_RequestWordBoundary=43]="SpeechServiceResponse_RequestWordBoundary",e[e.SpeechServiceResponse_RequestPunctuationBoundary=44]="SpeechServiceResponse_RequestPunctuationBoundary",e[e.SpeechServiceResponse_RequestSentenceBoundary=45]="SpeechServiceResponse_RequestSentenceBoundary",e[e.Conversation_ApplicationId=46]="Conversation_ApplicationId",e[e.Conversation_DialogType=47]="Conversation_DialogType",e[e.Conversation_Initial_Silence_Timeout=48]="Conversation_Initial_Silence_Timeout",e[e.Conversation_From_Id=49]="Conversation_From_Id",e[e.Conversation_Conversation_Id=50]="Conversation_Conversation_Id",e[e.Conversation_Custom_Voice_Deployment_Ids=51]="Conversation_Custom_Voice_Deployment_Ids",e[e.Conversation_Speech_Activity_Template=52]="Conversation_Speech_Activity_Template",e[e.Conversation_Request_Bot_Status_Messages=53]="Conversation_Request_Bot_Status_Messages",e[e.Conversation_Agent_Connection_Id=54]="Conversation_Agent_Connection_Id",e[e.SpeechServiceConnection_Host=55]="SpeechServiceConnection_Host",e[e.ConversationTranslator_Host=56]="ConversationTranslator_Host",e[e.ConversationTranslator_Name=57]="ConversationTranslator_Name",e[e.ConversationTranslator_CorrelationId=58]="ConversationTranslator_CorrelationId",e[e.ConversationTranslator_Token=59]="ConversationTranslator_Token",e[e.PronunciationAssessment_ReferenceText=60]="PronunciationAssessment_ReferenceText",e[e.PronunciationAssessment_GradingSystem=61]="PronunciationAssessment_GradingSystem",e[e.PronunciationAssessment_Granularity=62]="PronunciationAssessment_Granularity",e[e.PronunciationAssessment_EnableMiscue=63]="PronunciationAssessment_EnableMiscue",e[e.PronunciationAssessment_Json=64]="PronunciationAssessment_Json",e[e.PronunciationAssessment_Params=65]="PronunciationAssessment_Params",e[e.SpeakerRecognition_Api_Version=66]="SpeakerRecognition_Api_Version"}(l||(l={})),function(e){e[e.Interactive=0]="Interactive",e[e.Conversation=1]="Conversation",e[e.Dictation=2]="Dictation"}(v||(v={})),function(e){e[e.Simple=0]="Simple",e[e.Detailed=1]="Detailed"}(g||(g={}));class x{constructor(e,t){this.privSpeechServiceConfig=e||new D(new O(null)),this.privParameters=t,this.privMaxRetryCount=parseInt(t.getProperty("SPEECH-Error-MaxRetryCount","4"),10),this.privLanguageIdMode=t.getProperty(l.SpeechServiceConnection_LanguageIdMode,void 0)}get parameters(){return this.privParameters}get recognitionMode(){return this.privRecognitionMode}set recognitionMode(e){this.privRecognitionMode=e,this.privRecognitionActivityTimeout=e===v.Interactive?8e3:25e3,this.privSpeechServiceConfig.Recognition=v[e]}get SpeechServiceConfig(){return this.privSpeechServiceConfig}get recognitionActivityTimeout(){return this.privRecognitionActivityTimeout}get isContinuousRecognition(){return this.privRecognitionMode!==v.Interactive}get languageIdMode(){return this.privLanguageIdMode}get autoDetectSourceLanguages(){return this.parameters.getProperty(l.SpeechServiceConnection_AutoDetectSourceLanguages,void 0)}get recognitionEndpointVersion(){return this.parameters.getProperty(l.SpeechServiceConnection_RecognitionEndpointVersion,void 0)}get sourceLanguageModels(){const e=[];let t=!1;if(void 0!==this.autoDetectSourceLanguages)for(const i of this.autoDetectSourceLanguages.split(",")){const r=i+l.SpeechServiceConnection_EndpointId.toString(),n=this.parameters.getProperty(r,void 0);void 0!==n?(e.push({language:i,endpoint:n}),t=!0):e.push({language:i,endpoint:""})}return t?e:void 0}get maxRetryCount(){return this.privMaxRetryCount}}class D{constructor(e){this.context=e}serialize(){return JSON.stringify(this,((e,t)=>{if(t&&"object"==typeof t){const e={};for(const i in t)Object.hasOwnProperty.call(t,i)&&(e[i&&i.charAt(0).toLowerCase()+i.substring(1)]=t[i]);return e}return t}))}get Context(){return this.context}get Recognition(){return this.recognition}set Recognition(e){this.recognition=e.toLowerCase()}}class O{constructor(e){this.system=new N,this.os=e}}class N{constructor(){this.name="SpeechSDK",this.version="1.30.1",this.build="JavaScript",this.lang="JavaScript"}}class z{constructor(e,t,i){this.platform=e,this.name=t,this.version=i}}!function(e){e.Bluetooth="Bluetooth",e.Wired="Wired",e.WiFi="WiFi",e.Cellular="Cellular",e.InBuilt="InBuilt",e.Unknown="Unknown"}(f||(f={})),function(e){e.Phone="Phone",e.Speaker="Speaker",e.Car="Car",e.Headset="Headset",e.Thermostat="Thermostat",e.Microphones="Microphones",e.Deskphone="Deskphone",e.RemoteControl="RemoteControl",e.Unknown="Unknown",e.File="File",e.Stream="Stream"}(m||(m={})),function(e){e[e.None=0]="None",e[e.Resolved=1]="Resolved",e[e.Rejected=2]="Rejected"}(S||(S={}));class M{constructor(){this.resolve=e=>(this.privResolve(e),this),this.reject=e=>(this.privReject(e),this),this.privPromise=new Promise(((e,t)=>{this.privResolve=e,this.privReject=t}))}get promise(){return this.privPromise}}function L(e,t,i){e.then((e=>{try{t&&t(e)}catch(e){if(i)try{if(e instanceof Error){const t=e;i(t.name+": "+t.message)}else i(e)}catch(e){}}}),(e=>{if(i)try{if(e instanceof Error){const t=e;i(t.name+": "+t.message)}else i(e)}catch(e){}}))}class _ extends C{constructor(e,t,i=d.Info){super(e,i),this.privAudioSourceId=t}get audioSourceId(){return this.privAudioSourceId}}class B extends _{constructor(e){super("AudioSourceInitializingEvent",e)}}class q extends _{constructor(e){super("AudioSourceReadyEvent",e)}}class U extends _{constructor(e){super("AudioSourceOffEvent",e)}}class F extends _{constructor(e,t){super("AudioSourceErrorEvent",e,d.Error),this.privError=t}get error(){return this.privError}}class K extends _{constructor(e,t,i){super(e,t),this.privAudioNodeId=i}get audioNodeId(){return this.privAudioNodeId}}class H extends K{constructor(e,t){super("AudioStreamNodeAttachingEvent",e,t)}}class W extends K{constructor(e,t){super("AudioStreamNodeAttachedEvent",e,t)}}class j extends K{constructor(e,t){super("AudioStreamNodeDetachedEvent",e,t)}}class J extends K{constructor(e,t,i){super("AudioStreamNodeErrorEvent",e,t),this.privError=i}get error(){return this.privError}}class V{constructor(e){if(this.privSubscriptionIdCounter=0,this.privAddSubscriptions={},this.privRemoveSubscriptions={},this.privDisposedSubscriptions={},this.privDisposeReason=null,this.privList=[],e)for(const t of e)this.privList.push(t)}get(e){return this.throwIfDisposed(),this.privList[e]}first(){return this.get(0)}last(){return this.get(this.length()-1)}add(e){this.throwIfDisposed(),this.insertAt(this.privList.length,e)}insertAt(e,t){this.throwIfDisposed(),0===e?this.privList.unshift(t):e===this.privList.length?this.privList.push(t):this.privList.splice(e,0,t),this.triggerSubscriptions(this.privAddSubscriptions)}removeFirst(){return this.throwIfDisposed(),this.removeAt(0)}removeLast(){return this.throwIfDisposed(),this.removeAt(this.length()-1)}removeAt(e){return this.throwIfDisposed(),this.remove(e,1)[0]}remove(e,t){this.throwIfDisposed();const i=this.privList.splice(e,t);return this.triggerSubscriptions(this.privRemoveSubscriptions),i}clear(){this.throwIfDisposed(),this.remove(0,this.length())}length(){return this.throwIfDisposed(),this.privList.length}onAdded(e){this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privAddSubscriptions[t]=e,{detach:()=>(delete this.privAddSubscriptions[t],Promise.resolve())}}onRemoved(e){this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privRemoveSubscriptions[t]=e,{detach:()=>(delete this.privRemoveSubscriptions[t],Promise.resolve())}}onDisposed(e){this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privDisposedSubscriptions[t]=e,{detach:()=>(delete this.privDisposedSubscriptions[t],Promise.resolve())}}join(e){return this.throwIfDisposed(),this.privList.join(e)}toArray(){const e=Array();return this.privList.forEach((t=>{e.push(t)})),e}any(e){return this.throwIfDisposed(),e?this.where(e).length()>0:this.length()>0}all(e){return this.throwIfDisposed(),this.where(e).length()===this.length()}forEach(e){this.throwIfDisposed();for(let t=0;t<this.length();t++)e(this.privList[t],t)}select(e){this.throwIfDisposed();const t=[];for(let i=0;i<this.privList.length;i++)t.push(e(this.privList[i],i));return new V(t)}where(e){this.throwIfDisposed();const t=new V;for(let i=0;i<this.privList.length;i++)e(this.privList[i],i)&&t.add(this.privList[i]);return t}orderBy(e){this.throwIfDisposed();const t=this.toArray().sort(e);return new V(t)}orderByDesc(e){return this.throwIfDisposed(),this.orderBy(((t,i)=>e(i,t)))}clone(){return this.throwIfDisposed(),new V(this.toArray())}concat(e){return this.throwIfDisposed(),new V(this.privList.concat(e.toArray()))}concatArray(e){return this.throwIfDisposed(),new V(this.privList.concat(e))}isDisposed(){return null==this.privList}dispose(e){this.isDisposed()||(this.privDisposeReason=e,this.privList=null,this.privAddSubscriptions=null,this.privRemoveSubscriptions=null,this.triggerSubscriptions(this.privDisposedSubscriptions))}throwIfDisposed(){if(this.isDisposed())throw new A("List",this.privDisposeReason)}triggerSubscriptions(e){if(e)for(const t in e)t&&e[t]()}}var G,$=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};!function(e){e[e.Dequeue=0]="Dequeue",e[e.Peek=1]="Peek"}(G||(G={}));class Q{constructor(e){this.privPromiseStore=new V,this.privIsDrainInProgress=!1,this.privIsDisposing=!1,this.privDisposeReason=null,this.privList=e||new V,this.privDetachables=[],this.privSubscribers=new V,this.privDetachables.push(this.privList.onAdded((()=>this.drain())))}enqueue(e){this.throwIfDispose(),this.enqueueFromPromise(new Promise((t=>t(e))))}enqueueFromPromise(e){this.throwIfDispose(),e.then((e=>{this.privList.add(e)}),(()=>{}))}dequeue(){this.throwIfDispose();const e=new M;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:G.Dequeue}),this.drain()),e.promise}peek(){this.throwIfDispose();const e=new M;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:G.Peek}),this.drain()),e.promise}length(){return this.throwIfDispose(),this.privList.length()}isDisposed(){return null==this.privSubscribers}drainAndDispose(e,t){return $(this,void 0,void 0,(function*(){if(!this.isDisposed()&&!this.privIsDisposing){this.privDisposeReason=t,this.privIsDisposing=!0;const i=this.privSubscribers;if(i){for(;i.length()>0;)i.removeFirst().deferral.resolve(void 0);this.privSubscribers===i&&(this.privSubscribers=i)}for(const e of this.privDetachables)yield e.detach();if(this.privPromiseStore.length()>0&&e){const t=[];return this.privPromiseStore.toArray().forEach((e=>{t.push(e)})),Promise.all(t).finally((()=>{this.privSubscribers=null,this.privList.forEach((t=>{e(t)})),this.privList=null})).then()}this.privSubscribers=null,this.privList=null}}))}dispose(e){return $(this,void 0,void 0,(function*(){yield this.drainAndDispose(null,e)}))}drain(){if(!this.privIsDrainInProgress&&!this.privIsDisposing){this.privIsDrainInProgress=!0;const e=this.privSubscribers,t=this.privList;if(e&&t){for(;t.length()>0&&e.length()>0&&!this.privIsDisposing;){const i=e.removeFirst();if(i.type===G.Peek)i.deferral.resolve(t.first());else{const e=t.removeFirst();i.deferral.resolve(e)}}this.privSubscribers===e&&(this.privSubscribers=e),this.privList===t&&(this.privList=t)}this.privIsDrainInProgress=!1}}throwIfDispose(){if(this.isDisposed()){if(this.privDisposeReason)throw new I(this.privDisposeReason);throw new A("Queue")}if(this.privIsDisposing)throw new I("Queue disposing")}}var Z;class X{constructor(e){this.privIsWriteEnded=!1,this.privIsReadEnded=!1,this.privId=e||u(),this.privReaderQueue=new Q}get isClosed(){return this.privIsWriteEnded}get isReadEnded(){return this.privIsReadEnded}get id(){return this.privId}close(){this.privIsWriteEnded||(this.writeStreamChunk({buffer:null,isEnd:!0,timeReceived:Date.now()}),this.privIsWriteEnded=!0)}writeStreamChunk(e){if(this.throwIfClosed(),!this.privReaderQueue.isDisposed())try{this.privReaderQueue.enqueue(e)}catch(e){}}read(){if(this.privIsReadEnded)throw new I("Stream read has already finished");return this.privReaderQueue.dequeue().then((e=>{return t=this,i=void 0,n=function*(){return(void 0===e||e.isEnd)&&(yield this.privReaderQueue.dispose("End of stream reached")),e},new((r=void 0)||(r=Promise))((function(e,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(o,a)}c((n=n.apply(t,i||[])).next())}));var t,i,r,n}))}readEnded(){this.privIsReadEnded||(this.privIsReadEnded=!0,this.privReaderQueue=new Q)}throwIfClosed(){if(this.privIsWriteEnded)throw new I("Stream closed")}}class Y extends X{constructor(e,t){super(t),this.privTargetChunkSize=e,this.privNextBufferReadyBytes=0}writeStreamChunk(e){if(e.isEnd||0===this.privNextBufferReadyBytes&&e.buffer.byteLength===this.privTargetChunkSize)return void super.writeStreamChunk(e);let t=0;for(;t<e.buffer.byteLength;){void 0===this.privNextBufferToWrite&&(this.privNextBufferToWrite=new ArrayBuffer(this.privTargetChunkSize),this.privNextBufferStartTime=e.timeReceived);const i=Math.min(e.buffer.byteLength-t,this.privTargetChunkSize-this.privNextBufferReadyBytes),r=new Uint8Array(this.privNextBufferToWrite),n=new Uint8Array(e.buffer.slice(t,i+t));r.set(n,this.privNextBufferReadyBytes),this.privNextBufferReadyBytes+=i,t+=i,this.privNextBufferReadyBytes===this.privTargetChunkSize&&(super.writeStreamChunk({buffer:this.privNextBufferToWrite,isEnd:!1,timeReceived:this.privNextBufferStartTime}),this.privNextBufferReadyBytes=0,this.privNextBufferToWrite=void 0)}}close(){0===this.privNextBufferReadyBytes||this.isClosed||super.writeStreamChunk({buffer:this.privNextBufferToWrite.slice(0,this.privNextBufferReadyBytes),isEnd:!1,timeReceived:this.privNextBufferStartTime}),super.close()}}!function(e){e[e.PCM=1]="PCM",e[e.MuLaw=2]="MuLaw",e[e.Siren=3]="Siren",e[e.MP3=4]="MP3",e[e.SILKSkype=5]="SILKSkype",e[e.OGG_OPUS=6]="OGG_OPUS",e[e.WEBM_OPUS=7]="WEBM_OPUS",e[e.ALaw=8]="ALaw",e[e.FLAC=9]="FLAC",e[e.OPUS=10]="OPUS"}(Z||(Z={}));class ee{static getDefaultInputFormat(){return te.getDefaultInputFormat()}static getWaveFormat(e,t,i,r){return new te(e,t,i,r)}static getWaveFormatPCM(e,t,i){return new te(e,t,i)}}class te extends ee{constructor(e=16e3,t=16,i=1,r=Z.PCM){super();let n=!0;switch(r){case Z.PCM:this.formatTag=1;break;case Z.ALaw:this.formatTag=6;break;case Z.MuLaw:this.formatTag=7;break;default:n=!1}if(this.bitsPerSample=t,this.samplesPerSec=e,this.channels=i,this.avgBytesPerSec=this.samplesPerSec*this.channels*(this.bitsPerSample/8),this.blockAlign=this.channels*Math.max(this.bitsPerSample,8),n){this.privHeader=new ArrayBuffer(44);const e=new DataView(this.privHeader);this.setString(e,0,"RIFF"),e.setUint32(4,0,!0),this.setString(e,8,"WAVEfmt "),e.setUint32(16,16,!0),e.setUint16(20,this.formatTag,!0),e.setUint16(22,this.channels,!0),e.setUint32(24,this.samplesPerSec,!0),e.setUint32(28,this.avgBytesPerSec,!0),e.setUint16(32,this.channels*(this.bitsPerSample/8),!0),e.setUint16(34,this.bitsPerSample,!0),this.setString(e,36,"data"),e.setUint32(40,0,!0)}}static getDefaultInputFormat(){return new te}static getAudioContext(e){const t=window.AudioContext||window.webkitAudioContext||!1;if(t)return void 0!==e&&navigator.mediaDevices.getSupportedConstraints().sampleRate?new t({sampleRate:e}):new t;throw new Error("Browser does not support Web Audio API (AudioContext is not available).")}close(){}get header(){return this.privHeader}setString(e,t,i){for(let r=0;r<i.length;r++)e.setUint8(t+r,i.charCodeAt(r))}}var ie=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class re{constructor(e,t,i,r){this.privRecorder=e,this.deviceId=t,this.privStreams={},this.privOutputChunkSize=re.AUDIOFORMAT.avgBytesPerSec/10,this.privId=i||u(),this.privEvents=new T,this.privMediaStream=r||null,this.privIsClosing=!1}get format(){return Promise.resolve(re.AUDIOFORMAT)}turnOn(){if(this.privInitializeDeferral)return this.privInitializeDeferral.promise;this.privInitializeDeferral=new M;try{this.createAudioContext()}catch(e){if(e instanceof Error){const t=e;this.privInitializeDeferral.reject(t.name+": "+t.message)}else this.privInitializeDeferral.reject(e);return this.privInitializeDeferral.promise}const e=window.navigator;let t=e.getUserMedia||e.webkitGetUserMedia||e.mozGetUserMedia||e.msGetUserMedia;if(e.mediaDevices&&(t=(t,i,r)=>{e.mediaDevices.getUserMedia(t).then(i).catch(r)}),t){const e=()=>{this.onEvent(new B(this.privId)),this.privMediaStream&&this.privMediaStream.active?(this.onEvent(new q(this.privId)),this.privInitializeDeferral.resolve()):t({audio:!this.deviceId||{deviceId:this.deviceId},video:!1},(e=>{this.privMediaStream=e,this.onEvent(new q(this.privId)),this.privInitializeDeferral.resolve()}),(e=>{const t=`Error occurred during microphone initialization: ${e}`;this.privInitializeDeferral.reject(t),this.onEvent(new F(this.privId,t))}))};"suspended"===this.privContext.state?this.privContext.resume().then(e).catch((e=>{this.privInitializeDeferral.reject(`Failed to initialize audio context: ${e}`)})):e()}else{const e="Browser does not support getUserMedia.";this.privInitializeDeferral.reject(e),this.onEvent(new F(e,""))}return this.privInitializeDeferral.promise}id(){return this.privId}attach(e){return this.onEvent(new H(this.privId,e)),this.listen(e).then((t=>(this.onEvent(new W(this.privId,e)),{detach:()=>ie(this,void 0,void 0,(function*(){return t.readEnded(),delete this.privStreams[e],this.onEvent(new j(this.privId,e)),this.turnOff()})),id:()=>e,read:()=>t.read()})))}detach(e){e&&this.privStreams[e]&&(this.privStreams[e].close(),delete this.privStreams[e],this.onEvent(new j(this.privId,e)))}turnOff(){return ie(this,void 0,void 0,(function*(){for(const e in this.privStreams)if(e){const t=this.privStreams[e];t&&t.close()}this.onEvent(new U(this.privId)),this.privInitializeDeferral&&(yield this.privInitializeDeferral,this.privInitializeDeferral=null),yield this.destroyAudioContext()}))}get events(){return this.privEvents}get deviceInfo(){return this.getMicrophoneLabel().then((e=>({bitspersample:re.AUDIOFORMAT.bitsPerSample,channelcount:re.AUDIOFORMAT.channels,connectivity:f.Unknown,manufacturer:"Speech SDK",model:e,samplerate:re.AUDIOFORMAT.samplesPerSec,type:m.Microphones})))}setProperty(e,t){if("MICROPHONE-WorkletSourceUrl"!==e)throw new Error("Property '"+e+"' is not supported on Microphone.");this.privRecorder.setWorkletUrl(t)}getMicrophoneLabel(){const e="microphone";if(void 0!==this.privMicrophoneLabel)return Promise.resolve(this.privMicrophoneLabel);if(void 0===this.privMediaStream||!this.privMediaStream.active)return Promise.resolve(e);this.privMicrophoneLabel=e;const t=this.privMediaStream.getTracks()[0].getSettings().deviceId;if(void 0===t)return Promise.resolve(this.privMicrophoneLabel);const i=new M;return navigator.mediaDevices.enumerateDevices().then((e=>{for(const i of e)if(i.deviceId===t){this.privMicrophoneLabel=i.label;break}i.resolve(this.privMicrophoneLabel)}),(()=>i.resolve(this.privMicrophoneLabel))),i.promise}listen(e){return ie(this,void 0,void 0,(function*(){yield this.turnOn();const t=new Y(this.privOutputChunkSize,e);this.privStreams[e]=t;try{this.privRecorder.record(this.privContext,this.privMediaStream,t)}catch(t){throw this.onEvent(new J(this.privId,e,t)),t}return t}))}onEvent(e){this.privEvents.onEvent(e),b.instance.onEvent(e)}createAudioContext(){this.privContext||(this.privContext=te.getAudioContext(re.AUDIOFORMAT.samplesPerSec))}destroyAudioContext(){return ie(this,void 0,void 0,(function*(){if(!this.privContext)return;this.privRecorder.releaseMediaResources(this.privContext);let e=!1;"close"in this.privContext&&(e=!0),e?this.privIsClosing||(this.privIsClosing=!0,yield this.privContext.close(),this.privContext=null,this.privIsClosing=!1):null!==this.privContext&&"running"===this.privContext.state&&(yield this.privContext.suspend())}))}}re.AUDIOFORMAT=ee.getDefaultInputFormat();var ne=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class se{constructor(e,t,i){this.privStreams={},this.privHeaderEnd=44,this.privId=i||u(),this.privEvents=new T,this.privSource=e,"undefined"!=typeof window&&"undefined"!=typeof Blob&&this.privSource instanceof Blob?this.privFilename=e.name:this.privFilename=t||"unknown.wav",this.privAudioFormatPromise=this.readHeader()}get format(){return this.privAudioFormatPromise}turnOn(){if(this.privFilename.lastIndexOf(".wav")!==this.privFilename.length-4){const e=this.privFilename+" is not supported. Only WAVE files are allowed at the moment.";return this.onEvent(new F(e,"")),Promise.reject(e)}this.onEvent(new B(this.privId)),this.onEvent(new q(this.privId))}id(){return this.privId}attach(e){return ne(this,void 0,void 0,(function*(){this.onEvent(new H(this.privId,e));const t=yield this.upload(e);return this.onEvent(new W(this.privId,e)),Promise.resolve({detach:()=>ne(this,void 0,void 0,(function*(){t.readEnded(),delete this.privStreams[e],this.onEvent(new j(this.privId,e)),yield this.turnOff()})),id:()=>e,read:()=>t.read()})}))}detach(e){e&&this.privStreams[e]&&(this.privStreams[e].close(),delete this.privStreams[e],this.onEvent(new j(this.privId,e)))}turnOff(){for(const e in this.privStreams)if(e){const t=this.privStreams[e];t&&!t.isClosed&&t.close()}return this.onEvent(new U(this.privId)),Promise.resolve()}get events(){return this.privEvents}get deviceInfo(){return this.privAudioFormatPromise.then((e=>Promise.resolve({bitspersample:e.bitsPerSample,channelcount:e.channels,connectivity:f.Unknown,manufacturer:"Speech SDK",model:"File",samplerate:e.samplesPerSec,type:m.File})))}readHeader(){const e=this.privSource.slice(0,4296),t=new M,i=e=>{const i=new DataView(e),r=e=>String.fromCharCode(i.getUint8(e),i.getUint8(e+1),i.getUint8(e+2),i.getUint8(e+3));if("RIFF"!==r(0))return void t.reject("Invalid WAV header in file, RIFF was not found");if("WAVE"!==r(8)||"fmt "!==r(12))return void t.reject("Invalid WAV header in file, WAVEfmt was not found");const n=i.getInt32(16,!0),s=i.getUint16(22,!0),o=i.getUint32(24,!0),a=i.getUint16(34,!0);let c=36+Math.max(n-16,0);for(;"data"!==r(c);c+=2)if(c>4288)return void t.reject("Invalid WAV header in file, data block was not found");this.privHeaderEnd=c+8,t.resolve(ee.getWaveFormatPCM(o,a,s))};if("undefined"!=typeof window&&"undefined"!=typeof Blob&&e instanceof Blob){const t=new FileReader;t.onload=e=>{const t=e.target.result;i(t)},t.readAsArrayBuffer(e)}else{const t=e;i(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength))}return t.promise}upload(e){return ne(this,void 0,void 0,(function*(){const t=t=>{const i=`Error occurred while processing '${this.privFilename}'. ${t}`;throw this.onEvent(new J(this.privId,e,i)),new Error(i)};try{yield this.turnOn();const i=yield this.privAudioFormatPromise,r=new Y(i.avgBytesPerSec/10,e);this.privStreams[e]=r;const n=this.privSource.slice(this.privHeaderEnd),s=e=>{r.isClosed||(r.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()}),r.close())};if("undefined"!=typeof window&&"undefined"!=typeof Blob&&n instanceof Blob){const e=new FileReader;e.onerror=e=>t(e.toString()),e.onload=e=>{const t=e.target.result;s(t)},e.readAsArrayBuffer(n)}else{const e=n;s(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}return r}catch(e){t(e)}}))}onEvent(e){this.privEvents.onEvent(e),b.instance.onEvent(e)}}class oe{}var ae,ce,pe,he,ue,de,le=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class ve{constructor(){}static createPushStream(e){return ge.create(e)}static createPullStream(e,t){return me.create(e,t)}}class ge extends ve{static create(e){return new fe(e)}}class fe extends ge{constructor(e){super(),this.privFormat=void 0===e?te.getDefaultInputFormat():e,this.privEvents=new T,this.privId=u(),this.privStream=new Y(this.privFormat.avgBytesPerSec/10)}get format(){return Promise.resolve(this.privFormat)}write(e){this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}id(){return this.privId}turnOn(){this.onEvent(new B(this.privId)),this.onEvent(new q(this.privId))}attach(e){return le(this,void 0,void 0,(function*(){this.onEvent(new H(this.privId,e)),yield this.turnOn();const t=this.privStream;return this.onEvent(new W(this.privId,e)),{detach:()=>le(this,void 0,void 0,(function*(){return this.onEvent(new j(this.privId,e)),this.turnOff()})),id:()=>e,read:()=>t.read()}}))}detach(e){this.onEvent(new j(this.privId,e))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:f.Unknown,manufacturer:"Speech SDK",model:"PushStream",samplerate:this.privFormat.samplesPerSec,type:m.Stream})}onEvent(e){this.privEvents.onEvent(e),b.instance.onEvent(e)}toBuffer(e){const t=Buffer.alloc(e.byteLength),i=new Uint8Array(e);for(let e=0;e<t.length;++e)t[e]=i[e];return t}}class me extends ve{constructor(){super()}static create(e,t){return new Se(e,t)}}class Se extends me{constructor(e,t){super(),this.privFormat=void 0===t?ee.getDefaultInputFormat():t,this.privEvents=new T,this.privId=u(),this.privCallback=e,this.privIsClosed=!1,this.privBufferSize=this.privFormat.avgBytesPerSec/10}get format(){return Promise.resolve(this.privFormat)}close(){this.privIsClosed=!0,this.privCallback.close()}id(){return this.privId}turnOn(){this.onEvent(new B(this.privId)),this.onEvent(new q(this.privId))}attach(e){return le(this,void 0,void 0,(function*(){return this.onEvent(new H(this.privId,e)),yield this.turnOn(),this.onEvent(new W(this.privId,e)),{detach:()=>(this.privCallback.close(),this.onEvent(new j(this.privId,e)),this.turnOff()),id:()=>e,read:()=>{let e,t=0;for(;t<this.privBufferSize;){const i=new ArrayBuffer(this.privBufferSize-t),r=this.privCallback.read(i);if(void 0===e?e=i:new Int8Array(e).set(new Int8Array(i),t),0===r)break;t+=r}return Promise.resolve({buffer:e.slice(0,t),isEnd:this.privIsClosed||0===t,timeReceived:Date.now()})}}}))}detach(e){this.onEvent(new j(this.privId,e))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:f.Unknown,manufacturer:"Speech SDK",model:"PullStream",samplerate:this.privFormat.samplesPerSec,type:m.Stream})}onEvent(e){this.privEvents.onEvent(e),b.instance.onEvent(e)}}!function(e){e[e.Text=0]="Text",e[e.Binary=1]="Binary"}(ae||(ae={}));class ye{constructor(e,t,i,r){if(this.privBody=null,e===ae.Text&&t&&"string"!=typeof t)throw new I("Payload must be a string");if(e===ae.Binary&&t&&!(t instanceof ArrayBuffer))throw new I("Payload must be ArrayBuffer");switch(this.privMessageType=e,this.privBody=t,this.privHeaders=i||{},this.privId=r||u(),this.messageType){case ae.Binary:this.privSize=null!==this.binaryBody?this.binaryBody.byteLength:0;break;case ae.Text:this.privSize=this.textBody.length}}get messageType(){return this.privMessageType}get headers(){return this.privHeaders}get body(){return this.privBody}get textBody(){if(this.privMessageType===ae.Binary)throw new I("Not supported for binary message");return this.privBody}get binaryBody(){if(this.privMessageType===ae.Text)throw new I("Not supported for text message");return this.privBody}get id(){return this.privId}}class Ce extends C{constructor(e,t,i=d.Info){super(e,i),this.privJsonResult=t}get jsonString(){return this.privJsonResult}}class we extends C{constructor(e,t,i=d.Info){super(e,i),this.privConnectionId=t}get connectionId(){return this.privConnectionId}}class Re extends we{constructor(e,t,i){super("ConnectionStartEvent",e),this.privUri=t,this.privHeaders=i}get uri(){return this.privUri}get headers(){return this.privHeaders}}class Pe extends we{constructor(e){super("ConnectionEstablishedEvent",e)}}class Ie extends we{constructor(e,t,i){super("ConnectionClosedEvent",e,d.Debug),this.privReason=i,this.privStatusCode=t}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}class Ae extends we{constructor(e,t,i){super("ConnectionErrorEvent",e,d.Debug),this.privMessage=t,this.privType=i}get message(){return this.privMessage}get type(){return this.privType}}class Te extends we{constructor(e,t,i){super("ConnectionEstablishErrorEvent",e,d.Error),this.privStatusCode=t,this.privReason=i}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}class be extends we{constructor(e,t,i){super("ConnectionMessageReceivedEvent",e),this.privNetworkReceivedTime=t,this.privMessage=i}get networkReceivedTime(){return this.privNetworkReceivedTime}get message(){return this.privMessage}}class Ee extends we{constructor(e,t,i){super("ConnectionMessageSentEvent",e),this.privNetworkSentTime=t,this.privMessage=i}get networkSentTime(){return this.privNetworkSentTime}get message(){return this.privMessage}}!function(e){e[e.None=0]="None",e[e.Connected=1]="Connected",e[e.Connecting=2]="Connecting",e[e.Disconnected=3]="Disconnected"}(ce||(ce={})),function(e){e[e.Error=0]="Error",e[e.EndOfStream=1]="EndOfStream"}(pe||(pe={})),function(e){e[e.NoError=0]="NoError",e[e.AuthenticationFailure=1]="AuthenticationFailure",e[e.BadRequestParameters=2]="BadRequestParameters",e[e.TooManyRequests=3]="TooManyRequests",e[e.ConnectionFailure=4]="ConnectionFailure",e[e.ServiceTimeout=5]="ServiceTimeout",e[e.ServiceError=6]="ServiceError",e[e.RuntimeError=7]="RuntimeError",e[e.Forbidden=8]="Forbidden"}(he||(he={}));class ke{constructor(e){this.privResult=e}get result(){return this.privResult}}class xe{constructor(e,t,i,r){this.privResultId=e,this.privReason=t,this.privErrorDetails=i,this.privProperties=r}get resultId(){return this.privResultId}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get properties(){return this.privProperties}}class De extends xe{constructor(e,t,i,r,n,s){super(e,t,r,n),this.privAudioData=i,this.privAudioDuration=s}get audioData(){return this.privAudioData}get audioDuration(){return this.privAudioDuration}}!function(e){e[e.NoMatch=0]="NoMatch",e[e.Canceled=1]="Canceled",e[e.RecognizingSpeech=2]="RecognizingSpeech",e[e.RecognizedSpeech=3]="RecognizedSpeech",e[e.RecognizedKeyword=4]="RecognizedKeyword",e[e.RecognizingIntent=5]="RecognizingIntent",e[e.RecognizedIntent=6]="RecognizedIntent",e[e.TranslatingSpeech=7]="TranslatingSpeech",e[e.TranslatedSpeech=8]="TranslatedSpeech",e[e.SynthesizingAudio=9]="SynthesizingAudio",e[e.SynthesizingAudioCompleted=10]="SynthesizingAudioCompleted",e[e.SynthesizingAudioStarted=11]="SynthesizingAudioStarted",e[e.EnrollingVoiceProfile=12]="EnrollingVoiceProfile",e[e.EnrolledVoiceProfile=13]="EnrolledVoiceProfile",e[e.RecognizedSpeakers=14]="RecognizedSpeakers",e[e.RecognizedSpeaker=15]="RecognizedSpeaker",e[e.ResetVoiceProfile=16]="ResetVoiceProfile",e[e.DeletedVoiceProfile=17]="DeletedVoiceProfile",e[e.VoicesListRetrieved=18]="VoicesListRetrieved",e[e.TranslatingParticipantSpeech=19]="TranslatingParticipantSpeech",e[e.TranslatedParticipantSpeech=20]="TranslatedParticipantSpeech",e[e.TranslatedInstantMessage=21]="TranslatedInstantMessage",e[e.TranslatedParticipantInstantMessage=22]="TranslatedParticipantInstantMessage"}(ue||(ue={}));class Oe{constructor(){this.privKeys=[],this.privValues=[]}getProperty(e,t){let i;i="string"==typeof e?e:l[e];for(let e=0;e<this.privKeys.length;e++)if(this.privKeys[e]===i)return this.privValues[e];if(void 0!==t)return String(t)}setProperty(e,t){let i;i="string"==typeof e?e:l[e];for(let e=0;e<this.privKeys.length;e++)if(this.privKeys[e]===i)return void(this.privValues[e]=t);this.privKeys.push(i),this.privValues.push(t)}clone(){const e=new Oe;for(let t=0;t<this.privKeys.length;t++)e.privKeys.push(this.privKeys[t]),e.privValues.push(this.privValues[t]);return e}mergeTo(e){this.privKeys.forEach((t=>{if(void 0===e.getProperty(t,void 0)){const i=this.getProperty(t);e.setProperty(t,i)}}))}get keys(){return this.privKeys}}class Ne{constructor(e,t,i,r,n,s){this.privAudioOffset=e,this.privDuration=t,this.privText=i,this.privWordLength=r,this.privTextOffset=n,this.privBoundaryType=s}get audioOffset(){return this.privAudioOffset}get duration(){return this.privDuration}get text(){return this.privText}get wordLength(){return this.privWordLength}get textOffset(){return this.privTextOffset}get boundaryType(){return this.privBoundaryType}}class ze{constructor(e,t){this.privAudioOffset=e,this.privText=t}get audioOffset(){return this.privAudioOffset}get text(){return this.privText}}class Me{constructor(e,t,i){this.privAudioOffset=e,this.privVisemeId=t,this.privAnimation=i}get audioOffset(){return this.privAudioOffset}get visemeId(){return this.privVisemeId}get animation(){return this.privAnimation}}!function(e){e[e.Raw8Khz8BitMonoMULaw=0]="Raw8Khz8BitMonoMULaw",e[e.Riff16Khz16KbpsMonoSiren=1]="Riff16Khz16KbpsMonoSiren",e[e.Audio16Khz16KbpsMonoSiren=2]="Audio16Khz16KbpsMonoSiren",e[e.Audio16Khz32KBitRateMonoMp3=3]="Audio16Khz32KBitRateMonoMp3",e[e.Audio16Khz128KBitRateMonoMp3=4]="Audio16Khz128KBitRateMonoMp3",e[e.Audio16Khz64KBitRateMonoMp3=5]="Audio16Khz64KBitRateMonoMp3",e[e.Audio24Khz48KBitRateMonoMp3=6]="Audio24Khz48KBitRateMonoMp3",e[e.Audio24Khz96KBitRateMonoMp3=7]="Audio24Khz96KBitRateMonoMp3",e[e.Audio24Khz160KBitRateMonoMp3=8]="Audio24Khz160KBitRateMonoMp3",e[e.Raw16Khz16BitMonoTrueSilk=9]="Raw16Khz16BitMonoTrueSilk",e[e.Riff16Khz16BitMonoPcm=10]="Riff16Khz16BitMonoPcm",e[e.Riff8Khz16BitMonoPcm=11]="Riff8Khz16BitMonoPcm",e[e.Riff24Khz16BitMonoPcm=12]="Riff24Khz16BitMonoPcm",e[e.Riff8Khz8BitMonoMULaw=13]="Riff8Khz8BitMonoMULaw",e[e.Raw16Khz16BitMonoPcm=14]="Raw16Khz16BitMonoPcm",e[e.Raw24Khz16BitMonoPcm=15]="Raw24Khz16BitMonoPcm",e[e.Raw8Khz16BitMonoPcm=16]="Raw8Khz16BitMonoPcm",e[e.Ogg16Khz16BitMonoOpus=17]="Ogg16Khz16BitMonoOpus",e[e.Ogg24Khz16BitMonoOpus=18]="Ogg24Khz16BitMonoOpus",e[e.Raw48Khz16BitMonoPcm=19]="Raw48Khz16BitMonoPcm",e[e.Riff48Khz16BitMonoPcm=20]="Riff48Khz16BitMonoPcm",e[e.Audio48Khz96KBitRateMonoMp3=21]="Audio48Khz96KBitRateMonoMp3",e[e.Audio48Khz192KBitRateMonoMp3=22]="Audio48Khz192KBitRateMonoMp3",e[e.Ogg48Khz16BitMonoOpus=23]="Ogg48Khz16BitMonoOpus",e[e.Webm16Khz16BitMonoOpus=24]="Webm16Khz16BitMonoOpus",e[e.Webm24Khz16BitMonoOpus=25]="Webm24Khz16BitMonoOpus",e[e.Raw24Khz16BitMonoTrueSilk=26]="Raw24Khz16BitMonoTrueSilk",e[e.Raw8Khz8BitMonoALaw=27]="Raw8Khz8BitMonoALaw",e[e.Riff8Khz8BitMonoALaw=28]="Riff8Khz8BitMonoALaw",e[e.Webm24Khz16Bit24KbpsMonoOpus=29]="Webm24Khz16Bit24KbpsMonoOpus",e[e.Audio16Khz16Bit32KbpsMonoOpus=30]="Audio16Khz16Bit32KbpsMonoOpus",e[e.Audio24Khz16Bit48KbpsMonoOpus=31]="Audio24Khz16Bit48KbpsMonoOpus",e[e.Audio24Khz16Bit24KbpsMonoOpus=32]="Audio24Khz16Bit24KbpsMonoOpus",e[e.Raw22050Hz16BitMonoPcm=33]="Raw22050Hz16BitMonoPcm",e[e.Riff22050Hz16BitMonoPcm=34]="Riff22050Hz16BitMonoPcm",e[e.Raw44100Hz16BitMonoPcm=35]="Raw44100Hz16BitMonoPcm",e[e.Riff44100Hz16BitMonoPcm=36]="Riff44100Hz16BitMonoPcm"}(de||(de={}));class Le extends te{constructor(e,t,i,r,n,s,o,a,c){super(i,s,t,e),this.formatTag=e,this.avgBytesPerSec=r,this.blockAlign=n,this.priAudioFormatString=o,this.priRequestAudioFormatString=a,this.priHasHeader=c}static fromSpeechSynthesisOutputFormat(e){return void 0===e?Le.getDefaultOutputFormat():Le.fromSpeechSynthesisOutputFormatString(Le.SpeechSynthesisOutputFormatToString[e])}static fromSpeechSynthesisOutputFormatString(e){switch(e){case"raw-8khz-8bit-mono-mulaw":return new Le(Z.MuLaw,1,8e3,8e3,1,8,e,e,!1);case"riff-16khz-16kbps-mono-siren":return new Le(Z.Siren,1,16e3,2e3,40,0,e,"audio-16khz-16kbps-mono-siren",!0);case"audio-16khz-16kbps-mono-siren":return new Le(Z.Siren,1,16e3,2e3,40,0,e,e,!1);case"audio-16khz-32kbitrate-mono-mp3":return new Le(Z.MP3,1,16e3,4096,2,16,e,e,!1);case"audio-16khz-128kbitrate-mono-mp3":return new Le(Z.MP3,1,16e3,16384,2,16,e,e,!1);case"audio-16khz-64kbitrate-mono-mp3":return new Le(Z.MP3,1,16e3,8192,2,16,e,e,!1);case"audio-24khz-48kbitrate-mono-mp3":return new Le(Z.MP3,1,24e3,6144,2,16,e,e,!1);case"audio-24khz-96kbitrate-mono-mp3":return new Le(Z.MP3,1,24e3,12288,2,16,e,e,!1);case"audio-24khz-160kbitrate-mono-mp3":return new Le(Z.MP3,1,24e3,20480,2,16,e,e,!1);case"raw-16khz-16bit-mono-truesilk":return new Le(Z.SILKSkype,1,16e3,32e3,2,16,e,e,!1);case"riff-8khz-16bit-mono-pcm":return new Le(Z.PCM,1,8e3,16e3,2,16,e,"raw-8khz-16bit-mono-pcm",!0);case"riff-24khz-16bit-mono-pcm":return new Le(Z.PCM,1,24e3,48e3,2,16,e,"raw-24khz-16bit-mono-pcm",!0);case"riff-8khz-8bit-mono-mulaw":return new Le(Z.MuLaw,1,8e3,8e3,1,8,e,"raw-8khz-8bit-mono-mulaw",!0);case"raw-16khz-16bit-mono-pcm":return new Le(Z.PCM,1,16e3,32e3,2,16,e,"raw-16khz-16bit-mono-pcm",!1);case"raw-24khz-16bit-mono-pcm":return new Le(Z.PCM,1,24e3,48e3,2,16,e,"raw-24khz-16bit-mono-pcm",!1);case"raw-8khz-16bit-mono-pcm":return new Le(Z.PCM,1,8e3,16e3,2,16,e,"raw-8khz-16bit-mono-pcm",!1);case"ogg-16khz-16bit-mono-opus":return new Le(Z.OGG_OPUS,1,16e3,8192,2,16,e,e,!1);case"ogg-24khz-16bit-mono-opus":return new Le(Z.OGG_OPUS,1,24e3,8192,2,16,e,e,!1);case"raw-48khz-16bit-mono-pcm":return new Le(Z.PCM,1,48e3,96e3,2,16,e,"raw-48khz-16bit-mono-pcm",!1);case"riff-48khz-16bit-mono-pcm":return new Le(Z.PCM,1,48e3,96e3,2,16,e,"raw-48khz-16bit-mono-pcm",!0);case"audio-48khz-96kbitrate-mono-mp3":return new Le(Z.MP3,1,48e3,12288,2,16,e,e,!1);case"audio-48khz-192kbitrate-mono-mp3":return new Le(Z.MP3,1,48e3,24576,2,16,e,e,!1);case"ogg-48khz-16bit-mono-opus":return new Le(Z.OGG_OPUS,1,48e3,12e3,2,16,e,e,!1);case"webm-16khz-16bit-mono-opus":return new Le(Z.WEBM_OPUS,1,16e3,4e3,2,16,e,e,!1);case"webm-24khz-16bit-mono-opus":return new Le(Z.WEBM_OPUS,1,24e3,6e3,2,16,e,e,!1);case"webm-24khz-16bit-24kbps-mono-opus":return new Le(Z.WEBM_OPUS,1,24e3,3e3,2,16,e,e,!1);case"audio-16khz-16bit-32kbps-mono-opus":return new Le(Z.OPUS,1,16e3,4e3,2,16,e,e,!1);case"audio-24khz-16bit-48kbps-mono-opus":return new Le(Z.OPUS,1,24e3,6e3,2,16,e,e,!1);case"audio-24khz-16bit-24kbps-mono-opus":return new Le(Z.OPUS,1,24e3,3e3,2,16,e,e,!1);case"audio-24khz-16bit-mono-flac":return new Le(Z.FLAC,1,24e3,24e3,2,16,e,e,!1);case"audio-48khz-16bit-mono-flac":return new Le(Z.FLAC,1,48e3,3e4,2,16,e,e,!1);case"raw-24khz-16bit-mono-truesilk":return new Le(Z.SILKSkype,1,24e3,48e3,2,16,e,e,!1);case"raw-8khz-8bit-mono-alaw":return new Le(Z.ALaw,1,8e3,8e3,1,8,e,e,!1);case"riff-8khz-8bit-mono-alaw":return new Le(Z.ALaw,1,8e3,8e3,1,8,e,"raw-8khz-8bit-mono-alaw",!0);case"raw-22050hz-16bit-mono-pcm":return new Le(Z.PCM,1,22050,44100,2,16,e,e,!1);case"riff-22050hz-16bit-mono-pcm":return new Le(Z.PCM,1,22050,44100,2,16,e,"raw-22050hz-16bit-mono-pcm",!0);case"raw-44100hz-16bit-mono-pcm":return new Le(Z.PCM,1,44100,88200,2,16,e,e,!1);case"riff-44100hz-16bit-mono-pcm":return new Le(Z.PCM,1,44100,88200,2,16,e,"raw-44100hz-16bit-mono-pcm",!0);default:return new Le(Z.PCM,1,16e3,32e3,2,16,"riff-16khz-16bit-mono-pcm","raw-16khz-16bit-mono-pcm",!0)}}static getDefaultOutputFormat(){return Le.fromSpeechSynthesisOutputFormatString("undefined"!=typeof window?"audio-24khz-48kbitrate-mono-mp3":"riff-16khz-16bit-mono-pcm")}get hasHeader(){return this.priHasHeader}get header(){if(this.hasHeader)return this.privHeader}updateHeader(e){if(this.priHasHeader){const t=new DataView(this.privHeader);t.setUint32(4,e+this.privHeader.byteLength-8,!0),t.setUint32(40,e,!0)}}get requestAudioFormatString(){return this.priRequestAudioFormatString}}Le.SpeechSynthesisOutputFormatToString={[de.Raw8Khz8BitMonoMULaw]:"raw-8khz-8bit-mono-mulaw",[de.Riff16Khz16KbpsMonoSiren]:"riff-16khz-16kbps-mono-siren",[de.Audio16Khz16KbpsMonoSiren]:"audio-16khz-16kbps-mono-siren",[de.Audio16Khz32KBitRateMonoMp3]:"audio-16khz-32kbitrate-mono-mp3",[de.Audio16Khz128KBitRateMonoMp3]:"audio-16khz-128kbitrate-mono-mp3",[de.Audio16Khz64KBitRateMonoMp3]:"audio-16khz-64kbitrate-mono-mp3",[de.Audio24Khz48KBitRateMonoMp3]:"audio-24khz-48kbitrate-mono-mp3",[de.Audio24Khz96KBitRateMonoMp3]:"audio-24khz-96kbitrate-mono-mp3",[de.Audio24Khz160KBitRateMonoMp3]:"audio-24khz-160kbitrate-mono-mp3",[de.Raw16Khz16BitMonoTrueSilk]:"raw-16khz-16bit-mono-truesilk",[de.Riff16Khz16BitMonoPcm]:"riff-16khz-16bit-mono-pcm",[de.Riff8Khz16BitMonoPcm]:"riff-8khz-16bit-mono-pcm",[de.Riff24Khz16BitMonoPcm]:"riff-24khz-16bit-mono-pcm",[de.Riff8Khz8BitMonoMULaw]:"riff-8khz-8bit-mono-mulaw",[de.Raw16Khz16BitMonoPcm]:"raw-16khz-16bit-mono-pcm",[de.Raw24Khz16BitMonoPcm]:"raw-24khz-16bit-mono-pcm",[de.Raw8Khz16BitMonoPcm]:"raw-8khz-16bit-mono-pcm",[de.Ogg16Khz16BitMonoOpus]:"ogg-16khz-16bit-mono-opus",[de.Ogg24Khz16BitMonoOpus]:"ogg-24khz-16bit-mono-opus",[de.Raw48Khz16BitMonoPcm]:"raw-48khz-16bit-mono-pcm",[de.Riff48Khz16BitMonoPcm]:"riff-48khz-16bit-mono-pcm",[de.Audio48Khz96KBitRateMonoMp3]:"audio-48khz-96kbitrate-mono-mp3",[de.Audio48Khz192KBitRateMonoMp3]:"audio-48khz-192kbitrate-mono-mp3",[de.Ogg48Khz16BitMonoOpus]:"ogg-48khz-16bit-mono-opus",[de.Webm16Khz16BitMonoOpus]:"webm-16khz-16bit-mono-opus",[de.Webm24Khz16BitMonoOpus]:"webm-24khz-16bit-mono-opus",[de.Webm24Khz16Bit24KbpsMonoOpus]:"webm-24khz-16bit-24kbps-mono-opus",[de.Raw24Khz16BitMonoTrueSilk]:"raw-24khz-16bit-mono-truesilk",[de.Raw8Khz8BitMonoALaw]:"raw-8khz-8bit-mono-alaw",[de.Riff8Khz8BitMonoALaw]:"riff-8khz-8bit-mono-alaw",[de.Audio16Khz16Bit32KbpsMonoOpus]:"audio-16khz-16bit-32kbps-mono-opus",[de.Audio24Khz16Bit48KbpsMonoOpus]:"audio-24khz-16bit-48kbps-mono-opus",[de.Audio24Khz16Bit24KbpsMonoOpus]:"audio-24khz-16bit-24kbps-mono-opus",[de.Raw22050Hz16BitMonoPcm]:"raw-22050hz-16bit-mono-pcm",[de.Riff22050Hz16BitMonoPcm]:"riff-22050hz-16bit-mono-pcm",[de.Raw44100Hz16BitMonoPcm]:"raw-44100hz-16bit-mono-pcm",[de.Riff44100Hz16BitMonoPcm]:"riff-44100hz-16bit-mono-pcm"};var _e;class Be{constructor(){}static createPullStream(){return qe.create()}}class qe extends Be{static create(){return new Ue}}class Ue extends qe{constructor(){super(),this.privId=u(),this.privStream=new X}set format(e){null==e&&(this.privFormat=Le.getDefaultOutputFormat()),this.privFormat=e}get format(){return this.privFormat}get isClosed(){return this.privStream.isClosed}id(){return this.privId}read(e){return t=this,i=void 0,n=function*(){const t=new Int8Array(e);let i=0;if(void 0!==this.privLastChunkView){if(this.privLastChunkView.length>e.byteLength)return t.set(this.privLastChunkView.slice(0,e.byteLength)),this.privLastChunkView=this.privLastChunkView.slice(e.byteLength),Promise.resolve(e.byteLength);t.set(this.privLastChunkView),i=this.privLastChunkView.length,this.privLastChunkView=void 0}for(;i<e.byteLength&&!this.privStream.isReadEnded;){const r=yield this.privStream.read();if(void 0===r||r.isEnd)this.privStream.readEnded();else{let n;r.buffer.byteLength>e.byteLength-i?(n=r.buffer.slice(0,e.byteLength-i),this.privLastChunkView=new Int8Array(r.buffer.slice(e.byteLength-i))):n=r.buffer,t.set(new Int8Array(n),i),i+=n.byteLength}}return i},new((r=void 0)||(r=Promise))((function(e,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(o,a)}c((n=n.apply(t,i||[])).next())}));var t,i,r,n}write(e){w.throwIfNullOrUndefined(this.privStream,"must set format before writing"),this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}}class Fe extends Be{constructor(){super()}static create(e){return new Ke(e)}}class Ke extends Fe{constructor(e){super(),this.privId=u(),this.privCallback=e}set format(e){}write(e){this.privCallback.write&&this.privCallback.write(e)}close(){this.privCallback.close&&this.privCallback.close()}id(){return this.privId}}!function(e){e.WordBoundary="WordBoundary",e.Bookmark="Bookmark",e.Viseme="Viseme",e.SentenceBoundary="SentenceBoundary",e.SessionEnd="SessionEnd"}(_e||(_e={}));class He{constructor(e){this.privSynthesisAudioMetadata=JSON.parse(e)}static fromJSON(e){return new He(e)}get Metadata(){return this.privSynthesisAudioMetadata.Metadata}}class We extends C{constructor(e,t,i=d.Info){super(e,i),this.privRequestId=t}get requestId(){return this.privRequestId}}class je extends We{constructor(e,t,i){super("SynthesisTriggeredEvent",e),this.privSessionAudioDestinationId=t,this.privTurnAudioDestinationId=i}get audioSessionDestinationId(){return this.privSessionAudioDestinationId}get audioTurnDestinationId(){return this.privTurnAudioDestinationId}}class Je extends We{constructor(e,t){super("ConnectingToSynthesisServiceEvent",e),this.privAuthFetchEventId=t}get authFetchEventId(){return this.privAuthFetchEventId}}class Ve extends We{constructor(e,t){super("SynthesisStartedEvent",e),this.privAuthFetchEventId=t}get authFetchEventId(){return this.privAuthFetchEventId}}var Ge=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class $e{constructor(){this.privIsDisposed=!1,this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!1,this.privBytesReceived=0,this.privInTurn=!1,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privRequestId=u(),this.privTurnDeferral=new M,this.privTurnDeferral.resolve()}get requestId(){return this.privRequestId}get streamId(){return this.privStreamId}set streamId(e){this.privStreamId=e}get audioOutputFormat(){return this.privAudioOutputFormat}set audioOutputFormat(e){this.privAudioOutputFormat=e}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSynthesisEnded(){return this.privIsSynthesisEnded}get isSynthesizing(){return this.privIsSynthesizing}get currentTextOffset(){return this.privTextOffset}get currentSentenceOffset(){return this.privSentenceOffset}get bytesReceived(){return this.privBytesReceived}get audioDuration(){return this.privAudioDuration}getAllReceivedAudio(){return Ge(this,void 0,void 0,(function*(){return this.privReceivedAudio?Promise.resolve(this.privReceivedAudio):this.privIsSynthesisEnded?(yield this.readAllAudioFromStream(),Promise.resolve(this.privReceivedAudio)):null}))}getAllReceivedAudioWithHeader(){return Ge(this,void 0,void 0,(function*(){if(this.privReceivedAudioWithHeader)return this.privReceivedAudioWithHeader;if(!this.privIsSynthesisEnded)return null;if(this.audioOutputFormat.hasHeader){const e=yield this.getAllReceivedAudio();return this.privReceivedAudioWithHeader=ot.addHeader(e,this.audioOutputFormat),this.privReceivedAudioWithHeader}return this.getAllReceivedAudio()}))}startNewSynthesis(e,t,i,r){this.privIsSynthesisEnded=!1,this.privIsSynthesizing=!0,this.privRequestId=e,this.privRawText=t,this.privIsSSML=i,this.privAudioOutputStream=new Ue,this.privAudioOutputStream.format=this.privAudioOutputFormat,this.privReceivedAudio=null,this.privReceivedAudioWithHeader=null,this.privBytesReceived=0,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privPartialVisemeAnimation="",void 0!==r&&(this.privTurnAudioDestination=r,this.privTurnAudioDestination.format=this.privAudioOutputFormat),this.onEvent(new je(this.requestId,void 0,void 0===r?void 0:r.id()))}onPreConnectionStart(e){this.privAuthFetchEventId=e,this.onEvent(new Je(this.privRequestId,this.privAuthFetchEventId))}onAuthCompleted(e){e&&this.onComplete()}onConnectionEstablishCompleted(e){if(200===e)return this.onEvent(new Ve(this.requestId,this.privAuthFetchEventId)),void(this.privBytesReceived=0);403===e&&this.onComplete()}onServiceResponseMessage(e){const t=JSON.parse(e);this.streamId=t.audio.streamId}onServiceTurnEndResponse(){this.privInTurn=!1,this.privTurnDeferral.resolve(),this.onComplete()}onServiceTurnStartResponse(){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch((()=>{}))),this.privInTurn=!0,this.privTurnDeferral=new M}onAudioChunkReceived(e){this.isSynthesizing&&(this.privAudioOutputStream.write(e),this.privBytesReceived+=e.byteLength,void 0!==this.privTurnAudioDestination&&this.privTurnAudioDestination.write(e))}onTextBoundaryEvent(e){this.updateTextOffset(e.Data.text.Text,e.Type)}onVisemeMetadataReceived(e){void 0!==e.Data.AnimationChunk&&(this.privPartialVisemeAnimation+=e.Data.AnimationChunk)}onSessionEnd(e){this.privAudioDuration=e.Data.Offset}dispose(){this.privIsDisposed||(this.privIsDisposed=!0)}onStopSynthesizing(){this.onComplete()}getAndClearVisemeAnimation(){const e=this.privPartialVisemeAnimation;return this.privPartialVisemeAnimation="",e}onEvent(e){b.instance.onEvent(e)}static isXmlTag(e){return e.length>=2&&"<"===e[0]&&">"===e[e.length-1]}updateTextOffset(e,t){t===_e.WordBoundary?(this.privTextOffset=this.privRawText.indexOf(e,this.privNextSearchTextIndex),this.privTextOffset>=0&&(this.privNextSearchTextIndex=this.privTextOffset+e.length,this.privIsSSML&&this.withinXmlTag(this.privTextOffset)&&!$e.isXmlTag(e)&&this.updateTextOffset(e,t))):(this.privSentenceOffset=this.privRawText.indexOf(e,this.privNextSearchSentenceIndex),this.privSentenceOffset>=0&&(this.privNextSearchSentenceIndex=this.privSentenceOffset+e.length,this.privIsSSML&&this.withinXmlTag(this.privSentenceOffset)&&!$e.isXmlTag(e)&&this.updateTextOffset(e,t)))}onComplete(){this.privIsSynthesizing&&(this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!0,this.privAudioOutputStream.close(),this.privInTurn=!1,void 0!==this.privTurnAudioDestination&&(this.privTurnAudioDestination.close(),this.privTurnAudioDestination=void 0))}readAllAudioFromStream(){return Ge(this,void 0,void 0,(function*(){if(this.privIsSynthesisEnded){this.privReceivedAudio=new ArrayBuffer(this.bytesReceived);try{yield this.privAudioOutputStream.read(this.privReceivedAudio)}catch(e){this.privReceivedAudio=new ArrayBuffer(0)}}}))}withinXmlTag(e){return this.privRawText.indexOf("<",e+1)>this.privRawText.indexOf(">",e+1)}}class Qe{constructor(e){this.privContext={},this.privSpeechSynthesizer=e}setSection(e,t){this.privContext[e]=t}set audioOutputFormat(e){this.privAudioOutputFormat=e}toJSON(){const e=this.buildSynthesisContext();return this.setSection("synthesis",e),JSON.stringify(this.privContext)}buildSynthesisContext(){return{audio:{metadataOptions:{bookmarkEnabled:!!this.privSpeechSynthesizer.bookmarkReached,punctuationBoundaryEnabled:this.privSpeechSynthesizer.properties.getProperty(l.SpeechServiceResponse_RequestPunctuationBoundary,!!this.privSpeechSynthesizer.wordBoundary),sentenceBoundaryEnabled:this.privSpeechSynthesizer.properties.getProperty(l.SpeechServiceResponse_RequestSentenceBoundary,!1),sessionEndEnabled:!0,visemeEnabled:!!this.privSpeechSynthesizer.visemeReceived,wordBoundaryEnabled:this.privSpeechSynthesizer.properties.getProperty(l.SpeechServiceResponse_RequestWordBoundary,!!this.privSpeechSynthesizer.wordBoundary)},outputFormat:this.privAudioOutputFormat.requestAudioFormatString},language:{autoDetection:this.privSpeechSynthesizer.autoDetectSourceLanguage}}}}class Ze{toJsonString(){return JSON.stringify(this.iPrivConfig)}get(){return this.iPrivConfig}set(e){this.iPrivConfig=e}}const Xe="OutputFormat",Ye="CancellationErrorCode",et="ServiceProperties",tt="ForceDictation",it="OpenRange";class rt{}rt.AuthKey="Ocp-Apim-Subscription-Key",rt.Authorization="Authorization",rt.SpIDAuthKey="Apim-Subscription-Id",rt.ConnectionId="X-ConnectionId",rt.ContentType="Content-Type",rt.CustomCommandsAppId="X-CommandsAppId",rt.Path="Path",rt.RequestId="X-RequestId",rt.RequestStreamId="X-StreamId",rt.RequestTimestamp="X-Timestamp";class nt extends ye{constructor(e,t,i,r,n,s,o,a){if(!t)throw new P("path");if(!i)throw new P("requestId");const c={};if(c[rt.Path]=t,c[rt.RequestId]=i,c[rt.RequestTimestamp]=(new Date).toISOString(),r&&(c[rt.ContentType]=r),s&&(c[rt.RequestStreamId]=s),o)for(const e in o)e&&(c[e]=o[e]);a?super(e,n,c,a):super(e,n,c),this.privPath=t,this.privRequestId=i,this.privContentType=r,this.privStreamId=s,this.privAdditionalHeaders=o}get path(){return this.privPath}get requestId(){return this.privRequestId}get contentType(){return this.privContentType}get streamId(){return this.privStreamId}get additionalHeaders(){return this.privAdditionalHeaders}static fromConnectionMessage(e){let t=null,i=null,r=null,n=null;const s={};if(e.headers)for(const o in e.headers)o&&(o.toLowerCase()===rt.Path.toLowerCase()?t=e.headers[o]:o.toLowerCase()===rt.RequestId.toLowerCase()?i=e.headers[o]:o.toLowerCase()===rt.ContentType.toLowerCase()?r=e.headers[o]:o.toLowerCase()===rt.RequestStreamId.toLowerCase()?n=e.headers[o]:s[o]=e.headers[o]);return new nt(e.messageType,t,i,r,e.body,n,s,e.id)}}var st=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class ot{constructor(e,t,i,r,n){if(this.speakOverride=void 0,this.receiveMessageOverride=void 0,this.connectImplOverride=void 0,this.configConnectionOverride=void 0,this.privConnectionConfigurationPromise=void 0,!e)throw new P("authentication");if(!t)throw new P("connectionFactory");if(!i)throw new P("synthesizerConfig");this.privAuthentication=e,this.privConnectionFactory=t,this.privSynthesizerConfig=i,this.privIsDisposed=!1,this.privSpeechSynthesizer=r,this.privSessionAudioDestination=n,this.privSynthesisTurn=new $e,this.privConnectionEvents=new T,this.privServiceEvents=new T,this.privSynthesisContext=new Qe(this.privSpeechSynthesizer),this.privAgentConfig=new Ze,this.connectionEvents.attach((e=>{if("ConnectionClosedEvent"===e.name){const t=e;1e3!==t.statusCode&&this.cancelSynthesisLocal(pe.Error,1007===t.statusCode?he.BadRequestParameters:he.ConnectionFailure,`${t.reason} websocket error code: ${t.statusCode}`)}}))}get synthesisContext(){return this.privSynthesisContext}get agentConfig(){return this.privAgentConfig}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}set activityTemplate(e){this.privActivityTemplate=e}get activityTemplate(){return this.privActivityTemplate}set audioOutputFormat(e){this.privAudioOutputFormat=e,this.privSynthesisTurn.audioOutputFormat=e,void 0!==this.privSessionAudioDestination&&(this.privSessionAudioDestination.format=e),void 0!==this.synthesisContext&&(this.synthesisContext.audioOutputFormat=e)}static addHeader(e,t){if(!t.hasHeader)return e;t.updateHeader(e.byteLength);const i=new Uint8Array(e.byteLength+t.header.byteLength);return i.set(new Uint8Array(t.header),0),i.set(new Uint8Array(e),t.header.byteLength),i.buffer}isDisposed(){return this.privIsDisposed}dispose(e){return st(this,void 0,void 0,(function*(){if(this.privIsDisposed=!0,void 0!==this.privSessionAudioDestination&&this.privSessionAudioDestination.close(),void 0!==this.privConnectionConfigurationPromise){const t=yield this.privConnectionConfigurationPromise;yield t.dispose(e)}}))}connect(){return st(this,void 0,void 0,(function*(){yield this.connectImpl()}))}sendNetworkMessage(e,t){return st(this,void 0,void 0,(function*(){const i="string"==typeof t?ae.Text:ae.Binary,r="string"==typeof t?"application/json":"";return(yield this.fetchConnection()).send(new nt(i,e,this.privSynthesisTurn.requestId,r,t))}))}Speak(e,t,i,r,n,s){return st(this,void 0,void 0,(function*(){let o;if(o=t?e:this.privSpeechSynthesizer.buildSsml(e),void 0!==this.speakOverride)return this.speakOverride(o,i,r,n);this.privSuccessCallback=r,this.privErrorCallback=n,this.privSynthesisTurn.startNewSynthesis(i,e,t,s);try{yield this.connectImpl();const e=yield this.fetchConnection();yield this.sendSynthesisContext(e),yield this.sendSsmlMessage(e,o,i);const t=new ke(new De(i,ue.SynthesizingAudioStarted));this.privSpeechSynthesizer.synthesisStarted&&this.privSpeechSynthesizer.synthesisStarted(this.privSpeechSynthesizer,t),this.receiveMessage()}catch(e){return this.cancelSynthesisLocal(pe.Error,he.ConnectionFailure,e),Promise.reject(e)}}))}cancelSynthesis(e,t,i,r){const n=new Oe;n.setProperty(Ye,he[i]);const s=new De(e,ue.Canceled,void 0,r,n);if(this.privSpeechSynthesizer.SynthesisCanceled){const e=new ke(s);try{this.privSpeechSynthesizer.SynthesisCanceled(this.privSpeechSynthesizer,e)}catch(e){}}if(this.privSuccessCallback)try{this.privSuccessCallback(s)}catch(e){}}cancelSynthesisLocal(e,t,i){this.privSynthesisTurn.isSynthesizing&&(this.privSynthesisTurn.onStopSynthesizing(),this.cancelSynthesis(this.privSynthesisTurn.requestId,e,t,i))}processTypeSpecificMessages(e){return!0}receiveMessage(){return st(this,void 0,void 0,(function*(){try{const e=yield this.fetchConnection(),t=yield e.read();if(void 0!==this.receiveMessageOverride)return this.receiveMessageOverride();if(this.privIsDisposed)return;if(!t)return this.privSynthesisTurn.isSynthesizing?this.receiveMessage():void 0;const i=nt.fromConnectionMessage(t);if(i.requestId.toLowerCase()===this.privSynthesisTurn.requestId.toLowerCase())switch(i.path.toLowerCase()){case"turn.start":this.privSynthesisTurn.onServiceTurnStartResponse();break;case"response":this.privSynthesisTurn.onServiceResponseMessage(i.textBody);break;case"audio":if(this.privSynthesisTurn.streamId.toLowerCase()===i.streamId.toLowerCase()&&i.binaryBody){if(this.privSynthesisTurn.onAudioChunkReceived(i.binaryBody),this.privSpeechSynthesizer.synthesizing)try{const e=ot.addHeader(i.binaryBody,this.privSynthesisTurn.audioOutputFormat),t=new ke(new De(this.privSynthesisTurn.requestId,ue.SynthesizingAudio,e));this.privSpeechSynthesizer.synthesizing(this.privSpeechSynthesizer,t)}catch(e){}void 0!==this.privSessionAudioDestination&&this.privSessionAudioDestination.write(i.binaryBody)}break;case"audio.metadata":const e=He.fromJSON(i.textBody).Metadata;for(const t of e)switch(t.Type){case _e.WordBoundary:case _e.SentenceBoundary:this.privSynthesisTurn.onTextBoundaryEvent(t);const e=new Ne(t.Data.Offset,t.Data.Duration,t.Data.text.Text,t.Data.text.Length,t.Type===_e.WordBoundary?this.privSynthesisTurn.currentTextOffset:this.privSynthesisTurn.currentSentenceOffset,t.Data.text.BoundaryType);if(this.privSpeechSynthesizer.wordBoundary)try{this.privSpeechSynthesizer.wordBoundary(this.privSpeechSynthesizer,e)}catch(e){}break;case _e.Bookmark:const i=new ze(t.Data.Offset,t.Data.Bookmark);if(this.privSpeechSynthesizer.bookmarkReached)try{this.privSpeechSynthesizer.bookmarkReached(this.privSpeechSynthesizer,i)}catch(e){}break;case _e.Viseme:if(this.privSynthesisTurn.onVisemeMetadataReceived(t),t.Data.IsLastAnimation){const e=new Me(t.Data.Offset,t.Data.VisemeId,this.privSynthesisTurn.getAndClearVisemeAnimation());if(this.privSpeechSynthesizer.visemeReceived)try{this.privSpeechSynthesizer.visemeReceived(this.privSpeechSynthesizer,e)}catch(e){}}break;case _e.SessionEnd:this.privSynthesisTurn.onSessionEnd(t)}break;case"turn.end":let t;this.privSynthesisTurn.onServiceTurnEndResponse();try{const e=yield this.privSynthesisTurn.getAllReceivedAudioWithHeader();t=new De(this.privSynthesisTurn.requestId,ue.SynthesizingAudioCompleted,e,void 0,void 0,this.privSynthesisTurn.audioDuration),this.privSuccessCallback&&this.privSuccessCallback(t)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}if(this.privSpeechSynthesizer.synthesisCompleted)try{this.privSpeechSynthesizer.synthesisCompleted(this.privSpeechSynthesizer,new ke(t))}catch(e){}break;default:this.processTypeSpecificMessages(i)||this.privServiceEvents&&this.serviceEvents.onEvent(new Ce(i.path.toLowerCase(),i.textBody))}return this.receiveMessage()}catch(e){}}))}sendSynthesisContext(e){const t=this.synthesisContext.toJSON();if(t)return e.send(new nt(ae.Text,"synthesis.context",this.privSynthesisTurn.requestId,"application/json",t))}connectImpl(e=!1){if(null!=this.privConnectionPromise)return this.privConnectionPromise.then((e=>e.state()===ce.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()):this.privConnectionPromise),(()=>(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl())));this.privAuthFetchEventId=u(),this.privConnectionId=u(),this.privSynthesisTurn.onPreConnectionStart(this.privAuthFetchEventId);const t=e?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId);return this.privConnectionPromise=t.then((t=>st(this,void 0,void 0,(function*(){this.privSynthesisTurn.onAuthCompleted(!1);const i=this.privConnectionFactory.create(this.privSynthesizerConfig,t,this.privConnectionId);i.events.attach((e=>{this.connectionEvents.onEvent(e)}));const r=yield i.open();return 200===r.statusCode?(this.privSynthesisTurn.onConnectionEstablishCompleted(r.statusCode),Promise.resolve(i)):403!==r.statusCode||e?(this.privSynthesisTurn.onConnectionEstablishCompleted(r.statusCode),Promise.reject(`Unable to contact server. StatusCode: ${r.statusCode}, ${this.privSynthesizerConfig.parameters.getProperty(l.SpeechServiceConnection_Endpoint)} Reason: ${r.reason}`)):this.connectImpl(!0)}))),(e=>{throw this.privSynthesisTurn.onAuthCompleted(!0),new Error(e)})),this.privConnectionPromise.catch((()=>{})),this.privConnectionPromise}sendSpeechServiceConfig(e,t){if(t)return e.send(new nt(ae.Text,"speech.config",this.privSynthesisTurn.requestId,"application/json",t))}sendSsmlMessage(e,t,i){return e.send(new nt(ae.Text,"ssml",i,"application/ssml+xml",t))}fetchConnection(){return st(this,void 0,void 0,(function*(){return void 0!==this.privConnectionConfigurationPromise?this.privConnectionConfigurationPromise.then((e=>e.state()===ce.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection()):this.privConnectionConfigurationPromise),(()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection()))):(this.privConnectionConfigurationPromise=this.configureConnection(),yield this.privConnectionConfigurationPromise)}))}configureConnection(){return st(this,void 0,void 0,(function*(){const e=yield this.connectImpl();return void 0!==this.configConnectionOverride?this.configConnectionOverride(e):(yield this.sendSpeechServiceConfig(e,this.privSynthesizerConfig.SpeechServiceConfig.serialize()),e)}))}}ot.telemetryDataEnabled=!0;class at extends C{constructor(e){super("BackgroundEvent",d.Error),this.privError=e}get error(){return this.privError}}var ct=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};const pt={[Z.PCM]:"audio/wav",[Z.MuLaw]:"audio/x-wav",[Z.MP3]:"audio/mpeg",[Z.OGG_OPUS]:"audio/ogg",[Z.WEBM_OPUS]:"audio/webm; codecs=opus",[Z.ALaw]:"audio/x-wav",[Z.FLAC]:"audio/flac"};class ht{constructor(e){this.privPlaybackStarted=!1,this.privAppendingToBuffer=!1,this.privMediaSourceOpened=!1,this.privBytesReceived=0,this.privId=e||u(),this.privIsPaused=!1,this.privIsClosed=!1}id(){return this.privId}write(e,t,i){void 0!==this.privAudioBuffer?(this.privAudioBuffer.push(e),this.updateSourceBuffer().then((()=>{t&&t()}),(e=>{i&&i(e)}))):void 0!==this.privAudioOutputStream&&(this.privAudioOutputStream.write(e),this.privBytesReceived+=e.byteLength)}close(e,t){if(this.privIsClosed=!0,void 0!==this.privSourceBuffer)this.handleSourceBufferUpdateEnd().then((()=>{e&&e()}),(e=>{t&&t(e)}));else if(void 0!==this.privAudioOutputStream&&"undefined"!=typeof window)if(this.privFormat.formatTag!==Z.PCM&&this.privFormat.formatTag!==Z.MuLaw&&this.privFormat.formatTag!==Z.ALaw||!1!==this.privFormat.hasHeader){let i=new ArrayBuffer(this.privBytesReceived);this.privAudioOutputStream.read(i).then((()=>{i=ot.addHeader(i,this.privFormat);const r=new Blob([i],{type:pt[this.privFormat.formatTag]});this.privAudio.src=window.URL.createObjectURL(r),this.notifyPlayback().then((()=>{e&&e()}),(e=>{t&&t(e)}))}),(e=>{t&&t(e)}))}else console.warn("Play back is not supported for raw PCM, mulaw or alaw format without header."),this.onAudioEnd&&this.onAudioEnd(this);else this.onAudioEnd&&this.onAudioEnd(this)}set format(e){if("undefined"!=typeof AudioContext||"undefined"!=typeof window&&void 0!==window.webkitAudioContext){this.privFormat=e;const t=pt[this.privFormat.formatTag];void 0===t?console.warn(`Unknown mimeType for format ${Z[this.privFormat.formatTag]}; playback is not supported.`):"undefined"!=typeof MediaSource&&MediaSource.isTypeSupported(t)?(this.privAudio=new Audio,this.privAudioBuffer=[],this.privMediaSource=new MediaSource,this.privAudio.src=URL.createObjectURL(this.privMediaSource),this.privAudio.load(),this.privMediaSource.onsourceopen=()=>{this.privMediaSourceOpened=!0,this.privMediaSource.duration=1800,this.privSourceBuffer=this.privMediaSource.addSourceBuffer(t),this.privSourceBuffer.onupdate=()=>{this.updateSourceBuffer().catch((e=>{b.instance.onEvent(new at(e))}))},this.privSourceBuffer.onupdateend=()=>{this.handleSourceBufferUpdateEnd().catch((e=>{b.instance.onEvent(new at(e))}))},this.privSourceBuffer.onupdatestart=()=>{this.privAppendingToBuffer=!1}},this.updateSourceBuffer().catch((e=>{b.instance.onEvent(new at(e))}))):(console.warn(`Format ${Z[this.privFormat.formatTag]} could not be played by MSE, streaming playback is not enabled.`),this.privAudioOutputStream=new Ue,this.privAudioOutputStream.format=this.privFormat,this.privAudio=new Audio)}}get volume(){var e,t;return null!==(t=null===(e=this.privAudio)||void 0===e?void 0:e.volume)&&void 0!==t?t:-1}set volume(e){this.privAudio&&(this.privAudio.volume=e)}mute(){this.privAudio&&(this.privAudio.muted=!0)}unmute(){this.privAudio&&(this.privAudio.muted=!1)}get isClosed(){return this.privIsClosed}get currentTime(){return void 0!==this.privAudio?this.privAudio.currentTime:-1}pause(){this.privIsPaused||void 0===this.privAudio||(this.privAudio.pause(),this.privIsPaused=!0)}resume(e,t){this.privIsPaused&&void 0!==this.privAudio&&(this.privAudio.play().then((()=>{e&&e()}),(e=>{t&&t(e)})),this.privIsPaused=!1)}get internalAudio(){return this.privAudio}updateSourceBuffer(){return ct(this,void 0,void 0,(function*(){if(void 0!==this.privAudioBuffer&&this.privAudioBuffer.length>0&&this.sourceBufferAvailable()){this.privAppendingToBuffer=!0;const e=this.privAudioBuffer.shift();try{this.privSourceBuffer.appendBuffer(e)}catch(t){return this.privAudioBuffer.unshift(e),void console.log("buffer filled, pausing addition of binaries until space is made")}yield this.notifyPlayback()}else this.canEndStream()&&(yield this.handleSourceBufferUpdateEnd())}))}handleSourceBufferUpdateEnd(){return ct(this,void 0,void 0,(function*(){this.canEndStream()&&this.sourceBufferAvailable()&&(this.privMediaSource.endOfStream(),yield this.notifyPlayback())}))}notifyPlayback(){return ct(this,void 0,void 0,(function*(){this.privPlaybackStarted||void 0===this.privAudio||(this.privPlaybackStarted=!0,this.onAudioStart&&this.onAudioStart(this),this.privAudio.onended=()=>{this.onAudioEnd&&this.onAudioEnd(this)},this.privIsPaused||(yield this.privAudio.play()))}))}canEndStream(){return this.isClosed&&void 0!==this.privSourceBuffer&&0===this.privAudioBuffer.length&&this.privMediaSourceOpened&&!this.privAppendingToBuffer&&"open"===this.privMediaSource.readyState}sourceBufferAvailable(){return void 0!==this.privSourceBuffer&&!this.privSourceBuffer.updating}}class ut{}var dt,lt,vt,gt=i(592);class ft{constructor(e){w.throwIfNullOrUndefined(gt.openSync,"\nFile System access not available, please use Push or PullAudioOutputStream"),this.privFd=gt.openSync(e,"w")}set format(e){w.throwIfNotUndefined(this.privAudioFormat,"format is already set"),this.privAudioFormat=e;let t=0;this.privAudioFormat.hasHeader&&(t=this.privAudioFormat.header.byteLength),void 0!==this.privFd&&(this.privWriteStream=gt.createWriteStream("",{fd:this.privFd,start:t,autoClose:!1}))}write(e){w.throwIfNullOrUndefined(this.privAudioFormat,"must set format before writing."),void 0!==this.privWriteStream&&this.privWriteStream.write(new Uint8Array(e.slice(0)))}close(){void 0!==this.privFd&&(this.privWriteStream.on("finish",(()=>{this.privAudioFormat.hasHeader&&(this.privAudioFormat.updateHeader(this.privWriteStream.bytesWritten),gt.writeSync(this.privFd,new Int8Array(this.privAudioFormat.header),0,this.privAudioFormat.header.byteLength,0)),gt.closeSync(this.privFd),this.privFd=void 0})),this.privWriteStream.end())}id(){return this.privId}}class mt{static fromDefaultMicrophoneInput(){const e=new k(!0);return new St(new re(e))}static fromMicrophoneInput(e){const t=new k(!0);return new St(new re(t,e))}static fromWavFileInput(e,t="unnamedBuffer.wav"){return new St(new se(e,t))}static fromStreamInput(e){if(e instanceof oe)return new St(new Se(e));if(e instanceof ve)return new St(e);if("undefined"!=typeof MediaStream&&e instanceof MediaStream){const t=new k(!1);return new St(new re(t,null,null,e))}throw new Error("Not Supported Type")}static fromDefaultSpeakerOutput(){return new yt(new ht)}static fromSpeakerOutput(e){if(void 0===e)return mt.fromDefaultSpeakerOutput();if(e instanceof ht)return new yt(e);throw new Error("Not Supported Type")}static fromAudioFileOutput(e){return new yt(new ft(e))}static fromStreamOutput(e){if(e instanceof ut)return new yt(new Ke(e));if(e instanceof Fe)return new yt(e);if(e instanceof qe)return new yt(e);throw new Error("Not Supported Type")}}class St extends mt{constructor(e){super(),this.privSource=e}get format(){return this.privSource.format}close(e,t){this.privSource.turnOff().then((()=>{e&&e()}),(e=>{t&&t(e)}))}id(){return this.privSource.id()}turnOn(){return this.privSource.turnOn()}attach(e){return this.privSource.attach(e)}detach(e){return this.privSource.detach(e)}turnOff(){return this.privSource.turnOff()}get events(){return this.privSource.events}setProperty(e,t){if(w.throwIfNull(t,"value"),void 0===this.privSource.setProperty)throw new Error("This AudioConfig instance does not support setting properties.");this.privSource.setProperty(e,t)}getProperty(e,t){if(void 0!==this.privSource.getProperty)return this.privSource.getProperty(e,t);throw new Error("This AudioConfig instance does not support getting properties.")}get deviceInfo(){return this.privSource.deviceInfo}}class yt extends mt{constructor(e){super(),this.privDestination=e}set format(e){this.privDestination.format=e}write(e){this.privDestination.write(e)}close(){this.privDestination.close()}id(){return this.privDestination.id()}setProperty(){throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(){throw new Error("This AudioConfig instance does not support getting properties.")}}class Ct{constructor(){this.privDisposed=!1}static fromFile(e){throw w.throwIfFileDoesNotExist(e,"fileName"),new Error("Not yet implemented.")}static fromStream(e){throw w.throwIfNull(e,"file"),new Error("Not yet implemented.")}close(){this.privDisposed||(this.privDisposed=!0)}}class wt{constructor(e){this.privSessionId=e}get sessionId(){return this.privSessionId}}class Rt extends wt{constructor(e,t){super(t),this.privOffset=e}get offset(){return this.privOffset}}!function(e){e[e.Simple=0]="Simple",e[e.Detailed=1]="Detailed"}(dt||(dt={}));class Pt extends Rt{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}}class It{constructor(e,t,i,r,n,s,o,a,c,p){this.privResultId=e,this.privReason=t,this.privText=i,this.privDuration=r,this.privOffset=n,this.privLanguage=s,this.privLanguageDetectionConfidence=o,this.privErrorDetails=a,this.privJson=c,this.privProperties=p}get resultId(){return this.privResultId}get reason(){return this.privReason}get text(){return this.privText}get duration(){return this.privDuration}get offset(){return this.privOffset}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}get errorDetails(){return this.privErrorDetails}get json(){return this.privJson}get properties(){return this.privProperties}}class At extends It{constructor(e,t,i,r,n,s,o,a,c,p,h){super(e,t,i,r,n,s,o,c,p,h),this.privSpeakerId=a}get speakerId(){return this.privSpeakerId}}class Tt extends At{constructor(e,t,i,r,n,s,o,a,c,p,h){super(t,i,r,n,s,o,a,void 0,c,p,h),this.privIntentId=e}get intentId(){return this.privIntentId}}class bt{constructor(){}static fromEndpoint(e){w.throwIfNull(e,"uri"),w.throwIfNullOrWhitespace(e.hostname,"uri");const t=new Et,i=e.host.indexOf(".");if(-1===i)throw new Error("Could not determine region from endpoint");t.region=e.host.substr(0,i);const r=e.pathname.lastIndexOf("/")+1;if(-1===r)throw new Error("Could not determine appId from endpoint");if(t.appId=e.pathname.substr(r),t.subscriptionKey=e.searchParams.get("subscription-key"),void 0===t.subscriptionKey)throw new Error("Could not determine subscription key from endpoint");return t}static fromAppId(e){w.throwIfNullOrWhitespace(e,"appId");const t=new Et;return t.appId=e,t}static fromSubscription(e,t,i){w.throwIfNullOrWhitespace(e,"subscriptionKey"),w.throwIfNullOrWhitespace(t,"appId"),w.throwIfNullOrWhitespace(i,"region");const r=new Et;return r.appId=t,r.region=i,r.subscriptionKey=e,r}}class Et extends bt{}class kt extends Rt{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}}class xt extends kt{}class Dt extends Rt{constructor(e,t,i,r,n){super(r,n),this.privReason=e,this.privErrorDetails=t,this.privErrorCode=i}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}class Ot extends Dt{}class Nt extends Rt{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}}class zt extends wt{constructor(e,t){super(t),this.privResult=e}get result(){return this.privResult}}class Mt extends At{constructor(e,t,i,r,n,s,o,a,c,p,h){super(t,i,r,n,s,o,a,void 0,c,p,h),this.privTranslations=e}static fromSpeechRecognitionResult(e){return new Mt(void 0,e.resultId,e.reason,e.text,e.duration,e.offset,e.language,e.languageDetectionConfidence,e.errorDetails,e.json,e.properties)}get translations(){return this.privTranslations}}class Lt{constructor(e,t){this.privReason=e,this.privAudio=t}get audio(){return this.privAudio}get reason(){return this.privReason}}!function(e){e[e.Masked=0]="Masked",e[e.Removed=1]="Removed",e[e.Raw=2]="Raw"}(lt||(lt={}));class _t{constructor(){}static fromSubscription(e,t){w.throwIfNullOrWhitespace(e,"subscriptionKey"),w.throwIfNullOrWhitespace(t,"region");const i=new Bt;return i.setProperty(l.SpeechServiceConnection_Region,t),i.setProperty(l.SpeechServiceConnection_IntentRegion,t),i.setProperty(l.SpeechServiceConnection_Key,e),i}static fromEndpoint(e,t){w.throwIfNull(e,"endpoint");const i=new Bt;return i.setProperty(l.SpeechServiceConnection_Endpoint,e.href),void 0!==t&&i.setProperty(l.SpeechServiceConnection_Key,t),i}static fromHost(e,t){w.throwIfNull(e,"hostName");const i=new Bt;return i.setProperty(l.SpeechServiceConnection_Host,e.protocol+"//"+e.hostname+(""===e.port?"":":"+e.port)),void 0!==t&&i.setProperty(l.SpeechServiceConnection_Key,t),i}static fromAuthorizationToken(e,t){w.throwIfNull(e,"authorizationToken"),w.throwIfNullOrWhitespace(t,"region");const i=new Bt;return i.setProperty(l.SpeechServiceConnection_Region,t),i.setProperty(l.SpeechServiceConnection_IntentRegion,t),i.authorizationToken=e,i}close(){}}class Bt extends _t{constructor(){super(),this.privProperties=new Oe,this.speechRecognitionLanguage="en-US",this.outputFormat=dt.Simple}get properties(){return this.privProperties}get endPoint(){return new URL(this.privProperties.getProperty(l.SpeechServiceConnection_Endpoint))}get subscriptionKey(){return this.privProperties.getProperty(l.SpeechServiceConnection_Key)}get region(){return this.privProperties.getProperty(l.SpeechServiceConnection_Region)}get authorizationToken(){return this.privProperties.getProperty(l.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.privProperties.setProperty(l.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return this.privProperties.getProperty(l.SpeechServiceConnection_RecoLanguage)}set speechRecognitionLanguage(e){this.privProperties.setProperty(l.SpeechServiceConnection_RecoLanguage,e)}get autoDetectSourceLanguages(){return this.privProperties.getProperty(l.SpeechServiceConnection_AutoDetectSourceLanguages)}set autoDetectSourceLanguages(e){this.privProperties.setProperty(l.SpeechServiceConnection_AutoDetectSourceLanguages,e)}get outputFormat(){return dt[this.privProperties.getProperty(Xe,void 0)]}set outputFormat(e){this.privProperties.setProperty(Xe,dt[e])}get endpointId(){return this.privProperties.getProperty(l.SpeechServiceConnection_EndpointId)}set endpointId(e){this.privProperties.setProperty(l.SpeechServiceConnection_EndpointId,e)}setProperty(e,t){w.throwIfNull(t,"value"),this.privProperties.setProperty(e,t)}getProperty(e,t){return this.privProperties.getProperty(e,t)}setProxy(e,t,i,r){this.setProperty(l[l.SpeechServiceConnection_ProxyHostName],e),this.setProperty(l[l.SpeechServiceConnection_ProxyPort],t),this.setProperty(l[l.SpeechServiceConnection_ProxyUserName],i),this.setProperty(l[l.SpeechServiceConnection_ProxyPassword],r)}setServiceProperty(e,t){const i=JSON.parse(this.privProperties.getProperty(et,"{}"));i[e]=t,this.privProperties.setProperty(et,JSON.stringify(i))}setProfanity(e){this.privProperties.setProperty(l.SpeechServiceResponse_ProfanityOption,lt[e])}enableAudioLogging(){this.privProperties.setProperty(l.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privProperties.setProperty(l.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privProperties.setProperty(tt,"true")}clone(){const e=new Bt;return e.privProperties=this.privProperties.clone(),e}get speechSynthesisLanguage(){return this.privProperties.getProperty(l.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(e){this.privProperties.setProperty(l.SpeechServiceConnection_SynthLanguage,e)}get speechSynthesisVoiceName(){return this.privProperties.getProperty(l.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(e){this.privProperties.setProperty(l.SpeechServiceConnection_SynthVoice,e)}get speechSynthesisOutputFormat(){return de[this.privProperties.getProperty(l.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(e){this.privProperties.setProperty(l.SpeechServiceConnection_SynthOutputFormat,de[e])}}class qt extends _t{constructor(){super()}static fromSubscription(e,t){w.throwIfNullOrWhitespace(e,"subscriptionKey"),w.throwIfNullOrWhitespace(t,"region");const i=new Ut;return i.properties.setProperty(l.SpeechServiceConnection_Key,e),i.properties.setProperty(l.SpeechServiceConnection_Region,t),i}static fromAuthorizationToken(e,t){w.throwIfNullOrWhitespace(e,"authorizationToken"),w.throwIfNullOrWhitespace(t,"region");const i=new Ut;return i.properties.setProperty(l.SpeechServiceAuthorization_Token,e),i.properties.setProperty(l.SpeechServiceConnection_Region,t),i}static fromHost(e,t){w.throwIfNull(e,"hostName");const i=new Ut;return i.setProperty(l.SpeechServiceConnection_Host,e.protocol+"//"+e.hostname+(""===e.port?"":":"+e.port)),void 0!==t&&i.setProperty(l.SpeechServiceConnection_Key,t),i}static fromEndpoint(e,t){w.throwIfNull(e,"endpoint"),w.throwIfNull(t,"subscriptionKey");const i=new Ut;return i.properties.setProperty(l.SpeechServiceConnection_Endpoint,e.href),i.properties.setProperty(l.SpeechServiceConnection_Key,t),i}}class Ut extends qt{constructor(){super(),this.privSpeechProperties=new Oe,this.outputFormat=dt.Simple}set authorizationToken(e){w.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(l.SpeechServiceAuthorization_Token,e)}set speechRecognitionLanguage(e){w.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(l.SpeechServiceConnection_RecoLanguage,e)}get speechRecognitionLanguage(){return this.privSpeechProperties.getProperty(l[l.SpeechServiceConnection_RecoLanguage])}get subscriptionKey(){return this.privSpeechProperties.getProperty(l[l.SpeechServiceConnection_Key])}get outputFormat(){return dt[this.privSpeechProperties.getProperty(Xe,void 0)]}set outputFormat(e){this.privSpeechProperties.setProperty(Xe,dt[e])}get endpointId(){return this.privSpeechProperties.getProperty(l.SpeechServiceConnection_EndpointId)}set endpointId(e){this.privSpeechProperties.setProperty(l.SpeechServiceConnection_EndpointId,e)}addTargetLanguage(e){w.throwIfNullOrWhitespace(e,"value");const t=this.targetLanguages;t.push(e),this.privSpeechProperties.setProperty(l.SpeechServiceConnection_TranslationToLanguages,t.join(","))}get targetLanguages(){return void 0!==this.privSpeechProperties.getProperty(l.SpeechServiceConnection_TranslationToLanguages,void 0)?this.privSpeechProperties.getProperty(l.SpeechServiceConnection_TranslationToLanguages).split(","):[]}get voiceName(){return this.getProperty(l[l.SpeechServiceConnection_TranslationVoice])}set voiceName(e){w.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(l.SpeechServiceConnection_TranslationVoice,e)}get region(){return this.privSpeechProperties.getProperty(l.SpeechServiceConnection_Region)}setProxy(e,t,i,r){this.setProperty(l[l.SpeechServiceConnection_ProxyHostName],e),this.setProperty(l[l.SpeechServiceConnection_ProxyPort],t),this.setProperty(l[l.SpeechServiceConnection_ProxyUserName],i),this.setProperty(l[l.SpeechServiceConnection_ProxyPassword],r)}getProperty(e,t){return this.privSpeechProperties.getProperty(e,t)}setProperty(e,t){this.privSpeechProperties.setProperty(e,t)}get properties(){return this.privSpeechProperties}close(){}setServiceProperty(e,t){const i=JSON.parse(this.privSpeechProperties.getProperty(et,"{}"));i[e]=t,this.privSpeechProperties.setProperty(et,JSON.stringify(i))}setProfanity(e){this.privSpeechProperties.setProperty(l.SpeechServiceResponse_ProfanityOption,lt[e])}enableAudioLogging(){this.privSpeechProperties.setProperty(l.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privSpeechProperties.setProperty(l.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privSpeechProperties.setProperty(tt,"true")}get speechSynthesisLanguage(){return this.privSpeechProperties.getProperty(l.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(e){this.privSpeechProperties.setProperty(l.SpeechServiceConnection_SynthLanguage,e)}get speechSynthesisVoiceName(){return this.privSpeechProperties.getProperty(l.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(e){this.privSpeechProperties.setProperty(l.SpeechServiceConnection_SynthVoice,e)}get speechSynthesisOutputFormat(){return de[this.privSpeechProperties.getProperty(l.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(e){this.privSpeechProperties.setProperty(l.SpeechServiceConnection_SynthOutputFormat,de[e])}}class Ft{constructor(e,t){this.privBuffers=[],this.privReplayOffset=0,this.privLastShrinkOffset=0,this.privBufferStartOffset=0,this.privBufferSerial=0,this.privBufferedBytes=0,this.privReplay=!1,this.privLastChunkAcquiredTime=0,this.privAudioNode=e,this.privBytesPerSecond=t}id(){return this.privAudioNode.id()}read(){if(this.privReplay&&0!==this.privBuffers.length){const e=this.privReplayOffset-this.privBufferStartOffset;let t=Math.round(e*this.privBytesPerSecond*1e-7);0!=t%2&&t++;let i=0;for(;i<this.privBuffers.length&&t>=this.privBuffers[i].chunk.buffer.byteLength;)t-=this.privBuffers[i++].chunk.buffer.byteLength;if(i<this.privBuffers.length){const e=this.privBuffers[i].chunk.buffer.slice(t);return this.privReplayOffset+=e.byteLength/this.privBytesPerSecond*1e7,i===this.privBuffers.length-1&&(this.privReplay=!1),Promise.resolve({buffer:e,isEnd:!1,timeReceived:this.privBuffers[i].chunk.timeReceived})}}return this.privAudioNode.read().then((e=>(e&&e.buffer&&(this.privBuffers.push(new Kt(e,this.privBufferSerial++,this.privBufferedBytes)),this.privBufferedBytes+=e.buffer.byteLength),e)))}detach(){return this.privBuffers=void 0,this.privAudioNode.detach()}replay(){this.privBuffers&&0!==this.privBuffers.length&&(this.privReplay=!0,this.privReplayOffset=this.privLastShrinkOffset)}shrinkBuffers(e){if(void 0===this.privBuffers||0===this.privBuffers.length)return;this.privLastShrinkOffset=e;const t=e-this.privBufferStartOffset;let i=Math.round(t*this.privBytesPerSecond*1e-7),r=0;for(;r<this.privBuffers.length&&i>=this.privBuffers[r].chunk.buffer.byteLength;)i-=this.privBuffers[r++].chunk.buffer.byteLength;this.privBufferStartOffset=Math.round(e-i/this.privBytesPerSecond*1e7),this.privBuffers=this.privBuffers.slice(r)}findTimeAtOffset(e){if(e<this.privBufferStartOffset||void 0===this.privBuffers)return 0;for(const t of this.privBuffers){const i=t.byteOffset/this.privBytesPerSecond*1e7,r=i+t.chunk.buffer.byteLength/this.privBytesPerSecond*1e7;if(e>=i&&e<=r)return t.chunk.timeReceived}return 0}}class Kt{constructor(e,t,i){this.chunk=e,this.serial=t,this.byteOffset=i}}class Ht{static load(){const e=new Map([[0,()=>{}]]),t=new Map,i="data:text/javascript;base64,"+btoa('!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return d}));const r=new Map,o=new Map,i=e=>{const t=r.get(e);if(void 0===t)throw new Error(\'There is no interval scheduled with the given id "\'.concat(e,\'".\'));clearTimeout(t),r.delete(e)},u=e=>{const t=o.get(e);if(void 0===t)throw new Error(\'There is no timeout scheduled with the given id "\'.concat(e,\'".\'));clearTimeout(t),o.delete(e)},f=(e,t)=>{let n,r;if("performance"in self){const o=performance.now();n=o,r=e-Math.max(0,o-t)}else n=Date.now(),r=e;return{expected:n+r,remainingDelay:r}},c=(e,t,n,r)=>{const o="performance"in self?performance.now():Date.now();o>n?postMessage({id:null,method:"call",params:{timerId:t}}):e.set(t,setTimeout(c,n-o,e,t,n))},a=(e,t,n)=>{const{expected:o,remainingDelay:i}=f(e,n);r.set(t,setTimeout(c,i,r,t,o))},d=(e,t,n)=>{const{expected:r,remainingDelay:i}=f(e,n);o.set(t,setTimeout(c,i,o,t,r))}},function(e,t,n){"use strict";n.r(t);var r=n(2);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(3);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(4);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o);var f=n(5);for(var o in f)"default"!==o&&function(e){n.d(t,e,(function(){return f[e]}))}(o);var c=n(6);for(var o in c)"default"!==o&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var a=n(7);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var d=n(8);for(var o in d)"default"!==o&&function(e){n.d(t,e,(function(){return d[e]}))}(o);var s=n(9);for(var o in s)"default"!==o&&function(e){n.d(t,e,(function(){return s[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(11);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(12);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(13);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(1);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var u=n(10);for(var i in u)"default"!==i&&function(e){n.d(t,e,(function(){return u[e]}))}(i);addEventListener("message",({data:e})=>{try{if("clear"===e.method){const{id:t,params:{timerId:n}}=e;Object(r.b)(n),postMessage({error:null,id:t})}else{if("set"!==e.method)throw new Error(\'The given method "\'.concat(e.method,\'" is not supported\'));{const{params:{delay:t,now:n,timerId:o}}=e;Object(r.d)(t,o,n)}}}catch(t){postMessage({error:{message:t.message},id:e.id,result:null})}})}]);'),r=new Worker(i);return r.addEventListener("message",(({data:i})=>{if(Ht.isCallNotification(i)){const{params:{timerId:r}}=i,n=e.get(r);if("number"==typeof n){const e=t.get(n);if(void 0===e||e!==r)throw new Error("The timer is in an undefined state.")}else{if(void 0===n)throw new Error("The timer is in an undefined state.");n(),e.delete(r)}}else{if(!Ht.isClearResponse(i)){const{error:{message:e}}=i;throw new Error(e)}{const{id:r}=i,n=t.get(r);if(void 0===n)throw new Error("The timer is in an undefined state.");t.delete(r),e.delete(n)}}})),{clearTimeout:i=>{const n=Math.random();t.set(n,i),e.set(i,n),r.postMessage({id:n,method:"clear",params:{timerId:i}})},setTimeout:(t,i)=>{const n=Math.random();return e.set(n,t),r.postMessage({id:null,method:"set",params:{delay:i,now:performance.now(),timerId:n}}),n}}}static loadWorkerTimers(){return()=>(null!==Ht.workerTimers||(Ht.workerTimers=Ht.load()),Ht.workerTimers)}static isCallNotification(e){return void 0!==e.method&&"call"===e.method}static isClearResponse(e){return null===e.error&&"number"==typeof e.id}}Ht.workerTimers=null,Ht.clearTimeout=e=>Ht.timers().clearTimeout(e),Ht.setTimeout=(e,t)=>Ht.timers().setTimeout(e,t),Ht.timers=Ht.loadWorkerTimers();class Wt extends C{constructor(e,t,i,r=d.Info){super(e,r),this.privRequestId=t,this.privSessionId=i}get requestId(){return this.privRequestId}get sessionId(){return this.privSessionId}}class jt extends Wt{constructor(e,t,i,r){super("RecognitionTriggeredEvent",e,t),this.privAudioSourceId=i,this.privAudioNodeId=r}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}class Jt extends Wt{constructor(e,t,i,r){super("ListeningStartedEvent",e,t),this.privAudioSourceId=i,this.privAudioNodeId=r}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}class Vt extends Wt{constructor(e,t,i){super("ConnectingToServiceEvent",e,i),this.privAuthFetchEventid=t}get authFetchEventid(){return this.privAuthFetchEventid}}class Gt extends Wt{constructor(e,t,i,r,n){super("RecognitionStartedEvent",e,n),this.privAudioSourceId=t,this.privAudioNodeId=i,this.privAuthFetchEventId=r}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}}!function(e){e[e.Success=0]="Success",e[e.AudioSourceError=1]="AudioSourceError",e[e.AudioSourceTimeout=2]="AudioSourceTimeout",e[e.AuthTokenFetchError=3]="AuthTokenFetchError",e[e.AuthTokenFetchTimeout=4]="AuthTokenFetchTimeout",e[e.UnAuthorized=5]="UnAuthorized",e[e.ConnectTimeout=6]="ConnectTimeout",e[e.ConnectError=7]="ConnectError",e[e.ClientRecognitionActivityTimeout=8]="ClientRecognitionActivityTimeout",e[e.UnknownError=9]="UnknownError"}(vt||(vt={}));class $t{constructor(e,t,i){this.privIsDisposed=!1,this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privRequestId=e,this.privAudioSourceId=t,this.privAudioNodeId=i,this.privReceivedMessages={},this.privPhraseLatencies=[],this.privHypothesisLatencies=[]}phraseReceived(e){e>0&&this.privPhraseLatencies.push(Date.now()-e)}hypothesisReceived(e){e>0&&this.privHypothesisLatencies.push(Date.now()-e)}onEvent(e){if(!this.privIsDisposed&&(e instanceof jt&&e.requestId===this.privRequestId&&(this.privListeningTriggerMetric={End:e.eventTime,Name:"ListeningTrigger",Start:e.eventTime}),e instanceof H&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof W&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof F&&e.audioSourceId===this.privAudioSourceId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof J&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof j&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Name:"Microphone",Start:this.privMicStartTime})),e instanceof Vt&&e.requestId===this.privRequestId&&(this.privConnectionId=e.sessionId),e instanceof Re&&e.connectionId===this.privConnectionId&&(this.privConnectionStartTime=e.eventTime),e instanceof Pe&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof Te&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Error:this.getConnectionError(e.statusCode),Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof be&&e.connectionId===this.privConnectionId&&e.message&&e.message.headers&&e.message.headers.path)){this.privReceivedMessages[e.message.headers.path]||(this.privReceivedMessages[e.message.headers.path]=new Array);const t=50;this.privReceivedMessages[e.message.headers.path].length<t&&this.privReceivedMessages[e.message.headers.path].push(e.networkReceivedTime)}}getTelemetry(){const e=new Array;this.privListeningTriggerMetric&&e.push(this.privListeningTriggerMetric),this.privMicMetric&&e.push(this.privMicMetric),this.privConnectionEstablishMetric&&e.push(this.privConnectionEstablishMetric),this.privPhraseLatencies.length>0&&e.push({PhraseLatencyMs:this.privPhraseLatencies}),this.privHypothesisLatencies.length>0&&e.push({FirstHypothesisLatencyMs:this.privHypothesisLatencies});const t={Metrics:e,ReceivedMessages:this.privReceivedMessages},i=JSON.stringify(t);return this.privReceivedMessages={},this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privPhraseLatencies=[],this.privHypothesisLatencies=[],i}get hasTelemetry(){return 0!==Object.keys(this.privReceivedMessages).length||null!==this.privListeningTriggerMetric||null!==this.privMicMetric||null!==this.privConnectionEstablishMetric||0!==this.privPhraseLatencies.length||0!==this.privHypothesisLatencies.length}dispose(){this.privIsDisposed=!0}getConnectionError(e){switch(e){case 400:case 1002:case 1003:case 1005:case 1007:case 1008:case 1009:return"BadRequest";case 401:return"Unauthorized";case 403:return"Forbidden";case 503:case 1001:return"ServerUnavailable";case 500:case 1011:return"ServerError";case 408:case 504:return"Timeout";default:return"statuscode:"+e.toString()}}}var Qt=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Zt{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.privIsAudioNodeDetached=!1,this.privIsRecognizing=!1,this.privIsSpeechEnded=!1,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privHypothesisReceived=!1,this.privBytesSent=0,this.privRecogNumber=0,this.privInTurn=!1,this.privConnectionAttempts=0,this.privAudioSourceId=e,this.privRequestId=u(),this.privAudioNodeId=u(),this.privTurnDeferral=new M,this.privTurnDeferral.resolve()}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get audioNodeId(){return this.privAudioNodeId}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSpeechEnded(){return this.privIsSpeechEnded}get isRecognizing(){return this.privIsRecognizing}get currentTurnAudioOffset(){return this.privTurnStartAudioOffset}get recogNumber(){return this.privRecogNumber}get numConnectionAttempts(){return this.privConnectionAttempts}get bytesSent(){return this.privBytesSent}listenForServiceTelemetry(e){this.privServiceTelemetryListener&&this.privDetachables.push(e.attachListener(this.privServiceTelemetryListener))}startNewRecognition(){this.privIsSpeechEnded=!1,this.privIsRecognizing=!0,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privRecogNumber++,this.privServiceTelemetryListener=new $t(this.privRequestId,this.privAudioSourceId,this.privAudioNodeId),this.onEvent(new jt(this.requestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}onAudioSourceAttachCompleted(e,t){return Qt(this,void 0,void 0,(function*(){this.privAudioNode=e,this.privIsAudioNodeDetached=!1,t?yield this.onComplete():this.onEvent(new Jt(this.privRequestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}))}onPreConnectionStart(e,t){this.privAuthFetchEventId=e,this.privSessionId=t,this.onEvent(new Vt(this.privRequestId,this.privAuthFetchEventId,this.privSessionId))}onAuthCompleted(e){return Qt(this,void 0,void 0,(function*(){e&&(yield this.onComplete())}))}onConnectionEstablishCompleted(e,t){return Qt(this,void 0,void 0,(function*(){if(200===e)return this.onEvent(new Gt(this.requestId,this.privAudioSourceId,this.privAudioNodeId,this.privAuthFetchEventId,this.privSessionId)),this.privAudioNode&&this.privAudioNode.replay(),this.privTurnStartAudioOffset=this.privLastRecoOffset,void(this.privBytesSent=0);403===e&&(yield this.onComplete())}))}onServiceTurnEndResponse(e){return Qt(this,void 0,void 0,(function*(){this.privTurnDeferral.resolve(),!e||this.isSpeechEnded?(yield this.onComplete(),this.privInTurn=!1):(this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privAudioNode.replay())}))}onSpeechContext(){this.privRequestId=u()}onServiceTurnStartResponse(){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch((()=>{}))),this.privInTurn=!0,this.privTurnDeferral=new M}onHypothesis(e){this.privHypothesisReceived||(this.privHypothesisReceived=!0,this.privServiceTelemetryListener.hypothesisReceived(this.privAudioNode.findTimeAtOffset(e)))}onPhraseRecognized(e){this.privServiceTelemetryListener.phraseReceived(this.privAudioNode.findTimeAtOffset(e)),this.onServiceRecognized(e)}onServiceRecognized(e){this.privLastRecoOffset=e,this.privHypothesisReceived=!1,this.privAudioNode.shrinkBuffers(e),this.privConnectionAttempts=0}onAudioSent(e){this.privBytesSent+=e}onRetryConnection(){this.privConnectionAttempts++}dispose(){return Qt(this,void 0,void 0,(function*(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const e of this.privDetachables)yield e.detach();this.privServiceTelemetryListener&&this.privServiceTelemetryListener.dispose(),this.privIsRecognizing=!1}}))}getTelemetry(){return this.privServiceTelemetryListener.hasTelemetry?this.privServiceTelemetryListener.getTelemetry():null}onStopRecognizing(){return Qt(this,void 0,void 0,(function*(){yield this.onComplete()}))}onSpeechEnded(){this.privIsSpeechEnded=!0}onEvent(e){this.privServiceTelemetryListener&&this.privServiceTelemetryListener.onEvent(e),b.instance.onEvent(e)}onComplete(){return Qt(this,void 0,void 0,(function*(){this.privIsRecognizing&&(this.privIsRecognizing=!1,yield this.detachAudioNode())}))}detachAudioNode(){return Qt(this,void 0,void 0,(function*(){this.privIsAudioNodeDetached||(this.privIsAudioNodeDetached=!0,this.privAudioNode&&(yield this.privAudioNode.detach()))}))}}class Xt{addPhrase(e){this.privPhrases||(this.privPhrases=[]),e instanceof Array?this.privPhrases=this.privPhrases.concat(e):this.privPhrases.push(e)}clearPhrases(){this.privPhrases=void 0}addReferenceGrammar(e){this.privGrammars||(this.privGrammars=[]),e instanceof Array?this.privGrammars=this.privGrammars.concat(e):this.privGrammars.push(e)}clearGrammars(){this.privGrammars=void 0}generateGrammarObject(){if(void 0===this.privGrammars&&void 0===this.privPhrases)return;const e={};if(e.ReferenceGrammars=this.privGrammars,void 0!==this.privPhrases&&0!==this.privPhrases.length){const t=[];this.privPhrases.forEach((e=>{t.push({Text:e})})),e.Groups=[{Type:"Generic",Items:t}]}return e}}class Yt{constructor(e){this.privContext={},this.privDynamicGrammar=e}getSection(e){return this.privContext[e]||{}}setSection(e,t){this.privContext[e]=t}setPronunciationAssessmentParams(e){void 0===this.privContext.phraseDetection&&(this.privContext.phraseDetection={enrichment:{pronunciationAssessment:{}}}),this.privContext.phraseDetection.enrichment.pronunciationAssessment=JSON.parse(e),this.setWordLevelTimings(),this.privContext.phraseOutput.detailed.options.push("PronunciationAssessment"),-1===this.privContext.phraseOutput.detailed.options.indexOf("SNR")&&this.privContext.phraseOutput.detailed.options.push("SNR")}setWordLevelTimings(){void 0===this.privContext.phraseOutput&&(this.privContext.phraseOutput={detailed:{options:[]},format:{}}),void 0===this.privContext.phraseOutput.detailed&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format="Detailed",-1===this.privContext.phraseOutput.detailed.options.indexOf("WordTimings")&&this.privContext.phraseOutput.detailed.options.push("WordTimings")}toJSON(){const e=this.privDynamicGrammar.generateGrammarObject();return this.setSection("dgi",e),JSON.stringify(this.privContext)}}class ei{constructor(e){this.privSpeechStartDetected=JSON.parse(e)}static fromJSON(e){return new ei(e)}get Offset(){return this.privSpeechStartDetected.Offset}}var ti=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class ii{constructor(e,t,i,r,n){if(this.privConnectionConfigurationPromise=void 0,this.privConnectionPromise=void 0,this.privSetTimeout=setTimeout,this.privIsLiveAudio=!1,this.recognizeOverride=void 0,this.recognizeSpeaker=void 0,this.disconnectOverride=void 0,this.receiveMessageOverride=void 0,this.sendPrePayloadJSONOverride=void 0,this.postConnectImplOverride=void 0,this.configConnectionOverride=void 0,this.handleSpeechPhraseMessage=void 0,this.handleSpeechHypothesisMessage=void 0,!e)throw new P("authentication");if(!t)throw new P("connectionFactory");if(!i)throw new P("audioSource");if(!r)throw new P("recognizerConfig");this.privMustReportEndOfStream=!1,this.privAuthentication=e,this.privConnectionFactory=t,this.privAudioSource=i,this.privRecognizerConfig=r,this.privIsDisposed=!1,this.privRecognizer=n,this.privRequestSession=new Zt(this.privAudioSource.id()),this.privConnectionEvents=new T,this.privServiceEvents=new T,this.privDynamicGrammar=new Xt,this.privSpeechContext=new Yt(this.privDynamicGrammar),this.privAgentConfig=new Ze,"undefined"!=typeof Blob&&"undefined"!=typeof Worker&&(this.privSetTimeout=Ht.setTimeout),this.connectionEvents.attach((e=>{if("ConnectionClosedEvent"===e.name){const t=e;(1003===t.statusCode||1007===t.statusCode||1002===t.statusCode||4e3===t.statusCode||this.privRequestSession.numConnectionAttempts>this.privRecognizerConfig.maxRetryCount)&&this.cancelRecognitionLocal(pe.Error,1007===t.statusCode?he.BadRequestParameters:he.ConnectionFailure,`${t.reason} websocket error code: ${t.statusCode}`)}}));const s={};if(void 0!==r.autoDetectSourceLanguages){const e=r.autoDetectSourceLanguages.split(",");let t;t="Continuous"===r.languageIdMode?"DetectContinuous":"DetectAtAudioStart",this.privSpeechContext.setSection("languageId",{Priority:"PrioritizeLatency",languages:e,mode:t,onSuccess:{action:"Recognize"},onUnknown:{action:"None"}}),this.privSpeechContext.setSection("phraseOutput",{interimResults:{resultType:"Auto"},phraseResults:{resultType:"Always"}});const i=r.sourceLanguageModels;void 0!==i&&(s.customModels=i,s.onInterim={action:"None"},s.onSuccess={action:"None"})}(e=>{for(const t in e)return!1;return!0})(s)||this.privSpeechContext.setSection("phraseDetection",s)}setSpeechSegmentationTimeout(){const e=this.privRecognizerConfig.parameters.getProperty(l.Speech_SegmentationSilenceTimeoutMs,void 0);if(void 0!==e){const t=this.recognitionMode===v.Conversation?"CONVERSATION":this.recognitionMode===v.Dictation?"DICTATION":"INTERACTIVE",i=parseInt(e,10),r=this.privSpeechContext.getSection("phraseDetection");r.mode=t,r[t]={segmentation:{mode:"Custom",segmentationSilenceTimeoutMs:i}},this.privSpeechContext.setSection("phraseDetection",r)}}get audioSource(){return this.privAudioSource}get speechContext(){return this.privSpeechContext}get dynamicGrammar(){return this.privDynamicGrammar}get agentConfig(){return this.privAgentConfig}set conversationTranslatorToken(e){this.privRecognizerConfig.parameters.setProperty(l.ConversationTranslator_Token,e)}set voiceProfileType(e){this.privRecognizerConfig.parameters.setProperty(l.SpeechServiceConnection_SpeakerIdMode,e)}set authentication(e){this.privAuthentication=this.authentication}isDisposed(){return this.privIsDisposed}dispose(e){return ti(this,void 0,void 0,(function*(){if(this.privIsDisposed=!0,void 0!==this.privConnectionConfigurationPromise)try{const t=yield this.privConnectionConfigurationPromise;yield t.dispose(e)}catch(e){return}}))}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}get recognitionMode(){return this.privRecognizerConfig.recognitionMode}recognize(e,t,i){return ti(this,void 0,void 0,(function*(){if(void 0!==this.recognizeOverride)return void(yield this.recognizeOverride(e,t,i));this.privConnectionConfigurationPromise=void 0,this.privRecognizerConfig.recognitionMode=e,this.setSpeechSegmentationTimeout(),this.privSuccessCallback=t,this.privErrorCallback=i,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privAudioSource.events);const r=this.connectImpl();let n;try{const e=yield this.audioSource.attach(this.privRequestSession.audioNodeId),t=yield this.audioSource.format,i=yield this.audioSource.deviceInfo;this.privIsLiveAudio=i.type&&i.type===m.Microphones,n=new Ft(e,t.avgBytesPerSec),yield this.privRequestSession.onAudioSourceAttachCompleted(n,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:i}}catch(e){throw yield this.privRequestSession.onStopRecognizing(),e}try{yield r}catch(e){return void(yield this.cancelRecognitionLocal(pe.Error,he.ConnectionFailure,e))}const s=new wt(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,s),this.receiveMessage(),this.sendAudio(n).catch((e=>ti(this,void 0,void 0,(function*(){yield this.cancelRecognitionLocal(pe.Error,he.RuntimeError,e)}))))}))}stopRecognizing(){return ti(this,void 0,void 0,(function*(){if(this.privRequestSession.isRecognizing)try{yield this.audioSource.turnOff(),yield this.sendFinalAudio(),yield this.privRequestSession.onStopRecognizing(),yield this.privRequestSession.turnCompletionPromise}finally{yield this.privRequestSession.dispose()}}))}connect(){return ti(this,void 0,void 0,(function*(){return yield this.connectImpl(),Promise.resolve()}))}connectAsync(e,t){this.connectImpl().then((()=>{try{e&&e()}catch(e){t&&t(e)}}),(e=>{try{t&&t(e)}catch(e){}}))}disconnect(){return ti(this,void 0,void 0,(function*(){if(yield this.cancelRecognitionLocal(pe.Error,he.NoError,"Disconnecting"),void 0!==this.disconnectOverride&&(yield this.disconnectOverride()),void 0!==this.privConnectionPromise)try{yield(yield this.privConnectionPromise).dispose()}catch(e){}this.privConnectionPromise=void 0}))}sendMessage(e){}sendNetworkMessage(e,t){return ti(this,void 0,void 0,(function*(){const i="string"==typeof t?ae.Text:ae.Binary,r="string"==typeof t?"application/json":"";return(yield this.fetchConnection()).send(new nt(i,e,this.privRequestSession.requestId,r,t))}))}set activityTemplate(e){this.privActivityTemplate=e}get activityTemplate(){return this.privActivityTemplate}sendTelemetryData(){return ti(this,void 0,void 0,(function*(){const e=this.privRequestSession.getTelemetry();if(!0!==ii.telemetryDataEnabled||this.privIsDisposed||null===e)return;if(ii.telemetryData)try{ii.telemetryData(e)}catch(e){}const t=yield this.fetchConnection();yield t.send(new nt(ae.Text,"telemetry",this.privRequestSession.requestId,"application/json",e))}))}cancelRecognitionLocal(e,t,i){return ti(this,void 0,void 0,(function*(){this.privRequestSession.isRecognizing&&(yield this.privRequestSession.onStopRecognizing(),this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,e,t,i))}))}receiveMessage(){return ti(this,void 0,void 0,(function*(){try{if(this.privIsDisposed)return;let e=yield this.fetchConnection();const t=yield e.read();if(void 0!==this.receiveMessageOverride)return this.receiveMessageOverride();if(!t)return this.privRequestSession.isRecognizing?this.receiveMessage():void 0;this.privServiceHasSentMessage=!0;const i=nt.fromConnectionMessage(t);if(i.requestId.toLowerCase()===this.privRequestSession.requestId.toLowerCase())switch(i.path.toLowerCase()){case"turn.start":this.privMustReportEndOfStream=!0,this.privRequestSession.onServiceTurnStartResponse();break;case"speech.startdetected":const t=ei.fromJSON(i.textBody),r=new Rt(t.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,r);break;case"speech.enddetected":let n;n=i.textBody.length>0?i.textBody:"{ Offset: 0 }";const s=ei.fromJSON(n),o=new Rt(s.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,o);break;case"turn.end":yield this.sendTelemetryData(),this.privRequestSession.isSpeechEnded&&this.privMustReportEndOfStream&&(this.privMustReportEndOfStream=!1,yield this.cancelRecognitionLocal(pe.EndOfStream,he.NoError,void 0));const a=new wt(this.privRequestSession.sessionId);if(yield this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition),!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing)return void(this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,a));e=yield this.fetchConnection(),yield this.sendPrePayloadJSON(e);break;default:(yield this.processTypeSpecificMessages(i))||this.privServiceEvents&&this.serviceEvents.onEvent(new Ce(i.path.toLowerCase(),i.textBody))}return this.receiveMessage()}catch(e){return null}}))}sendSpeechContext(e,t){const i=this.speechContext.toJSON();if(t&&this.privRequestSession.onSpeechContext(),i)return e.send(new nt(ae.Text,"speech.context",this.privRequestSession.requestId,"application/json",i))}noOp(){}sendPrePayloadJSON(e,t=!0){return ti(this,void 0,void 0,(function*(){if(void 0!==this.sendPrePayloadJSONOverride)return this.sendPrePayloadJSONOverride(e);yield this.sendSpeechContext(e,t),yield this.sendWaveHeader(e)}))}sendWaveHeader(e){return ti(this,void 0,void 0,(function*(){const t=yield this.audioSource.format;return e.send(new nt(ae.Binary,"audio",this.privRequestSession.requestId,"audio/x-wav",t.header))}))}connectImpl(){return void 0!==this.privConnectionPromise?this.privConnectionPromise.then((e=>e.state()===ce.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl()):this.privConnectionPromise),(()=>(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl()))):(this.privConnectionPromise=this.retryableConnect(),this.privConnectionPromise.catch((()=>{})),void 0!==this.postConnectImplOverride?this.postConnectImplOverride(this.privConnectionPromise):this.privConnectionPromise)}sendSpeechServiceConfig(e,t,i){if(t.onSpeechContext(),!0!==ii.telemetryDataEnabled){const e={context:{system:JSON.parse(i).context.system}};i=JSON.stringify(e)}if("true"===this.privRecognizerConfig.parameters.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()){const e=JSON.parse(i);e.context.DisableReferenceChannel="True",e.context.MicSpec="1_0_0",i=JSON.stringify(e)}if(i)return e.send(new nt(ae.Text,"speech.config",t.requestId,"application/json",i))}fetchConnection(){return ti(this,void 0,void 0,(function*(){return void 0!==this.privConnectionConfigurationPromise?this.privConnectionConfigurationPromise.then((e=>e.state()===ce.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection()):this.privConnectionConfigurationPromise),(()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection()))):(this.privConnectionConfigurationPromise=this.configureConnection(),yield this.privConnectionConfigurationPromise)}))}sendAudio(e){return ti(this,void 0,void 0,(function*(){const t=yield this.audioSource.format;let i=Date.now();const r=this.privRecognizerConfig.parameters.getProperty("SPEECH-TransmitLengthBeforThrottleMs","5000"),n=t.avgBytesPerSec/1e3*parseInt(r,10),s=this.privRequestSession.recogNumber,o=()=>ti(this,void 0,void 0,(function*(){if(!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===s){const r=yield this.fetchConnection(),a=yield e.read();if(this.privRequestSession.isSpeechEnded)return;let c,p;if(!a||a.isEnd?(c=null,p=0):(c=a.buffer,this.privRequestSession.onAudioSent(c.byteLength),p=n>=this.privRequestSession.bytesSent?0:Math.max(0,i-Date.now())),0!==p&&(yield this.delay(p)),null!==c&&(i=Date.now()+1e3*c.byteLength/(2*t.avgBytesPerSec)),!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===s){if(r.send(new nt(ae.Binary,"audio",this.privRequestSession.requestId,null,c)).catch((()=>{this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition).catch((()=>{}))})),!(null==a?void 0:a.isEnd))return o();this.privIsLiveAudio||this.privRequestSession.onSpeechEnded()}}}));return o()}))}retryableConnect(){return ti(this,void 0,void 0,(function*(){let e=!1;this.privAuthFetchEventId=u();const t=this.privRequestSession.sessionId;this.privConnectionId=void 0!==t?t:u(),this.privRequestSession.onPreConnectionStart(this.privAuthFetchEventId,this.privConnectionId);let i=0,r="";for(;this.privRequestSession.numConnectionAttempts<=this.privRecognizerConfig.maxRetryCount;){const t=e?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId),n=yield t;yield this.privRequestSession.onAuthCompleted(!1);const s=this.privConnectionFactory.create(this.privRecognizerConfig,n,this.privConnectionId);this.privRequestSession.listenForServiceTelemetry(s.events),s.events.attach((e=>{this.connectionEvents.onEvent(e)}));const o=yield s.open();if(200===o.statusCode)return yield this.privRequestSession.onConnectionEstablishCompleted(o.statusCode),Promise.resolve(s);1006===o.statusCode&&(e=!0),i=o.statusCode,r=o.reason,this.privRequestSession.onRetryConnection()}return yield this.privRequestSession.onConnectionEstablishCompleted(i,r),Promise.reject(`Unable to contact server. StatusCode: ${i}, ${this.privRecognizerConfig.parameters.getProperty(l.SpeechServiceConnection_Endpoint)} Reason: ${r}`)}))}delay(e){return new Promise((t=>this.privSetTimeout(t,e)))}writeBufferToConsole(e){let t="Buffer Size: ";if(null===e)t+="null";else{const i=new Uint8Array(e);t+=`${e.byteLength}\r\n`;for(let r=0;r<e.byteLength;r++)t+=i[r].toString(16).padStart(2,"0")+" ",(r+1)%16==0&&(console.info(t),t="")}console.info(t)}sendFinalAudio(){return ti(this,void 0,void 0,(function*(){const e=yield this.fetchConnection();yield e.send(new nt(ae.Binary,"audio",this.privRequestSession.requestId,null,null))}))}configureConnection(){return ti(this,void 0,void 0,(function*(){const e=yield this.connectImpl();return void 0!==this.configConnectionOverride?this.configConnectionOverride(e):(yield this.sendSpeechServiceConfig(e,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),yield this.sendPrePayloadJSON(e,!1),e)}))}}ii.telemetryDataEnabled=!0;class ri{constructor(e,t){this.privHeaderName=e,this.privToken=t}get headerName(){return this.privHeaderName}get token(){return this.privToken}}class ni{constructor(e){if(!e)throw new P("subscriptionKey");this.privAuthInfo=new ri(rt.AuthKey,e)}fetch(e){return Promise.resolve(this.privAuthInfo)}fetchOnExpiry(e){return Promise.resolve(this.privAuthInfo)}}class si{constructor(e,t){if(!e)throw new P("fetchCallback");if(!t)throw new P("fetchOnExpiryCallback");this.privFetchCallback=e,this.privFetchOnExpiryCallback=t}fetch(e){return this.privFetchCallback(e).then((e=>new ri(rt.Authorization,void 0===e?void 0:si.privTokenPrefix+e)))}fetchOnExpiry(e){return this.privFetchOnExpiryCallback(e).then((e=>new ri(rt.Authorization,void 0===e?void 0:si.privTokenPrefix+e)))}}si.privTokenPrefix="bearer ";var oi=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class ai{constructor(e,t,i){this.audioConfig=void 0!==e?e:mt.fromDefaultMicrophoneInput(),this.privDisposed=!1,this.privProperties=t.clone(),this.privConnectionFactory=i,this.implCommonRecognizerSetup()}close(e,t){w.throwIfDisposed(this.privDisposed),L(this.dispose(!0),e,t)}get internalData(){return this.privReco}dispose(e){return oi(this,void 0,void 0,(function*(){this.privDisposed||(this.privDisposed=!0,e&&this.privReco&&(yield this.privReco.audioSource.turnOff(),yield this.privReco.dispose()))}))}static get telemetryEnabled(){return ii.telemetryDataEnabled}static enableTelemetry(e){ii.telemetryDataEnabled=e}implCommonRecognizerSetup(){let e="undefined"!=typeof window?"Browser":"Node",t="unknown",i="unknown";"undefined"!=typeof navigator&&(e=e+"/"+navigator.platform,t=navigator.userAgent,i=navigator.appVersion);const r=this.createRecognizerConfig(new D(new O(new z(e,t,i))));this.privReco=this.createServiceRecognizer(ai.getAuthFromProperties(this.privProperties),this.privConnectionFactory,this.audioConfig,r)}recognizeOnceAsyncImpl(e){return oi(this,void 0,void 0,(function*(){w.throwIfDisposed(this.privDisposed);const t=new M;yield this.implRecognizerStop(),yield this.privReco.recognize(e,t.resolve,t.reject);const i=yield t.promise;return yield this.implRecognizerStop(),i}))}startContinuousRecognitionAsyncImpl(e){return oi(this,void 0,void 0,(function*(){w.throwIfDisposed(this.privDisposed),yield this.implRecognizerStop(),yield this.privReco.recognize(e,void 0,void 0)}))}stopContinuousRecognitionAsyncImpl(){return oi(this,void 0,void 0,(function*(){w.throwIfDisposed(this.privDisposed),yield this.implRecognizerStop()}))}implRecognizerStop(){return oi(this,void 0,void 0,(function*(){this.privReco&&(yield this.privReco.stopRecognizing())}))}static getAuthFromProperties(e){const t=e.getProperty(l.SpeechServiceConnection_Key,void 0);return t&&""!==t?new ni(t):new si((()=>{const t=e.getProperty(l.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(t)}),(()=>{const t=e.getProperty(l.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(t)}))}}var ci=i(146),pi=i(173),hi=i(3108),ui=i.n(hi),di=i(2505),li=i.n(di),vi=i(1137),gi=i.n(vi);class fi{constructor(e,t){this.privStatusCode=e,this.privReason=t}get statusCode(){return this.privStatusCode}get reason(){return this.privReason}}class mi{constructor(e,t,i){if(this.privPayload=null,!t)throw new P("payload");if(e===ae.Binary&&"ArrayBuffer"!==t.__proto__.constructor.name)throw new I("Payload must be ArrayBuffer");if(e===ae.Text&&"string"!=typeof t)throw new I("Payload must be a string");this.privMessageType=e,this.privPayload=t,this.privId=i||u()}get messageType(){return this.privMessageType}get payload(){return this.privPayload}get textContent(){if(this.privMessageType===ae.Binary)throw new I("Not supported for binary message");return this.privPayload}get binaryContent(){if(this.privMessageType===ae.Text)throw new I("Not supported for text message");return this.privPayload}get id(){return this.privId}}var Si=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class yi{constructor(e,t,i,r,n,s){if(!e)throw new P("uri");if(!i)throw new P("messageFormatter");this.proxyInfo=r,this.privConnectionEvents=new T,this.privConnectionId=t,this.privMessageFormatter=i,this.privConnectionState=ce.None,this.privUri=e,this.privHeaders=n,this.privEnableCompression=s,this.privHeaders[rt.ConnectionId]=this.privConnectionId,this.privLastErrorReceived=""}get state(){return this.privConnectionState}open(){if(this.privConnectionState===ce.Disconnected)return Promise.reject(`Cannot open a connection that is in ${this.privConnectionState} state`);if(this.privConnectionEstablishDeferral)return this.privConnectionEstablishDeferral.promise;this.privConnectionEstablishDeferral=new M,this.privCertificateValidatedDeferral=new M,this.privConnectionState=ce.Connecting;try{if("undefined"==typeof WebSocket||yi.forceNpmWebSocket){const e={headers:this.privHeaders,perMessageDeflate:this.privEnableCompression};this.privCertificateValidatedDeferral.resolve(),e.agent=this.getAgent();let t=new URL(this.privUri).protocol;"wss:"===(null==t?void 0:t.toLocaleLowerCase())?t="https:":"ws:"===(null==t?void 0:t.toLocaleLowerCase())&&(t="http:"),e.agent.protocol=t,this.privWebsocketClient=new(gi())(this.privUri,e)}else this.privCertificateValidatedDeferral.resolve(),this.privWebsocketClient=new WebSocket(this.privUri);this.privWebsocketClient.binaryType="arraybuffer",this.privReceivingMessageQueue=new Q,this.privDisconnectDeferral=new M,this.privSendMessageQueue=new Q,this.processSendQueue().catch((e=>{b.instance.onEvent(new at(e))}))}catch(e){return this.privConnectionEstablishDeferral.resolve(new fi(500,e)),this.privConnectionEstablishDeferral.promise}return this.onEvent(new Re(this.privConnectionId,this.privUri)),this.privWebsocketClient.onopen=()=>{this.privCertificateValidatedDeferral.promise.then((()=>{this.privConnectionState=ce.Connected,this.onEvent(new Pe(this.privConnectionId)),this.privConnectionEstablishDeferral.resolve(new fi(200,""))}),(e=>{this.privConnectionEstablishDeferral.reject(e)}))},this.privWebsocketClient.onerror=e=>{this.onEvent(new Ae(this.privConnectionId,e.message,e.type)),this.privLastErrorReceived=e.message},this.privWebsocketClient.onclose=e=>{this.privConnectionState===ce.Connecting?(this.privConnectionState=ce.Disconnected,this.privConnectionEstablishDeferral.resolve(new fi(e.code,e.reason+" "+this.privLastErrorReceived))):(this.privConnectionState=ce.Disconnected,this.privWebsocketClient=null,this.onEvent(new Ie(this.privConnectionId,e.code,e.reason))),this.onClose(e.code,e.reason).catch((e=>{b.instance.onEvent(new at(e))}))},this.privWebsocketClient.onmessage=e=>{const t=(new Date).toISOString();if(this.privConnectionState===ce.Connected){const i=new M;if(this.privReceivingMessageQueue.enqueueFromPromise(i.promise),e.data instanceof ArrayBuffer){const r=new mi(ae.Binary,e.data);this.privMessageFormatter.toConnectionMessage(r).then((e=>{this.onEvent(new be(this.privConnectionId,t,e)),i.resolve(e)}),(e=>{i.reject(`Invalid binary message format. Error: ${e}`)}))}else{const r=new mi(ae.Text,e.data);this.privMessageFormatter.toConnectionMessage(r).then((e=>{this.onEvent(new be(this.privConnectionId,t,e)),i.resolve(e)}),(e=>{i.reject(`Invalid text message format. Error: ${e}`)}))}}},this.privConnectionEstablishDeferral.promise}send(e){if(this.privConnectionState!==ce.Connected)return Promise.reject(`Cannot send on connection that is in ${ce[this.privConnectionState]} state`);const t=new M,i=new M;return this.privSendMessageQueue.enqueueFromPromise(i.promise),this.privMessageFormatter.fromConnectionMessage(e).then((r=>{i.resolve({Message:e,RawWebsocketMessage:r,sendStatusDeferral:t})}),(e=>{i.reject(`Error formatting the message. ${e}`)})),t.promise}read(){return this.privConnectionState!==ce.Connected?Promise.reject(`Cannot read on connection that is in ${this.privConnectionState} state`):this.privReceivingMessageQueue.dequeue()}close(e){return this.privWebsocketClient?(this.privConnectionState!==ce.Disconnected&&this.privWebsocketClient.close(1e3,e||"Normal closure by client"),this.privDisconnectDeferral.promise):Promise.resolve()}get events(){return this.privConnectionEvents}sendRawMessage(e){try{return e?(this.onEvent(new Ee(this.privConnectionId,(new Date).toISOString(),e.Message)),this.isWebsocketOpen?(this.privWebsocketClient.send(e.RawWebsocketMessage.payload),Promise.resolve()):Promise.reject("websocket send error: Websocket not ready "+this.privConnectionId+" "+e.Message.id+" "+(new Error).stack)):Promise.resolve()}catch(e){return Promise.reject(`websocket send error: ${e}`)}}onClose(e,t){return Si(this,void 0,void 0,(function*(){const i=`Connection closed. ${e}: ${t}`;this.privConnectionState=ce.Disconnected,this.privDisconnectDeferral.resolve(),yield this.privReceivingMessageQueue.drainAndDispose((()=>{}),i),yield this.privSendMessageQueue.drainAndDispose((e=>{e.sendStatusDeferral.reject(i)}),i)}))}processSendQueue(){return Si(this,void 0,void 0,(function*(){for(;;){const e=this.privSendMessageQueue.dequeue(),t=yield e;if(!t)return;try{yield this.sendRawMessage(t),t.sendStatusDeferral.resolve()}catch(e){t.sendStatusDeferral.reject(e)}}}))}onEvent(e){this.privConnectionEvents.onEvent(e),b.instance.onEvent(e)}getAgent(){const e=new(ui().Agent)(this.createConnection);return void 0!==this.proxyInfo&&void 0!==this.proxyInfo.HostName&&this.proxyInfo.Port>0&&(e.proxyInfo=this.proxyInfo),e}static GetProxyAgent(e){const t={host:e.HostName,port:e.Port};return e.UserName?t.headers={"Proxy-Authentication":"Basic "+new Buffer(`${e.UserName}:${void 0===e.Password?"":e.Password}`).toString("base64")}:t.headers={},t.headers.requestOCSP="true",new(li())(t)}createConnection(e,t){let i;if(t=Object.assign(Object.assign({},t),{requestOCSP:!0,servername:t.host}),this.proxyInfo){const r=yi.GetProxyAgent(this.proxyInfo);i=new Promise(((i,n)=>{r.callback(e,t,((e,t)=>{e?n(e):i(t)}))}))}else i=t.secureEndpoint?Promise.resolve(pi.connect(t)):Promise.resolve(ci.connect(t));return i}get isWebsocketOpen(){return this.privWebsocketClient&&this.privWebsocketClient.readyState===this.privWebsocketClient.OPEN}}yi.forceNpmWebSocket=!1;var Ci,wi;class Ri{constructor(e,t,i,r,n,s=!1,o){if(this.privIsDisposed=!1,!e)throw new P("uri");if(!r)throw new P("messageFormatter");this.privMessageFormatter=r;let a="",c=0;if(t)for(const i in t)if(i){a+=0===c&&-1===e.indexOf("?")?"?":"&",a+=encodeURIComponent(i);let r=t[i];r&&(r=encodeURIComponent(r),a+=`=${r}`),c++}if(i)for(const t in i)t&&(a+=0===c&&-1===e.indexOf("?")?"?":"&",a+=`${t}=${encodeURIComponent(i[t])}`,c++);this.privUri=e+a,this.privId=o||u(),this.privConnectionMessageAdapter=new yi(this.privUri,this.id,this.privMessageFormatter,n,i,s)}dispose(){return e=this,t=void 0,r=function*(){this.privIsDisposed=!0,this.privConnectionMessageAdapter&&(yield this.privConnectionMessageAdapter.close())},new((i=void 0)||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}));var e,t,i,r}isDisposed(){return this.privIsDisposed}get id(){return this.privId}get uri(){return this.privUri}state(){return this.privConnectionMessageAdapter.state}open(){return this.privConnectionMessageAdapter.open()}send(e){return this.privConnectionMessageAdapter.send(e)}read(){return this.privConnectionMessageAdapter.read()}get events(){return this.privConnectionMessageAdapter.events}}class Pi{constructor(e,t,i,r){this.privProxyHostName=e,this.privProxyPort=t,this.privProxyUserName=i,this.privProxyPassword=r}static fromParameters(e){return new Pi(e.getProperty(l.SpeechServiceConnection_ProxyHostName),parseInt(e.getProperty(l.SpeechServiceConnection_ProxyPort),10),e.getProperty(l.SpeechServiceConnection_ProxyUserName),e.getProperty(l.SpeechServiceConnection_ProxyPassword))}static fromRecognizerConfig(e){return this.fromParameters(e.parameters)}get HostName(){return this.privProxyHostName}get Port(){return this.privProxyPort}get UserName(){return this.privProxyUserName}get Password(){return this.privProxyPassword}}class Ii{}Ii.BotId="botid",Ii.CustomSpeechDeploymentId="cid",Ii.CustomVoiceDeploymentId="deploymentId",Ii.EnableAudioLogging="storeAudio",Ii.EnableLanguageId="lidEnabled",Ii.EnableWordLevelTimestamps="wordLevelTimestamps",Ii.EndSilenceTimeoutMs="endSilenceTimeoutMs",Ii.SegmentationSilenceTimeoutMs="segmentationSilenceTimeoutMs",Ii.Format="format",Ii.InitialSilenceTimeoutMs="initialSilenceTimeoutMs",Ii.Language="language",Ii.Profanity="profanity",Ii.RequestBotStatusMessages="enableBotMessageStatus",Ii.StableIntermediateThreshold="stableIntermediateThreshold",Ii.StableTranslation="stableTranslation",Ii.TestHooks="testhooks",Ii.Postprocessing="postprocessing",Ii.CtsMeetingId="meetingId",Ii.CtsDeviceId="deviceId",Ii.CtsIsParticipant="isParticipant";class Ai{static getHostSuffix(e){if(e){if(e.toLowerCase().startsWith("china"))return".azure.cn";if(e.toLowerCase().startsWith("usgov"))return".azure.us"}return".microsoft.com"}setCommonUrlParams(e,t,i){new Map([[l.Speech_SegmentationSilenceTimeoutMs,Ii.SegmentationSilenceTimeoutMs],[l.SpeechServiceConnection_EnableAudioLogging,Ii.EnableAudioLogging],[l.SpeechServiceConnection_EndSilenceTimeoutMs,Ii.EndSilenceTimeoutMs],[l.SpeechServiceConnection_InitialSilenceTimeoutMs,Ii.InitialSilenceTimeoutMs],[l.SpeechServiceResponse_PostProcessingOption,Ii.Postprocessing],[l.SpeechServiceResponse_ProfanityOption,Ii.Profanity],[l.SpeechServiceResponse_RequestWordLevelTimestamps,Ii.EnableWordLevelTimestamps],[l.SpeechServiceResponse_StablePartialResultThreshold,Ii.StableIntermediateThreshold]]).forEach(((r,n)=>{this.setUrlParameter(n,r,e,t,i)}));const r=JSON.parse(e.parameters.getProperty(et,"{}"));Object.keys(r).forEach((e=>{t[e]=r[e]}))}setUrlParameter(e,t,i,r,n){const s=i.parameters.getProperty(e,void 0);!s||n&&-1!==n.search(t)||(r[t]=s.toLocaleLowerCase())}}class Ti{toConnectionMessage(e){const t=new M;try{if(e.messageType===ae.Text){const i=e.textContent;let r={},n=null;if(i){const e=i.split("\r\n\r\n");e&&e.length>0&&(r=this.parseHeaders(e[0]),e.length>1&&(n=e[1]))}t.resolve(new ye(e.messageType,n,r,e.id))}else if(e.messageType===ae.Binary){const i=e.binaryContent;let r={},n=null;if(!i||i.byteLength<2)throw new Error("Invalid binary message format. Header length missing.");const s=new DataView(i),o=s.getInt16(0);if(i.byteLength<o+2)throw new Error("Invalid binary message format. Header content missing.");let a="";for(let e=0;e<o;e++)a+=String.fromCharCode(s.getInt8(e+2));r=this.parseHeaders(a),i.byteLength>o+2&&(n=i.slice(2+o)),t.resolve(new ye(e.messageType,n,r,e.id))}}catch(e){t.reject(`Error formatting the message. Error: ${e}`)}return t.promise}fromConnectionMessage(e){const t=new M;try{if(e.messageType===ae.Text){const i=`${this.makeHeaders(e)}\r\n${e.textBody?e.textBody:""}`;t.resolve(new mi(ae.Text,i,e.id))}else if(e.messageType===ae.Binary){const i=this.makeHeaders(e),r=e.binaryBody,n=this.stringToArrayBuffer(i),s=new Int8Array(n),o=s.byteLength,a=new Int8Array(2+o+(r?r.byteLength:0));if(a[0]=o>>8&255,a[1]=255&o,a.set(s,2),r){const e=new Int8Array(r);a.set(e,2+o)}const c=a.buffer;t.resolve(new mi(ae.Binary,c,e.id))}}catch(e){t.reject(`Error formatting the message. ${e}`)}return t.promise}makeHeaders(e){let t="";if(e.headers)for(const i in e.headers)i&&(t+=`${i}: ${e.headers[i]}\r\n`);return t}parseHeaders(e){const t={};if(e){const i=e.match(/[^\r\n]+/g);if(t)for(const e of i)if(e){const i=e.indexOf(":"),r=i>0?e.substr(0,i).trim().toLowerCase():e,n=i>0&&e.length>i+1?e.substr(i+1).trim():"";t[r]=n}}return t}stringToArrayBuffer(e){const t=new ArrayBuffer(e.length),i=new DataView(t);for(let t=0;t<e.length;t++)i.setUint8(t,e.charCodeAt(t));return t}}class bi extends Ai{constructor(){super(...arguments),this.interactiveRelativeUri="/speech/recognition/interactive/cognitiveservices/v1",this.conversationRelativeUri="/speech/recognition/conversation/cognitiveservices/v1",this.dictationRelativeUri="/speech/recognition/dictation/cognitiveservices/v1",this.universalUri="/speech/universal/v"}create(e,t,i){let r=e.parameters.getProperty(l.SpeechServiceConnection_Endpoint,void 0);const n=e.parameters.getProperty(l.SpeechServiceConnection_Region,void 0),s=Ai.getHostSuffix(n),o=e.parameters.getProperty(l.SpeechServiceConnection_Host,"wss://"+n+".stt.speech"+s),a={},c=e.parameters.getProperty(l.SpeechServiceConnection_EndpointId,void 0),p=e.parameters.getProperty(l.SpeechServiceConnection_RecoLanguage,void 0);if(c?r&&-1!==r.search(Ii.CustomSpeechDeploymentId)||(a[Ii.CustomSpeechDeploymentId]=c):p&&(r&&-1!==r.search(Ii.Language)||(a[Ii.Language]=p)),r&&-1!==r.search(Ii.Format)||(a[Ii.Format]=e.parameters.getProperty(Xe,dt[dt.Simple]).toLowerCase()),void 0!==e.autoDetectSourceLanguages&&(a[Ii.EnableLanguageId]="true"),this.setCommonUrlParams(e,a,r),!r)switch(e.recognitionMode){case v.Conversation:r="true"===e.parameters.getProperty(tt,"false")?o+this.dictationRelativeUri:void 0!==e.recognitionEndpointVersion&&parseInt(e.recognitionEndpointVersion,10)>1?`${o}${this.universalUri}${e.recognitionEndpointVersion}`:o+this.conversationRelativeUri;break;case v.Dictation:r=o+this.dictationRelativeUri;break;default:r=void 0!==e.recognitionEndpointVersion&&parseInt(e.recognitionEndpointVersion,10)>1?`${o}${this.universalUri}${e.recognitionEndpointVersion}`:o+this.interactiveRelativeUri}const h={};void 0!==t.token&&""!==t.token&&(h[t.headerName]=t.token),h[rt.ConnectionId]=i;const u="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false"),d=new Ri(r,a,h,new Ti,Pi.fromRecognizerConfig(e),u,i),g=d.uri;return e.parameters.setProperty(l.SpeechServiceConnection_Url,g),d}}class Ei{constructor(e){this.privSpeechHypothesis=JSON.parse(e)}static fromJSON(e){return new Ei(e)}get Text(){return this.privSpeechHypothesis.Text}get Offset(){return this.privSpeechHypothesis.Offset}get Duration(){return this.privSpeechHypothesis.Duration}get Language(){return void 0===this.privSpeechHypothesis.PrimaryLanguage?void 0:this.privSpeechHypothesis.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return void 0===this.privSpeechHypothesis.PrimaryLanguage?void 0:this.privSpeechHypothesis.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSpeechHypothesis.SpeakerId}}!function(e){e[e.Success=0]="Success",e[e.SynthesisEnd=1]="SynthesisEnd",e[e.Error=2]="Error"}(Ci||(Ci={})),function(e){e[e.Success=0]="Success",e[e.NoMatch=1]="NoMatch",e[e.InitialSilenceTimeout=2]="InitialSilenceTimeout",e[e.BabbleTimeout=3]="BabbleTimeout",e[e.Error=4]="Error",e[e.EndOfDictation=5]="EndOfDictation",e[e.TooManyRequests=6]="TooManyRequests",e[e.BadRequest=7]="BadRequest",e[e.Forbidden=8]="Forbidden"}(wi||(wi={}));class ki{constructor(e){this.privSimpleSpeechPhrase=JSON.parse(e),this.privSimpleSpeechPhrase.RecognitionStatus=wi[this.privSimpleSpeechPhrase.RecognitionStatus]}static fromJSON(e){return new ki(e)}get RecognitionStatus(){return this.privSimpleSpeechPhrase.RecognitionStatus}get DisplayText(){return this.privSimpleSpeechPhrase.DisplayText}get Offset(){return this.privSimpleSpeechPhrase.Offset}get Duration(){return this.privSimpleSpeechPhrase.Duration}get Language(){return void 0===this.privSimpleSpeechPhrase.PrimaryLanguage?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return void 0===this.privSimpleSpeechPhrase.PrimaryLanguage?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSimpleSpeechPhrase.SpeakerId}}class xi{static implTranslateRecognitionResult(e){let t=ue.Canceled;switch(e){case wi.Success:t=ue.RecognizedSpeech;break;case wi.NoMatch:case wi.InitialSilenceTimeout:case wi.BabbleTimeout:case wi.EndOfDictation:t=ue.NoMatch;break;case wi.Error:case wi.BadRequest:case wi.Forbidden:default:t=ue.Canceled}return t}static implTranslateCancelResult(e){let t=pe.EndOfStream;switch(e){case wi.Success:case wi.EndOfDictation:case wi.NoMatch:t=pe.EndOfStream;break;case wi.InitialSilenceTimeout:case wi.BabbleTimeout:case wi.Error:case wi.BadRequest:case wi.Forbidden:default:t=pe.Error}return t}static implTranslateCancelErrorCode(e){let t=he.NoError;switch(e){case wi.Error:t=he.ServiceError;break;case wi.TooManyRequests:t=he.TooManyRequests;break;case wi.BadRequest:t=he.BadRequestParameters;break;case wi.Forbidden:t=he.Forbidden;break;default:t=he.NoError}return t}static implTranslateErrorDetails(e){let t="The speech service encountered an internal error and could not continue.";switch(e){case he.Forbidden:t="The recognizer is using a free subscription that ran out of quota.";break;case he.BadRequestParameters:t="Invalid parameter or unsupported audio format in the request.";break;case he.TooManyRequests:t="The number of parallel requests exceeded the number of allowed concurrent transcriptions."}return t}}class Di{constructor(e){this.privDetailedSpeechPhrase=JSON.parse(e),this.privDetailedSpeechPhrase.RecognitionStatus=wi[this.privDetailedSpeechPhrase.RecognitionStatus]}static fromJSON(e){return new Di(e)}getJsonWithCorrectedOffsets(e){if(this.privDetailedSpeechPhrase.NBest){let t;for(const e of this.privDetailedSpeechPhrase.NBest)if(e.Words&&e.Words[0]){t=e.Words[0].Offset;break}if(t&&t<e){const i=e-t;for(const e of this.privDetailedSpeechPhrase.NBest){if(e.Words)for(const t of e.Words)t.Offset+=i;if(e.DisplayWords)for(const t of e.DisplayWords)t.Offset+=i}}}return JSON.stringify(this.privDetailedSpeechPhrase)}get RecognitionStatus(){return this.privDetailedSpeechPhrase.RecognitionStatus}get NBest(){return this.privDetailedSpeechPhrase.NBest}get Duration(){return this.privDetailedSpeechPhrase.Duration}get Offset(){return this.privDetailedSpeechPhrase.Offset}get Language(){return void 0===this.privDetailedSpeechPhrase.PrimaryLanguage?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return void 0===this.privDetailedSpeechPhrase.PrimaryLanguage?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Confidence}get Text(){return this.privDetailedSpeechPhrase.NBest&&this.privDetailedSpeechPhrase.NBest[0]?this.privDetailedSpeechPhrase.NBest[0].Display||this.privDetailedSpeechPhrase.NBest[0].DisplayText:this.privDetailedSpeechPhrase.DisplayText}get SpeakerId(){return this.privDetailedSpeechPhrase.SpeakerId}}class Oi extends ii{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privSpeechRecognizer=n}processTypeSpecificMessages(e){return t=this,i=void 0,n=function*(){let t;const i=new Oe;i.setProperty(l.SpeechServiceResponse_JsonResult,e.textBody);let r=!1;switch(e.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":const n=Ei.fromJSON(e.textBody),s=n.Offset+this.privRequestSession.currentTurnAudioOffset;t=new At(this.privRequestSession.requestId,ue.RecognizingSpeech,n.Text,n.Duration,s,n.Language,n.LanguageDetectionConfidence,void 0,void 0,e.textBody,i),this.privRequestSession.onHypothesis(s);const o=new kt(t,n.Duration,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognizing)try{this.privSpeechRecognizer.recognizing(this.privSpeechRecognizer,o)}catch(e){}r=!0;break;case"speech.phrase":const a=ki.fromJSON(e.textBody),c=xi.implTranslateRecognitionResult(a.RecognitionStatus);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+a.Offset+a.Duration),ue.Canceled===c){const e=xi.implTranslateCancelResult(a.RecognitionStatus),t=xi.implTranslateCancelErrorCode(a.RecognitionStatus);yield this.cancelRecognitionLocal(e,t,xi.implTranslateErrorDetails(t))}else{if(!this.privRequestSession.isSpeechEnded||c!==ue.NoMatch||a.RecognitionStatus===wi.InitialSilenceTimeout){if(this.privRecognizerConfig.parameters.getProperty(Xe)===dt[dt.Simple])t=new At(this.privRequestSession.requestId,c,a.DisplayText,a.Duration,a.Offset+this.privRequestSession.currentTurnAudioOffset,a.Language,a.LanguageDetectionConfidence,void 0,void 0,e.textBody,i);else{const r=Di.fromJSON(e.textBody),n=r.Offset+this.privRequestSession.currentTurnAudioOffset,s=r.getJsonWithCorrectedOffsets(n);t=new At(this.privRequestSession.requestId,c,r.RecognitionStatus===wi.Success?r.NBest[0].Display:void 0,r.Duration,n,r.Language,r.LanguageDetectionConfidence,void 0,void 0,s,i)}const r=new kt(t,t.offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognized)try{this.privSpeechRecognizer.recognized(this.privSpeechRecognizer,r)}catch(e){}}if(this.privSuccessCallback){try{this.privSuccessCallback(t)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}r=!0}return r},new((r=void 0)||(r=Promise))((function(e,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(o,a)}c((n=n.apply(t,i||[])).next())}));var t,i,r,n}cancelRecognition(e,t,i,r,n){const s=new Oe;if(s.setProperty(Ye,he[r]),this.privSpeechRecognizer.canceled){const t=new Ot(i,n,r,void 0,e);try{this.privSpeechRecognizer.canceled(this.privSpeechRecognizer,t)}catch(e){}}if(this.privSuccessCallback){const e=new At(t,ue.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,n,void 0,s);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch(e){}}}}class Ni extends ai{constructor(e,t){const i=e;w.throwIfNull(i,"speechConfig"),w.throwIfNullOrWhitespace(i.properties.getProperty(l.SpeechServiceConnection_RecoLanguage),l[l.SpeechServiceConnection_RecoLanguage]),super(t,i.properties,new bi),this.privDisposedRecognizer=!1}static FromConfig(e,t,i){const r=e;return t.properties.mergeTo(r.properties),new Ni(e,i)}get endpointId(){return w.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(l.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(l.SpeechServiceAuthorization_Token)}set authorizationToken(e){w.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(l.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return w.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(l.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return w.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(Xe,dt[dt.Simple])===dt[dt.Simple]?dt.Simple:dt.Detailed}get properties(){return this.privProperties}recognizeOnceAsync(e,t){L(this.recognizeOnceAsyncImpl(v.Interactive),e,t)}startContinuousRecognitionAsync(e,t){L(this.startContinuousRecognitionAsyncImpl(v.Conversation),e,t)}stopContinuousRecognitionAsync(e,t){L(this.stopContinuousRecognitionAsyncImpl(),e,t)}startKeywordRecognitionAsync(e,t,i){w.throwIfNull(e,"model"),i&&i("Not yet implemented.")}stopKeywordRecognitionAsync(e){e&&e()}close(e,t){w.throwIfDisposed(this.privDisposedRecognizer),L(this.dispose(!0),e,t)}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return i=this,r=void 0,s=function*(){this.privDisposedRecognizer||(e&&(this.privDisposedRecognizer=!0,yield this.implRecognizerStop()),yield t.dispose.call(this,e))},new((n=void 0)||(n=Promise))((function(e,t){function o(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}c((s=s.apply(i,r||[])).next())}));var i,r,n,s}createRecognizerConfig(e){return new x(e,this.privProperties)}createServiceRecognizer(e,t,i,r){return new Oi(e,t,i,r,this)}}class zi extends Ai{create(e,t,i){let r=e.parameters.getProperty(l.SpeechServiceConnection_Endpoint);if(!r){const t=e.parameters.getProperty(l.SpeechServiceConnection_IntentRegion),i=Ai.getHostSuffix(t);r=e.parameters.getProperty(l.SpeechServiceConnection_Host,"wss://"+t+".sr.speech"+i)+"/speech/recognition/interactive/cognitiveservices/v1"}const n={format:"simple",language:e.parameters.getProperty(l.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(e,n,r);const s={};void 0!==t.token&&""!==t.token&&(s[t.headerName]=t.token),s[rt.ConnectionId]=i,e.parameters.setProperty(l.SpeechServiceConnection_Url,r);const o="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new Ri(r,n,s,new Ti,Pi.fromRecognizerConfig(e),o,i)}getSpeechRegionFromIntentRegion(e){switch(e){case"West US":case"US West":case"westus":return"uswest";case"West US 2":case"US West 2":case"westus2":return"uswest2";case"South Central US":case"US South Central":case"southcentralus":return"ussouthcentral";case"West Central US":case"US West Central":case"westcentralus":return"uswestcentral";case"East US":case"US East":case"eastus":return"useast";case"East US 2":case"US East 2":case"eastus2":return"useast2";case"West Europe":case"Europe West":case"westeurope":return"europewest";case"North Europe":case"Europe North":case"northeurope":return"europenorth";case"Brazil South":case"South Brazil":case"southbrazil":return"brazilsouth";case"Australia East":case"East Australia":case"eastaustralia":return"australiaeast";case"Southeast Asia":case"Asia Southeast":case"southeastasia":return"asiasoutheast";case"East Asia":case"Asia East":case"eastasia":return"asiaeast";default:return e}}}class Mi{constructor(e,t){this.modelImpl=e,this.intentName=t}}class Li extends Pt{constructor(e,t,i,r,n,s){super(r,n,s),this.privReason=e,this.privErrorDetails=t,this.privErrorCode=i}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}class _i{constructor(e){this.privIntentResponse=""===e?{}:JSON.parse(e)}static fromJSON(e){return new _i(e)}get query(){return this.privIntentResponse.query}get topScoringIntent(){return this.privIntentResponse.topScoringIntent}get entities(){return this.privIntentResponse.entities}}class Bi extends ii{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privIntentRecognizer=n,this.privIntentDataSent=!1}setIntents(e,t){this.privAddedLmIntents=e,this.privUmbrellaIntent=t,this.privIntentDataSent=!0}processTypeSpecificMessages(e){let t,i,r=!1;const n=new Oe;switch(e.messageType===ae.Text&&n.setProperty(l.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"speech.hypothesis":const s=Ei.fromJSON(e.textBody);if(t=new Tt(void 0,this.privRequestSession.requestId,ue.RecognizingIntent,s.Text,s.Duration,s.Offset+this.privRequestSession.currentTurnAudioOffset,s.Language,s.LanguageDetectionConfidence,void 0,e.textBody,n),this.privRequestSession.onHypothesis(t.offset),i=new Pt(t,s.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId),this.privIntentRecognizer.recognizing)try{this.privIntentRecognizer.recognizing(this.privIntentRecognizer,i)}catch(e){}r=!0;break;case"speech.phrase":const o=ki.fromJSON(e.textBody);t=new Tt(void 0,this.privRequestSession.requestId,xi.implTranslateRecognitionResult(o.RecognitionStatus),o.DisplayText,o.Duration,o.Offset+this.privRequestSession.currentTurnAudioOffset,o.Language,o.LanguageDetectionConfidence,void 0,e.textBody,n),i=new Pt(t,t.offset,this.privRequestSession.sessionId);const a=()=>{if(this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,i)}catch(e){}if(this.privSuccessCallback){try{this.privSuccessCallback(t)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}};!1===this.privIntentDataSent||ue.NoMatch===i.result.reason?(this.privRequestSession.onPhraseRecognized(i.offset+i.result.duration),a()):this.privPendingIntentArgs=i,r=!0;break;case"response":if(i=this.privPendingIntentArgs,this.privPendingIntentArgs=void 0,void 0===i){if(""===e.textBody)return;i=new Pt(new Tt,0,this.privRequestSession.sessionId)}const c=_i.fromJSON(e.textBody);if(null!==c&&c.topScoringIntent&&c.topScoringIntent.intent){let t=this.privAddedLmIntents[c.topScoringIntent.intent];if(void 0!==this.privUmbrellaIntent&&(t=this.privUmbrellaIntent),t){const r=void 0===t||void 0===t.intentName?c.topScoringIntent.intent:t.intentName;let n=i.result.reason;void 0!==r&&(n=ue.RecognizedIntent);const s=void 0!==i.result.properties?i.result.properties:new Oe;s.setProperty(l.LanguageUnderstandingServiceResponse_JsonResult,e.textBody),i=new Pt(new Tt(r,i.result.resultId,n,i.result.text,i.result.duration,i.result.offset,void 0,void 0,i.result.errorDetails,i.result.json,s),i.offset,i.sessionId)}}if(this.privRequestSession.onPhraseRecognized(i.offset+i.result.duration),this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,i)}catch(e){}if(this.privSuccessCallback){try{this.privSuccessCallback(i.result)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}r=!0}const s=new M;return s.resolve(r),s.promise}cancelRecognition(e,t,i,r,n){const s=new Oe;if(s.setProperty(Ye,he[r]),this.privIntentRecognizer.canceled){const t=new Li(i,n,r,void 0,void 0,e);try{this.privIntentRecognizer.canceled(this.privIntentRecognizer,t)}catch(e){}}if(this.privSuccessCallback){const e=new Tt(void 0,t,ue.Canceled,void 0,void 0,void 0,void 0,void 0,n,void 0,s);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch(e){}}}}var qi,Ui;class Fi extends ai{constructor(e,t){w.throwIfNullOrUndefined(e,"speechConfig");const i=e;w.throwIfNullOrUndefined(i,"speechConfig"),super(t,i.properties,new zi),this.privAddedIntents=[],this.privAddedLmIntents={},this.privDisposedIntentRecognizer=!1,this.privProperties=i.properties,w.throwIfNullOrWhitespace(this.properties.getProperty(l.SpeechServiceConnection_RecoLanguage),l[l.SpeechServiceConnection_RecoLanguage])}get speechRecognitionLanguage(){return w.throwIfDisposed(this.privDisposedIntentRecognizer),this.properties.getProperty(l.SpeechServiceConnection_RecoLanguage)}get authorizationToken(){return this.properties.getProperty(l.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.properties.setProperty(l.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}recognizeOnceAsync(e,t){if(w.throwIfDisposed(this.privDisposedIntentRecognizer),0!==Object.keys(this.privAddedLmIntents).length||void 0!==this.privUmbrellaIntent){const e=this.buildSpeechContext();this.privReco.speechContext.setSection("intent",e.Intent),this.privReco.dynamicGrammar.addReferenceGrammar(e.ReferenceGrammars),this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}L(this.recognizeOnceAsyncImpl(v.Interactive),e,t)}startContinuousRecognitionAsync(e,t){if(0!==Object.keys(this.privAddedLmIntents).length||void 0!==this.privUmbrellaIntent){const e=this.buildSpeechContext();this.privReco.speechContext.setSection("intent",e.Intent),this.privReco.dynamicGrammar.addReferenceGrammar(e.ReferenceGrammars),this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}L(this.startContinuousRecognitionAsyncImpl(v.Conversation),e,t)}stopContinuousRecognitionAsync(e,t){L(this.stopContinuousRecognitionAsyncImpl(),e,t)}startKeywordRecognitionAsync(e,t,i){w.throwIfNull(e,"model"),i&&i("Not yet implemented.")}stopKeywordRecognitionAsync(e,t){if(e)try{e()}catch(e){t&&t(e)}}addIntent(e,t){w.throwIfDisposed(this.privDisposedIntentRecognizer),w.throwIfNullOrWhitespace(t,"intentId"),w.throwIfNullOrWhitespace(e,"simplePhrase"),this.privAddedIntents.push([t,e])}addIntentWithLanguageModel(e,t,i){w.throwIfDisposed(this.privDisposedIntentRecognizer),w.throwIfNullOrWhitespace(e,"intentId"),w.throwIfNull(t,"model");const r=t;w.throwIfNullOrWhitespace(r.appId,"model.appId"),this.privAddedLmIntents[e]=new Mi(r,i)}addAllIntents(e,t){w.throwIfNull(e,"model");const i=e;w.throwIfNullOrWhitespace(i.appId,"model.appId"),this.privUmbrellaIntent=new Mi(i,t)}close(e,t){w.throwIfDisposed(this.privDisposedIntentRecognizer),L(this.dispose(!0),e,t)}createRecognizerConfig(e){return new x(e,this.privProperties)}createServiceRecognizer(e,t,i,r){return new Bi(e,t,i,r,this)}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return i=this,r=void 0,s=function*(){this.privDisposedIntentRecognizer||e&&(this.privDisposedIntentRecognizer=!0,yield t.dispose.call(this,e))},new((n=void 0)||(n=Promise))((function(e,t){function o(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,a)}c((s=s.apply(i,r||[])).next())}));var i,r,n,s}buildSpeechContext(){let e,t,i;const r=[];void 0!==this.privUmbrellaIntent&&(e=this.privUmbrellaIntent.modelImpl.appId,t=this.privUmbrellaIntent.modelImpl.region,i=this.privUmbrellaIntent.modelImpl.subscriptionKey);for(const n of Object.keys(this.privAddedLmIntents)){const s=this.privAddedLmIntents[n];if(void 0===e)e=s.modelImpl.appId;else if(e!==s.modelImpl.appId)throw new Error("Intents must all be from the same LUIS model");if(void 0===t)t=s.modelImpl.region;else if(t!==s.modelImpl.region)throw new Error("Intents must all be from the same LUIS model in a single region");if(void 0===i)i=s.modelImpl.subscriptionKey;else if(i!==s.modelImpl.subscriptionKey)throw new Error("Intents must all use the same subscription key");const o="luis/"+e+"-PRODUCTION#"+n;r.push(o)}return{Intent:{id:e,key:void 0===i?this.privProperties.getProperty(l[l.SpeechServiceConnection_Key]):i,provider:"LUIS"},ReferenceGrammars:void 0===this.privUmbrellaIntent?r:["luis/"+e+"-PRODUCTION"]}}}!function(e){e[e.TextIndependentIdentification=0]="TextIndependentIdentification",e[e.TextDependentVerification=1]="TextDependentVerification",e[e.TextIndependentVerification=2]="TextIndependentVerification"}(qi||(qi={}));class Ki{static formatString(e,t){if(!e)return"";if(!t)return e;let i="",r="";const n=e=>{i+=e},s=e=>{r+=e};let o=n;for(let a=0;a<e.length;a++){const c=e[a],p=a+1<e.length?e[a+1]:"";switch(c){case"{":"{"===p?(o("{"),a++):o=s;break;case"}":"}"===p?(o("}"),a++):(t.hasOwnProperty(r)&&(i+=t[r]),o=n,r="");break;default:o(c)}}return i}}class Hi extends Ai{create(e,t,i){const r=this.getEndpointUrl(e),n={};void 0!==e.autoDetectSourceLanguages&&(n[Ii.EnableLanguageId]="true"),this.setQueryParams(n,e,r);const s={};void 0!==t.token&&""!==t.token&&(s[t.headerName]=t.token),s[rt.ConnectionId]=i,e.parameters.setProperty(l.SpeechServiceConnection_Url,r);const o="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new Ri(r,n,s,new Ti,Pi.fromRecognizerConfig(e),o,i)}getEndpointUrl(e,t){const i=e.parameters.getProperty(l.SpeechServiceConnection_Region),r=Ai.getHostSuffix(i);let n=e.parameters.getProperty(l.SpeechServiceConnection_Endpoint,void 0);return n||(n=void 0!==e.autoDetectSourceLanguages?e.parameters.getProperty(l.SpeechServiceConnection_Host,"wss://{region}.stt.speech"+r)+"/speech/universal/v2":e.parameters.getProperty(l.SpeechServiceConnection_Host,"wss://{region}.s2s.speech"+r)+"/speech/translation/cognitiveservices/v1"),!0===t?n:Ki.formatString(n,{region:i})}setQueryParams(e,t,i){e.from=t.parameters.getProperty(l.SpeechServiceConnection_RecoLanguage),e.to=t.parameters.getProperty(l.SpeechServiceConnection_TranslationToLanguages),this.setCommonUrlParams(t,e,i),this.setUrlParameter(l.SpeechServiceResponse_TranslationRequestStablePartialResult,Ii.StableTranslation,t,e,i);const r=t.parameters.getProperty(l.SpeechServiceConnection_TranslationVoice,void 0);void 0!==r&&(e.voice=r,e.features="texttospeech")}}!function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(Ui||(Ui={}));class Wi{constructor(e,t,i,r,n){this.privCancelReason=t,this.privErrorDetails=i,this.privResult=n,this.privSessionId=e,this.privErrorCode=r}get result(){return this.privResult}get sessionId(){return this.privSessionId}get reason(){return this.privCancelReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}class ji{constructor(){this.privMap=new Oe}get languages(){return this.privMap.keys}get(e,t){return this.privMap.getProperty(e,t)}set(e,t){this.privMap.setProperty(e,t)}}var Ji=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Vi extends ii{constructor(e,t,i,r,n){super(e,t,i,r,n),this.handleSpeechPhraseMessage=e=>Ji(this,void 0,void 0,(function*(){return this.handleSpeechPhrase(e)})),this.handleSpeechHypothesisMessage=e=>this.handleSpeechHypothesis(e)}processTypeSpecificMessages(e){}handleRecognizedCallback(e,t,i){}handleRecognizingCallback(e,t,i){}processSpeechMessages(e){return Ji(this,void 0,void 0,(function*(){let t=!1;switch(e.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":this.handleSpeechHypothesisMessage&&this.handleSpeechHypothesisMessage(e.textBody),t=!0;break;case"speech.phrase":this.handleSpeechPhraseMessage&&(yield this.handleSpeechPhraseMessage(e.textBody)),t=!0}return t}))}cancelRecognition(e,t,i,r,n){}handleSpeechPhrase(e){return Ji(this,void 0,void 0,(function*(){const t=ki.fromJSON(e),i=xi.implTranslateRecognitionResult(t.RecognitionStatus);let r;const n=new Oe;n.setProperty(l.SpeechServiceResponse_JsonResult,e);const s=t.Offset+this.privRequestSession.currentTurnAudioOffset;let o=s;if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+t.Offset+t.Duration),ue.Canceled===i){const e=xi.implTranslateCancelResult(t.RecognitionStatus),i=xi.implTranslateCancelErrorCode(t.RecognitionStatus);yield this.cancelRecognitionLocal(e,i,xi.implTranslateErrorDetails(i))}else if(!this.privRequestSession.isSpeechEnded||i!==ue.NoMatch||t.RecognitionStatus===wi.InitialSilenceTimeout){if(this.privRecognizerConfig.parameters.getProperty(Xe)===dt[dt.Simple])r=new At(this.privRequestSession.requestId,i,t.DisplayText,t.Duration,s,t.Language,t.LanguageDetectionConfidence,t.SpeakerId,void 0,e,n);else{const t=Di.fromJSON(e),s=t.Offset+this.privRequestSession.currentTurnAudioOffset,a=t.getJsonWithCorrectedOffsets(s);r=new At(this.privRequestSession.requestId,i,t.Text,t.Duration,s,t.Language,t.LanguageDetectionConfidence,t.SpeakerId,void 0,a,n),o=r.offset}this.handleRecognizedCallback(r,o,this.privRequestSession.sessionId)}}))}handleSpeechHypothesis(e){const t=Ei.fromJSON(e),i=t.Offset+this.privRequestSession.currentTurnAudioOffset,r=new Oe;r.setProperty(l.SpeechServiceResponse_JsonResult,e);const n=new At(this.privRequestSession.requestId,ue.RecognizingSpeech,t.Text,t.Duration,i,t.Language,t.LanguageDetectionConfidence,t.SpeakerId,void 0,e,r);this.privRequestSession.onHypothesis(i),this.handleRecognizingCallback(n,t.Duration,this.privRequestSession.sessionId)}}class Gi{constructor(e){this.privTranslationHypothesis=JSON.parse(e),this.privTranslationHypothesis.Translation.TranslationStatus=Ui[this.privTranslationHypothesis.Translation.TranslationStatus]}static fromJSON(e){return new Gi(e)}get Duration(){return this.privTranslationHypothesis.Duration}get Offset(){return this.privTranslationHypothesis.Offset}get Text(){return this.privTranslationHypothesis.Text}get Translation(){return this.privTranslationHypothesis.Translation}}class $i{constructor(e){this.privTranslationPhrase=e,this.privTranslationPhrase.RecognitionStatus=wi[this.privTranslationPhrase.RecognitionStatus],void 0!==this.privTranslationPhrase.Translation&&(this.privTranslationPhrase.Translation.TranslationStatus=Ui[this.privTranslationPhrase.Translation.TranslationStatus])}static fromJSON(e){return new $i(JSON.parse(e))}static fromTranslationResponse(e){w.throwIfNullOrUndefined(e,"translationResponse");const t=e.SpeechPhrase;return e.SpeechPhrase=void 0,t.Translation=e,t.Text=t.DisplayText,new $i(t)}get RecognitionStatus(){return this.privTranslationPhrase.RecognitionStatus}get Offset(){return this.privTranslationPhrase.Offset}get Duration(){return this.privTranslationPhrase.Duration}get Text(){return this.privTranslationPhrase.Text}get Language(){var e;return null===(e=this.privTranslationPhrase.PrimaryLanguage)||void 0===e?void 0:e.Language}get Confidence(){var e;return null===(e=this.privTranslationPhrase.PrimaryLanguage)||void 0===e?void 0:e.Confidence}get Translation(){return this.privTranslationPhrase.Translation}}class Qi{constructor(e){this.privSynthesisEnd=JSON.parse(e),this.privSynthesisEnd.SynthesisStatus&&(this.privSynthesisEnd.SynthesisStatus=Ci[this.privSynthesisEnd.SynthesisStatus]),this.privSynthesisEnd.Status&&(this.privSynthesisEnd.SynthesisStatus=Ci[this.privSynthesisEnd.Status])}static fromJSON(e){return new Qi(e)}get SynthesisStatus(){return this.privSynthesisEnd.SynthesisStatus}get FailureReason(){return this.privSynthesisEnd.FailureReason}}var Zi=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Xi extends Vi{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privTranslationRecognizer=n,this.connectionEvents.attach((e=>{"ConnectionEstablishedEvent"===e.name?this.privTranslationRecognizer.onConnection():"ConnectionClosedEvent"===e.name&&this.privTranslationRecognizer.onDisconnection()}))}processTypeSpecificMessages(e){return Zi(this,void 0,void 0,(function*(){const t=new Oe;let i=yield this.processSpeechMessages(e);if(i)return!0;const r=r=>Zi(this,void 0,void 0,(function*(){if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+r.Offset+r.Duration),r.RecognitionStatus===wi.Success){const e=this.fireEventForResult(r,t);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,e)}catch(e){}if(this.privSuccessCallback){try{this.privSuccessCallback(e.result)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}else{const n=xi.implTranslateRecognitionResult(r.RecognitionStatus),s=new Mt(void 0,this.privRequestSession.requestId,n,r.Text,r.Duration,this.privRequestSession.currentTurnAudioOffset+r.Offset,r.Language,r.Confidence,void 0,e.textBody,t);if(n===ue.Canceled){const e=xi.implTranslateCancelResult(r.RecognitionStatus),t=xi.implTranslateCancelErrorCode(r.RecognitionStatus);yield this.cancelRecognitionLocal(e,t,xi.implTranslateErrorDetails(t))}else{if(!this.privRequestSession.isSpeechEnded||n!==ue.NoMatch||r.RecognitionStatus===wi.InitialSilenceTimeout){const e=new Nt(s,s.offset,this.privRequestSession.sessionId);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,e)}catch(e){}}if(this.privSuccessCallback){try{this.privSuccessCallback(s)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}i=!0}}));switch(e.messageType===ae.Text&&t.setProperty(l.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"translation.hypothesis":const n=this.fireEventForResult(Gi.fromJSON(e.textBody),t);if(this.privRequestSession.onHypothesis(this.privRequestSession.currentTurnAudioOffset+n.offset),this.privTranslationRecognizer.recognizing)try{this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,n)}catch(e){}i=!0;break;case"translation.response":const s=JSON.parse(e.textBody);s.SpeechPhrase&&(yield r($i.fromTranslationResponse(s)));break;case"translation.phrase":yield r($i.fromJSON(e.textBody));break;case"translation.synthesis":this.sendSynthesisAudio(e.binaryBody,this.privRequestSession.sessionId),i=!0;break;case"audio.end":case"translation.synthesis.end":const o=Qi.fromJSON(e.textBody);switch(o.SynthesisStatus){case Ci.Error:if(this.privTranslationRecognizer.synthesizing){const e=new Lt(ue.Canceled,void 0),t=new zt(e,this.privRequestSession.sessionId);try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,t)}catch(e){}}if(this.privTranslationRecognizer.canceled){const e=new Wi(this.privRequestSession.sessionId,pe.Error,o.FailureReason,he.ServiceError,null);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,e)}catch(e){}}break;case Ci.Success:this.sendSynthesisAudio(void 0,this.privRequestSession.sessionId)}i=!0}return i}))}cancelRecognition(e,t,i,r,n){const s=new Oe;if(s.setProperty(Ye,he[r]),this.privTranslationRecognizer.canceled){const t=new Wi(e,i,n,r,void 0);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,t)}catch(e){}}if(this.privSuccessCallback){const e=new Mt(void 0,t,ue.Canceled,void 0,void 0,void 0,void 0,void 0,n,void 0,s);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch(e){}}}handleRecognizingCallback(e,t,i){try{const r=new Nt(Mt.fromSpeechRecognitionResult(e),t,i);this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,r)}catch(e){}}handleRecognizedCallback(e,t,i){try{const r=new Nt(Mt.fromSpeechRecognitionResult(e),t,i);this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,r)}catch(e){}}fireEventForResult(e,t){let i,r,n,s;if(void 0!==e.Translation.Translations){i=new ji;for(const t of e.Translation.Translations)i.set(t.Language,t.Text||t.DisplayText)}e instanceof $i?(r=e.Translation&&e.Translation.TranslationStatus===Ui.Success?ue.TranslatedSpeech:ue.RecognizedSpeech,n=e.Language,s=e.Confidence):r=ue.TranslatingSpeech;const o=e.Offset+this.privRequestSession.currentTurnAudioOffset,a=new Mt(i,this.privRequestSession.requestId,r,e.Text,e.Duration,o,n,s,e.Translation.FailureReason,JSON.stringify(e),t);return new Nt(a,o,this.privRequestSession.sessionId)}sendSynthesisAudio(e,t){const i=void 0===e?ue.SynthesizingAudioCompleted:ue.SynthesizingAudio,r=new Lt(i,e),n=new zt(r,t);if(this.privTranslationRecognizer.synthesizing)try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,n)}catch(e){}}}class Yi{}class er{constructor(e){this.privConnectionMessage=e,this.privProperties=new Oe,this.privConnectionMessage.headers[rt.ConnectionId]&&this.privProperties.setProperty(l.Speech_SessionId,this.privConnectionMessage.headers[rt.ConnectionId]),Object.keys(this.privConnectionMessage.headers).forEach((e=>{this.privProperties.setProperty(e,this.privConnectionMessage.headers[e])}))}get path(){return this.privConnectionMessage.headers[Object.keys(this.privConnectionMessage.headers).find((e=>e.toLowerCase()==="path".toLowerCase()))]}get isTextMessage(){return this.privConnectionMessage.messageType===ae.Text}get isBinaryMessage(){return this.privConnectionMessage.messageType===ae.Binary}get TextMessage(){return this.privConnectionMessage.textBody}get binaryMessage(){return this.privConnectionMessage.binaryBody}get properties(){return this.privProperties}toString(){return""}}class tr extends wt{}class ir{constructor(e){this.privConnectionMessage=e}get message(){return this.privConnectionMessage}toString(){return"Message: "+this.privConnectionMessage.toString()}}class rr extends wt{constructor(e,t,i){super(i),this.privJsonResult=e,this.privEventName=t}get jsonString(){return this.privJsonResult}get eventName(){return this.privEventName}}class nr{static fromRecognizer(e){const t=e.internalData,i=new nr;return i.privInternalData=t,i.setupEvents(),i}static fromSynthesizer(e){const t=e.internalData,i=new nr;return i.privInternalData=t,i.setupEvents(),i}openConnection(e,t){L(this.privInternalData.connect(),e,t)}closeConnection(e,t){if(this.privInternalData instanceof ot)throw new Error("Disconnecting a synthesizer's connection is currently not supported");L(this.privInternalData.disconnect(),e,t)}setMessageProperty(e,t,i){if(w.throwIfNullOrWhitespace(t,"propertyName"),this.privInternalData instanceof ii){if("speech.context"!==e.toLowerCase())throw new Error("Only speech.context message property sets are currently supported for recognizer");this.privInternalData.speechContext.setSection(t,i)}else if(this.privInternalData instanceof ot){if("synthesis.context"!==e.toLowerCase())throw new Error("Only synthesis.context message property sets are currently supported for synthesizer");this.privInternalData.synthesisContext.setSection(t,i)}}sendMessageAsync(e,t,i,r){L(this.privInternalData.sendNetworkMessage(e,t),i,r)}close(){}setupEvents(){this.privEventListener=this.privInternalData.connectionEvents.attach((e=>{"ConnectionEstablishedEvent"===e.name?this.connected&&this.connected(new tr(e.connectionId)):"ConnectionClosedEvent"===e.name?this.disconnected&&this.disconnected(new tr(e.connectionId)):"ConnectionMessageSentEvent"===e.name?this.messageSent&&this.messageSent(new ir(new er(e.message))):"ConnectionMessageReceivedEvent"===e.name&&this.messageReceived&&this.messageReceived(new ir(new er(e.message)))})),this.privServiceEventListener=this.privInternalData.serviceEvents.attach((e=>{this.receivedServiceMessage&&this.receivedServiceMessage(new rr(e.jsonString,e.name))}))}}var sr,or,ar=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class cr extends ai{constructor(e,t,i){const r=e;w.throwIfNull(r,"speechConfig"),super(t,r.properties,i||new Hi),this.privDisposedTranslationRecognizer=!1,void 0!==this.properties.getProperty(l.SpeechServiceConnection_TranslationVoice,void 0)&&w.throwIfNullOrWhitespace(this.properties.getProperty(l.SpeechServiceConnection_TranslationVoice),l[l.SpeechServiceConnection_TranslationVoice]),w.throwIfNullOrWhitespace(this.properties.getProperty(l.SpeechServiceConnection_TranslationToLanguages),l[l.SpeechServiceConnection_TranslationToLanguages]),w.throwIfNullOrWhitespace(this.properties.getProperty(l.SpeechServiceConnection_RecoLanguage),l[l.SpeechServiceConnection_RecoLanguage])}static FromConfig(e,t,i){const r=e;return t.properties.mergeTo(r.properties),new cr(e,i)}get speechRecognitionLanguage(){return w.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(l.SpeechServiceConnection_RecoLanguage)}get targetLanguages(){return w.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(l.SpeechServiceConnection_TranslationToLanguages).split(",")}get voiceName(){return w.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(l.SpeechServiceConnection_TranslationVoice,void 0)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(l.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.properties.setProperty(l.SpeechServiceAuthorization_Token,e)}recognizeOnceAsync(e,t){w.throwIfDisposed(this.privDisposedTranslationRecognizer),L(this.recognizeOnceAsyncImpl(v.Conversation),e,t)}startContinuousRecognitionAsync(e,t){L(this.startContinuousRecognitionAsyncImpl(v.Conversation),e,t)}stopContinuousRecognitionAsync(e,t){L(this.stopContinuousRecognitionAsyncImpl(),e,t)}removeTargetLanguage(e){if(w.throwIfNullOrUndefined(e,"language to be removed"),void 0!==this.properties.getProperty(l.SpeechServiceConnection_TranslationToLanguages,void 0)){const t=this.properties.getProperty(l.SpeechServiceConnection_TranslationToLanguages).split(","),i=t.indexOf(e);i>-1&&(t.splice(i,1),this.properties.setProperty(l.SpeechServiceConnection_TranslationToLanguages,t.join(",")),this.updateLanguages(t))}}addTargetLanguage(e){w.throwIfNullOrUndefined(e,"language to be added");let t=[];void 0!==this.properties.getProperty(l.SpeechServiceConnection_TranslationToLanguages,void 0)?(t=this.properties.getProperty(l.SpeechServiceConnection_TranslationToLanguages).split(","),t.includes(e)||(t.push(e),this.properties.setProperty(l.SpeechServiceConnection_TranslationToLanguages,t.join(",")))):(this.properties.setProperty(l.SpeechServiceConnection_TranslationToLanguages,e),t=[e]),this.updateLanguages(t)}close(e,t){w.throwIfDisposed(this.privDisposedTranslationRecognizer),L(this.dispose(!0),e,t)}onConnection(){}onDisconnection(){return ar(this,void 0,void 0,(function*(){}))}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return ar(this,void 0,void 0,(function*(){this.privDisposedTranslationRecognizer||(this.privDisposedTranslationRecognizer=!0,e&&(yield this.implRecognizerStop(),yield t.dispose.call(this,e)))}))}createRecognizerConfig(e){return new x(e,this.privProperties)}createServiceRecognizer(e,t,i,r){return new Xi(e,t,i,r,this)}updateLanguages(e){const t=nr.fromRecognizer(this);t&&(t.setMessageProperty("speech.context","translationcontext",{to:e}),t.sendMessageAsync("event",JSON.stringify({id:"translation",name:"updateLanguage",to:e})))}}!function(e){e[e.NotRecognized=0]="NotRecognized",e[e.InitialSilenceTimeout=1]="InitialSilenceTimeout",e[e.InitialBabbleTimeout=2]="InitialBabbleTimeout"}(sr||(sr={}));class pr{constructor(e){this.privReason=e}static fromResult(e){const t=ki.fromJSON(e.json);let i=sr.NotRecognized;switch(t.RecognitionStatus){case wi.BabbleTimeout:i=sr.InitialBabbleTimeout;break;case wi.InitialSilenceTimeout:i=sr.InitialSilenceTimeout;break;default:i=sr.NotRecognized}return new pr(i)}get reason(){return this.privReason}}class hr{constructor(e,t,i){this.privReason=e,this.privErrorDetails=t,this.privErrorCode=i}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get ErrorCode(){return this.privErrorCode}}class ur extends hr{constructor(e,t,i){super(e,t,i)}static fromResult(e){let t=pe.Error,i=he.NoError;if(e instanceof It&&e.json){const i=ki.fromJSON(e.json);t=xi.implTranslateCancelResult(i.RecognitionStatus)}return e.properties&&(i=he[e.properties.getProperty(Ye,he[he.NoError])]),new ur(t,e.errorDetails||xi.implTranslateErrorDetails(i),i)}}class dr{constructor(e){this.privGrammerBuilder=e.dynamicGrammar}static fromRecognizer(e){const t=e.internalData;return new dr(t)}addPhrase(e){this.privGrammerBuilder.addPhrase(e)}addPhrases(e){this.privGrammerBuilder.addPhrase(e)}clear(){this.privGrammerBuilder.clearPhrases()}}class lr{constructor(){}set applicationId(e){}static get DialogTypes(){return{BotFramework:"bot_framework",CustomCommands:"custom_commands"}}}class vr extends lr{constructor(){super(),this.privSpeechConfig=new Bt}get properties(){return this.privSpeechConfig.properties}get speechRecognitionLanguage(){return this.privSpeechConfig.speechRecognitionLanguage}set speechRecognitionLanguage(e){w.throwIfNullOrWhitespace(e,"value"),this.privSpeechConfig.speechRecognitionLanguage=e}get outputFormat(){return this.privSpeechConfig.outputFormat}set outputFormat(e){this.privSpeechConfig.outputFormat=e}setProperty(e,t){this.privSpeechConfig.setProperty(e,t)}getProperty(e,t){return this.privSpeechConfig.getProperty(e)}setProxy(e,t,i,r){this.setProperty(l.SpeechServiceConnection_ProxyHostName,e),this.setProperty(l.SpeechServiceConnection_ProxyPort,`${t}`),i&&this.setProperty(l.SpeechServiceConnection_ProxyUserName,i),r&&this.setProperty(l.SpeechServiceConnection_ProxyPassword,r)}setServiceProperty(e,t,i){this.privSpeechConfig.setServiceProperty(e,t)}close(){}}class gr extends vr{constructor(){super()}static fromSubscription(e,t,i){w.throwIfNullOrWhitespace(e,"subscription"),w.throwIfNullOrWhitespace(t,"region");const r=new vr;return r.setProperty(l.Conversation_DialogType,lr.DialogTypes.BotFramework),r.setProperty(l.SpeechServiceConnection_Key,e),r.setProperty(l.SpeechServiceConnection_Region,t),i&&r.setProperty(l.Conversation_ApplicationId,i),r}static fromAuthorizationToken(e,t,i){w.throwIfNullOrWhitespace(e,"authorizationToken"),w.throwIfNullOrWhitespace(t,"region");const r=new vr;return r.setProperty(l.Conversation_DialogType,lr.DialogTypes.BotFramework),r.setProperty(l.SpeechServiceAuthorization_Token,e),r.setProperty(l.SpeechServiceConnection_Region,t),i&&r.setProperty(l.Conversation_ApplicationId,i),r}static fromHost(e,t,i){w.throwIfNullOrUndefined(e,"host");const r=e instanceof URL?e:new URL(`wss://${e}.convai.speech.azure.us`);w.throwIfNullOrUndefined(r,"resolvedHost");const n=new vr;return n.setProperty(l.Conversation_DialogType,lr.DialogTypes.BotFramework),n.setProperty(l.SpeechServiceConnection_Host,r.toString()),void 0!==t&&n.setProperty(l.SpeechServiceConnection_Key,t),n}static fromEndpoint(e,t){w.throwIfNull(e,"endpoint");const i=new vr;return i.setProperty(l.Conversation_DialogType,lr.DialogTypes.BotFramework),i.setProperty(l.SpeechServiceConnection_Endpoint,e.toString()),void 0!==t&&i.setProperty(l.SpeechServiceConnection_Key,t),i}}class fr extends vr{constructor(){super()}static fromSubscription(e,t,i){w.throwIfNullOrWhitespace(e,"applicationId"),w.throwIfNullOrWhitespace(t,"subscription"),w.throwIfNullOrWhitespace(i,"region");const r=new vr;return r.setProperty(l.Conversation_DialogType,lr.DialogTypes.CustomCommands),r.setProperty(l.Conversation_ApplicationId,e),r.setProperty(l.SpeechServiceConnection_Key,t),r.setProperty(l.SpeechServiceConnection_Region,i),r}static fromAuthorizationToken(e,t,i){w.throwIfNullOrWhitespace(e,"applicationId"),w.throwIfNullOrWhitespace(t,"authorizationToken"),w.throwIfNullOrWhitespace(i,"region");const r=new vr;return r.setProperty(l.Conversation_DialogType,lr.DialogTypes.CustomCommands),r.setProperty(l.Conversation_ApplicationId,e),r.setProperty(l.SpeechServiceAuthorization_Token,t),r.setProperty(l.SpeechServiceConnection_Region,i),r}set applicationId(e){w.throwIfNullOrWhitespace(e,"value"),this.setProperty(l.Conversation_ApplicationId,e)}get applicationId(){return this.getProperty(l.Conversation_ApplicationId)}}class mr extends Ai{create(e,t,i){const r=e.parameters.getProperty(l.Conversation_ApplicationId,""),n=e.parameters.getProperty(l.Conversation_DialogType),s=e.parameters.getProperty(l.SpeechServiceConnection_Region),o=e.parameters.getProperty(l.SpeechServiceConnection_RecoLanguage,"en-US"),a=e.parameters.getProperty(l.Conversation_Request_Bot_Status_Messages,"true"),c={};c[rt.ConnectionId]=i,c[Ii.Format]=e.parameters.getProperty(Xe,dt[dt.Simple]).toLowerCase(),c[Ii.Language]=o,c[Ii.RequestBotStatusMessages]=a,r&&(c[Ii.BotId]=r,n===lr.DialogTypes.CustomCommands&&(c[rt.CustomCommandsAppId]=r));const p=n===lr.DialogTypes.CustomCommands?"commands/":"",h=n===lr.DialogTypes.CustomCommands?"v1":n===lr.DialogTypes.BotFramework?"v3":"v0",u={};null!=t.token&&""!==t.token&&(u[t.headerName]=t.token);let d=e.parameters.getProperty(l.SpeechServiceConnection_Endpoint,"");if(!d){const t=Ai.getHostSuffix(s),i=e.parameters.getProperty(l.SpeechServiceConnection_Host,`wss://${s}.${mr.BaseUrl}${t}`);d=`${i.endsWith("/")?i:i+"/"}${p}${mr.ApiKey}/${h}`}this.setCommonUrlParams(e,c,d);const v="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new Ri(d,c,u,new Ti,Pi.fromRecognizerConfig(e),v,i)}}mr.ApiKey="api",mr.BaseUrl="convai.speech";class Sr extends C{constructor(e,t=d.Info){super(e,t)}}class yr extends Sr{constructor(e){super("SendingAgentContextMessageEvent"),this.privAgentConfig=e}get agentConfig(){return this.privAgentConfig}}class Cr{constructor(e,t){this.privActivity=e,this.privAudioStream=t}get activity(){return this.privActivity}get audioStream(){return this.privAudioStream}}class wr{constructor(e){this.privMessageStatusResponse=JSON.parse(e)}static fromJSON(e){return new wr(e)}get interactionId(){return this.privMessageStatusResponse.interactionId}get conversationId(){return this.privMessageStatusResponse.conversationId}get statusCode(){switch(this.privMessageStatusResponse.statusCode){case"Success":return 200;case"Failed":return 400;case"TimedOut":return 429;default:return this.privMessageStatusResponse.statusCode}}}class Rr{constructor(e){this.privTurnStatus=wr.fromJSON(e)}get interactionId(){return this.privTurnStatus.interactionId}get conversationId(){return this.privTurnStatus.conversationId}get statusCode(){return this.privTurnStatus.statusCode}}class Pr{constructor(e){this.privActivityResponse=JSON.parse(e)}static fromJSON(e){return new Pr(e)}get conversationId(){return this.privActivityResponse.conversationId}get messageDataStreamType(){return this.privActivityResponse.messageDataStreamType}get messagePayload(){return this.privActivityResponse.messagePayload}get version(){return this.privActivityResponse.version}}!function(e){e[e.None=0]="None",e[e.TextToSpeechAudio=1]="TextToSpeechAudio"}(or||(or={}));class Ir{constructor(e,t){this.privRequestId=t,this.privIsCompleted=!1,this.privAudioStream=null,this.privTurnManager=e,this.resetTurnEndTimeout()}get audioStream(){return this.resetTurnEndTimeout(),this.privAudioStream}processActivityPayload(e,t){return e.messageDataStreamType===or.TextToSpeechAudio&&(this.privAudioStream=Be.createPullStream(),this.privAudioStream.format=void 0!==t?t:Le.getDefaultOutputFormat()),this.privAudioStream}endAudioStream(){null===this.privAudioStream||this.privAudioStream.isClosed||this.privAudioStream.close()}complete(){void 0!==this.privTimeoutToken&&clearTimeout(this.privTimeoutToken),this.endAudioStream()}resetTurnEndTimeout(){void 0!==this.privTimeoutToken&&clearTimeout(this.privTimeoutToken),this.privTimeoutToken=setTimeout((()=>{this.privTurnManager.CompleteTurn(this.privRequestId)}),2e3)}}class Ar{constructor(){this.privTurnMap=new Map}StartTurn(e){if(this.privTurnMap.has(e))throw new I("Service error: There is already a turn with id:"+e);const t=new Ir(this,e);return this.privTurnMap.set(e,t),this.privTurnMap.get(e)}GetTurn(e){return this.privTurnMap.get(e)}CompleteTurn(e){if(!this.privTurnMap.has(e))throw new I("Service error: Received turn end for an unknown turn id:"+e);const t=this.privTurnMap.get(e);return t.complete(),this.privTurnMap.delete(e),t}}class Tr{constructor(e){this.privSpeechKeyword=JSON.parse(e)}static fromJSON(e){return new Tr(e)}get Status(){return this.privSpeechKeyword.Status}get Text(){return this.privSpeechKeyword.Text}get Offset(){return this.privSpeechKeyword.Offset}get Duration(){return this.privSpeechKeyword.Duration}}var br=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Er extends ii{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privEvents=new T,this.privDialogServiceConnector=n,this.receiveMessageOverride=()=>this.receiveDialogMessageOverride(),this.privTurnStateManager=new Ar,this.recognizeOverride=(e,t,i)=>this.listenOnce(e,t,i),this.postConnectImplOverride=e=>this.dialogConnectImpl(e),this.configConnectionOverride=e=>this.configConnection(e),this.disconnectOverride=()=>this.privDisconnect(),this.privDialogAudioSource=i,this.agentConfigSent=!1,this.privLastResult=null,this.connectionEvents.attach((e=>{"ConnectionClosedEvent"===e.name&&(this.terminateMessageLoop=!0)}))}sendMessage(e){return br(this,void 0,void 0,(function*(){const t=h(),i=u(),r={context:{interactionId:t},messagePayload:JSON.parse(e),version:.5},n=JSON.stringify(r),s=yield this.fetchConnection();yield s.send(new nt(ae.Text,"agent",i,"application/json",n))}))}privDisconnect(){return br(this,void 0,void 0,(function*(){yield this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,pe.Error,he.NoError,"Disconnecting"),this.terminateMessageLoop=!0,this.agentConfigSent=!1}))}processTypeSpecificMessages(e){const t=new Oe;let i,r;switch(e.messageType===ae.Text&&t.setProperty(l.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"speech.phrase":const n=ki.fromJSON(e.textBody);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+n.Offset+n.Duration),n.RecognitionStatus!==wi.TooManyRequests&&n.RecognitionStatus!==wi.Error){const e=this.fireEventForResult(n,t);if(this.privLastResult=e.result,this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,e)}catch(e){}}r=!0;break;case"speech.hypothesis":const s=Ei.fromJSON(e.textBody),o=s.Offset+this.privRequestSession.currentTurnAudioOffset;i=new At(this.privRequestSession.requestId,ue.RecognizingSpeech,s.Text,s.Duration,o,s.Language,s.LanguageDetectionConfidence,void 0,void 0,e.textBody,t),this.privRequestSession.onHypothesis(o);const a=new kt(i,s.Duration,this.privRequestSession.sessionId);if(this.privDialogServiceConnector.recognizing)try{this.privDialogServiceConnector.recognizing(this.privDialogServiceConnector,a)}catch(e){}r=!0;break;case"speech.keyword":const c=Tr.fromJSON(e.textBody);i=new At(this.privRequestSession.requestId,"Accepted"===c.Status?ue.RecognizedKeyword:ue.NoMatch,c.Text,c.Duration,c.Offset,void 0,void 0,void 0,void 0,e.textBody,t),"Accepted"!==c.Status&&(this.privLastResult=i);const p=new kt(i,i.duration,i.resultId);if(this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,p)}catch(e){}r=!0;break;case"audio":{const t=e.requestId.toUpperCase(),i=this.privTurnStateManager.GetTurn(t);try{e.binaryBody?i.audioStream.write(e.binaryBody):i.endAudioStream()}catch(e){}}r=!0;break;case"response":this.handleResponseMessage(e),r=!0}const n=new M;return n.resolve(r),n.promise}cancelRecognition(e,t,i,r,n){return br(this,void 0,void 0,(function*(){if(this.terminateMessageLoop=!0,this.privRequestSession.isRecognizing&&(yield this.privRequestSession.onStopRecognizing()),this.privDialogServiceConnector.canceled){const t=new Oe;t.setProperty(Ye,he[r]);const s=new Ot(i,n,r,void 0,e);try{this.privDialogServiceConnector.canceled(this.privDialogServiceConnector,s)}catch(e){}if(this.privSuccessCallback){const e=new At(void 0,ue.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,n,void 0,t);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch(e){}}}}))}listenOnce(e,t,i){return br(this,void 0,void 0,(function*(){this.privRecognizerConfig.recognitionMode=e,this.privSuccessCallback=t,this.privErrorCallback=i,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privDialogAudioSource.events),this.privRecognizerConfig.parameters.setProperty(l.Speech_SessionId,this.privRequestSession.sessionId);const r=this.connectImpl(),n=this.sendPreAudioMessages(),s=yield this.privDialogAudioSource.attach(this.privRequestSession.audioNodeId),o=yield this.privDialogAudioSource.format,a=yield this.privDialogAudioSource.deviceInfo,c=new Ft(s,o.avgBytesPerSec);yield this.privRequestSession.onAudioSourceAttachCompleted(c,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:a};try{yield r,yield n}catch(e){return yield this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,pe.Error,he.ConnectionFailure,e),Promise.resolve()}const p=new wt(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,p),this.sendAudio(c).then((()=>{}),(e=>br(this,void 0,void 0,(function*(){yield this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,pe.Error,he.RuntimeError,e)}))))}))}dialogConnectImpl(e){return this.privConnectionLoop=this.startMessageLoop(),e}receiveDialogMessageOverride(){const e=new M,t=()=>br(this,void 0,void 0,(function*(){try{const i=this.isDisposed(),r=!this.isDisposed()&&this.terminateMessageLoop;if(i||r)return void e.resolve(void 0);const n=yield this.fetchConnection(),s=yield n.read();if(!s)return t();const o=nt.fromConnectionMessage(s);switch(o.path.toLowerCase()){case"turn.start":{const e=o.requestId.toUpperCase();e!==this.privRequestSession.requestId.toUpperCase()?this.privTurnStateManager.StartTurn(e):this.privRequestSession.onServiceTurnStartResponse()}break;case"speech.startdetected":const e=ei.fromJSON(o.textBody),t=new Rt(e.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,t);break;case"speech.enddetected":let i;i=o.textBody.length>0?o.textBody:"{ Offset: 0 }";const r=ei.fromJSON(i);this.privRequestSession.onServiceRecognized(r.Offset+this.privRequestSession.currentTurnAudioOffset);const n=new Rt(r.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,n);break;case"turn.end":{const e=o.requestId.toUpperCase();if(e!==this.privRequestSession.requestId.toUpperCase())this.privTurnStateManager.CompleteTurn(e);else{const e=new wt(this.privRequestSession.sessionId);if(yield this.privRequestSession.onServiceTurnEndResponse(!1),this.privRecognizerConfig.isContinuousRecognition&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing||this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,e),this.privSuccessCallback&&this.privLastResult){try{this.privSuccessCallback(this.privLastResult),this.privLastResult=null}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}}break;default:try{(yield this.processTypeSpecificMessages(o))||this.serviceEvents&&this.serviceEvents.onEvent(new Ce(o.path.toLowerCase(),o.textBody))}catch(e){}}return t()}catch(t){this.terminateMessageLoop=!0,e.resolve()}}));return t().catch((e=>{b.instance.onEvent(new at(e))})),e.promise}startMessageLoop(){return br(this,void 0,void 0,(function*(){this.terminateMessageLoop=!1;try{yield this.receiveDialogMessageOverride()}catch(e){yield this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,pe.Error,he.RuntimeError,e)}return Promise.resolve()}))}configConnection(e){return br(this,void 0,void 0,(function*(){return this.terminateMessageLoop?(this.terminateMessageLoop=!1,Promise.reject("Connection to service terminated.")):(yield this.sendSpeechServiceConfig(e,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),yield this.sendAgentConfig(e),e)}))}sendPreAudioMessages(){return br(this,void 0,void 0,(function*(){const e=yield this.fetchConnection();this.addKeywordContextData(),yield this.sendSpeechContext(e,!0),yield this.sendAgentContext(e),yield this.sendWaveHeader(e)}))}sendAgentConfig(e){if(this.agentConfig&&!this.agentConfigSent){if(this.privRecognizerConfig.parameters.getProperty(l.Conversation_DialogType)===lr.DialogTypes.CustomCommands){const e=this.agentConfig.get();e.botInfo.commandsCulture=this.privRecognizerConfig.parameters.getProperty(l.SpeechServiceConnection_RecoLanguage,"en-us"),this.agentConfig.set(e)}this.onEvent(new yr(this.agentConfig));const t=this.agentConfig.toJsonString();return this.agentConfigSent=!0,e.send(new nt(ae.Text,"agent.config",this.privRequestSession.requestId,"application/json",t))}}sendAgentContext(e){const t=h(),i=this.privDialogServiceConnector.properties.getProperty(l.Conversation_Speech_Activity_Template),r={channelData:"",context:{interactionId:t},messagePayload:void 0===typeof i?void 0:i,version:.5},n=JSON.stringify(r);return e.send(new nt(ae.Text,"speech.agent.context",this.privRequestSession.requestId,"application/json",n))}fireEventForResult(e,t){const i=xi.implTranslateRecognitionResult(e.RecognitionStatus),r=e.Offset+this.privRequestSession.currentTurnAudioOffset,n=new At(this.privRequestSession.requestId,i,e.DisplayText,e.Duration,r,e.Language,e.LanguageDetectionConfidence,void 0,void 0,JSON.stringify(e),t);return new kt(n,r,this.privRequestSession.sessionId)}handleResponseMessage(e){const t=JSON.parse(e.textBody);switch(t.messageType.toLowerCase()){case"message":const i=e.requestId.toUpperCase(),r=Pr.fromJSON(e.textBody),n=this.privTurnStateManager.GetTurn(i);if(r.conversationId){const e=this.agentConfig.get();e.botInfo.conversationId=r.conversationId,this.agentConfig.set(e)}const s=n.processActivityPayload(r,Le.fromSpeechSynthesisOutputFormatString(this.privDialogServiceConnector.properties.getProperty(l.SpeechServiceConnection_SynthOutputFormat,void 0))),o=new Cr(r.messagePayload,s);if(this.privDialogServiceConnector.activityReceived)try{this.privDialogServiceConnector.activityReceived(this.privDialogServiceConnector,o)}catch(e){}break;case"messagestatus":if(this.privDialogServiceConnector.turnStatusReceived)try{this.privDialogServiceConnector.turnStatusReceived(this.privDialogServiceConnector,new Rr(e.textBody))}catch(e){}break;default:b.instance.onEvent(new at(`Unexpected response of type ${t.messageType}. Ignoring.`))}}onEvent(e){this.privEvents.onEvent(e),b.instance.onEvent(e)}addKeywordContextData(){const e=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect");if(void 0===e)return;const t=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Offsets"),i=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Durations"),r=e.split(";"),n=void 0===t?[]:t.split(";"),s=void 0===i?[]:i.split(";"),o=[];for(let e=0;e<r.length;e++){const t={};t.text=r[e],e<n.length&&(t.offset=Number(n[e])),e<s.length&&(t.duration=Number(s[e])),o.push(t)}this.speechContext.setSection("invocationSource","VoiceActivationWithKeyword"),this.speechContext.setSection("keywordDetection",[{clientDetectedKeywords:o,onReject:{action:"EndOfTurn"},type:"startTrigger"}])}}var kr,xr=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Dr extends ai{constructor(e,t){const i=e;w.throwIfNull(e,"dialogConfig"),super(t,i.properties,new mr),this.isTurnComplete=!0,this.privIsDisposed=!1,this.privProperties=i.properties.clone();const r=this.buildAgentConfig();this.privReco.agentConfig.set(r)}connect(e,t){L(this.privReco.connect(),e,t)}disconnect(e,t){L(this.privReco.disconnect(),e,t)}get authorizationToken(){return this.properties.getProperty(l.SpeechServiceAuthorization_Token)}set authorizationToken(e){w.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(l.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}get speechActivityTemplate(){return this.properties.getProperty(l.Conversation_Speech_Activity_Template)}set speechActivityTemplate(e){this.properties.setProperty(l.Conversation_Speech_Activity_Template,e)}listenOnceAsync(e,t){if(this.isTurnComplete){w.throwIfDisposed(this.privIsDisposed);const i=(()=>xr(this,void 0,void 0,(function*(){yield this.privReco.connect(),yield this.implRecognizerStop(),this.isTurnComplete=!1;const e=new M;yield this.privReco.recognize(v.Conversation,e.resolve,e.reject);const t=yield e.promise;return yield this.implRecognizerStop(),t})))();i.catch((()=>{this.dispose(!0).catch((()=>{}))})),L(i.finally((()=>{this.isTurnComplete=!0})),e,t)}}sendActivityAsync(e,t,i){L(this.privReco.sendMessage(e),t,i)}close(e,t){w.throwIfDisposed(this.privIsDisposed),L(this.dispose(!0),e,t)}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return xr(this,void 0,void 0,(function*(){this.privIsDisposed||e&&(this.privIsDisposed=!0,yield this.implRecognizerStop(),yield t.dispose.call(this,e))}))}createRecognizerConfig(e){return new x(e,this.privProperties)}createServiceRecognizer(e,t,i,r){return new Er(e,t,i,r,this)}buildAgentConfig(){return{botInfo:{commType:this.properties.getProperty("Conversation_Communication_Type","Default"),commandsCulture:void 0,connectionId:this.properties.getProperty(l.Conversation_Agent_Connection_Id),conversationId:this.properties.getProperty(l.Conversation_Conversation_Id,void 0),fromId:this.properties.getProperty(l.Conversation_From_Id,void 0),ttsAudioFormat:this.properties.getProperty(l.SpeechServiceConnection_SynthOutputFormat,void 0)},version:.2}}}!function(e){e[e.UriQueryParameter=0]="UriQueryParameter"}(kr||(kr={}));class Or{constructor(e){this.audioContext=null,this.gainNode=null,this.autoUpdateBufferTimer=0,void 0===e&&(e=ee.getDefaultInputFormat()),this.init(e)}playAudioSample(e,t,i){try{this.ensureInitializedContext();const i=this.formatAudioData(e),r=new Float32Array(this.samples.length+i.length);r.set(this.samples,0),r.set(i,this.samples.length),this.samples=r,t&&t()}catch(e){i&&i(e)}}stopAudio(e,t){null!==this.audioContext&&(this.samples=new Float32Array,clearInterval(this.autoUpdateBufferTimer),this.audioContext.close().then((()=>{e&&e()}),(e=>{t&&t(e)})),this.audioContext=null)}init(e){this.audioFormat=e,this.samples=new Float32Array}ensureInitializedContext(){if(null===this.audioContext){this.createAudioContext();const e=200;this.autoUpdateBufferTimer=setInterval((()=>{this.updateAudioBuffer()}),e)}}createAudioContext(){this.audioContext=te.getAudioContext(),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioContext.destination),this.startTime=this.audioContext.currentTime}formatAudioData(e){switch(this.audioFormat.bitsPerSample){case 8:return this.formatArrayBuffer(new Int8Array(e),128);case 16:return this.formatArrayBuffer(new Int16Array(e),32768);case 32:return this.formatArrayBuffer(new Int32Array(e),2147483648);default:throw new I("Only WAVE_FORMAT_PCM (8/16/32 bps) format supported at this time")}}formatArrayBuffer(e,t){const i=new Float32Array(e.length);for(let r=0;r<e.length;r++)i[r]=e[r]/t;return i}updateAudioBuffer(){if(0===this.samples.length)return;const e=this.audioFormat.channels,t=this.audioContext.createBufferSource(),i=this.samples.length/e,r=this.audioContext.createBuffer(e,i,this.audioFormat.samplesPerSec);for(let t=0;t<e;t++){let i=t;const n=r.getChannelData(t);for(let t=0;t<this.samples.length;t++,i+=e)n[t]=this.samples[i]}this.startTime<this.audioContext.currentTime&&(this.startTime=this.audioContext.currentTime),t.buffer=r,t.connect(this.gainNode),t.start(this.startTime),this.startTime+=r.duration,this.samples=new Float32Array}playAudio(e){return t=this,i=void 0,n=function*(){null===this.audioContext&&this.createAudioContext();const t=this.audioContext.createBufferSource(),i=this.audioContext.destination;yield this.audioContext.decodeAudioData(e,(e=>{t.buffer=e,t.connect(i),t.start(0)}))},new((r=void 0)||(r=Promise))((function(e,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(o,a)}c((n=n.apply(t,i||[])).next())}));var t,i,r,n}}class Nr{constructor(e,t){this.privId=e,this.privProfileType=t}get profileId(){return this.privId}get profileType(){return this.privProfileType}}class zr{constructor(e,t,i){this.privReason=e,this.privProperties=new Oe,this.privReason!==ue.Canceled?t&&(this.privDetails=JSON.parse(t),"enrolling"===this.privDetails.enrollmentStatus.toLowerCase()&&(this.privReason=ue.EnrollingVoiceProfile)):(this.privErrorDetails=i,this.privProperties.setProperty(Ye,he[he.ServiceError]))}get reason(){return this.privReason}get enrollmentsCount(){return this.privDetails.enrollmentsCount}get enrollmentsLength(){return this.privDetails.enrollmentsLength}get properties(){return this.privProperties}get enrollmentResultDetails(){return this.privDetails}get errorDetails(){return this.privErrorDetails}static FromIdentificationProfileList(e){const t=[];for(const i of e.value){const e="enrolling"===i.enrollmentStatus.toLowerCase()?ue.EnrollingVoiceProfile:"enrolled"===i.enrollmentStatus.toLowerCase()?ue.EnrolledVoiceProfile:ue.Canceled,r=new zr(e,null,null);r.privDetails=this.getIdentificationDetails(i),t.push(r)}return t}static FromVerificationProfileList(e){const t=[];for(const i of e.value){const e="enrolling"===i.enrollmentStatus.toLowerCase()?ue.EnrollingVoiceProfile:"enrolled"===i.enrollmentStatus.toLowerCase()?ue.EnrolledVoiceProfile:ue.Canceled,r=new zr(e,null,null);r.privDetails=this.getVerificationDetails(i),t.push(r)}return t}static getIdentificationDetails(e){return{audioLength:e.audioLength?parseFloat(e.audioLength):0,audioSpeechLength:e.audioSpeechLength?parseFloat(e.audioSpeechLength):0,enrollmentStatus:e.enrollmentStatus,enrollmentsCount:e.enrollmentsCount||0,enrollmentsLength:e.enrollmentsLength?parseFloat(e.enrollmentsLength):0,enrollmentsSpeechLength:e.enrollmentsSpeechLength?parseFloat(e.enrollmentsSpeechLength):0,profileId:e.profileId||e.identificationProfileId,remainingEnrollmentsSpeechLength:e.remainingEnrollmentsSpeechLength?parseFloat(e.remainingEnrollmentsSpeechLength):0}}static getVerificationDetails(e){return{audioLength:e.audioLength?parseFloat(e.audioLength):0,audioSpeechLength:e.audioSpeechLength?parseFloat(e.audioSpeechLength):0,enrollmentStatus:e.enrollmentStatus,enrollmentsCount:e.enrollmentsCount,enrollmentsLength:e.enrollmentsLength?parseFloat(e.enrollmentsLength):0,enrollmentsSpeechLength:e.enrollmentsSpeechLength?parseFloat(e.enrollmentsSpeechLength):0,profileId:e.profileId||e.verificationProfileId,remainingEnrollmentsCount:e.remainingEnrollments||e.remainingEnrollmentsCount,remainingEnrollmentsSpeechLength:e.remainingEnrollmentsSpeechLength?parseFloat(e.remainingEnrollmentsSpeechLength):0}}}class Mr extends hr{constructor(e,t,i){super(e,t,i)}static fromResult(e){const t=pe.Error;let i=he.NoError;return e.properties&&(i=he[e.properties.getProperty(Ye,he[he.NoError])]),new Mr(t,e.errorDetails,i)}}class Lr{constructor(e,t){this.privReason=e,this.privProperties=new Oe,e===ue.Canceled&&(w.throwIfNullOrUndefined(t,"statusText"),this.privErrorDetails=t,this.privProperties.setProperty(Ye,he[he.ServiceError]))}get reason(){return this.privReason}get properties(){return this.privProperties}get errorDetails(){return this.privErrorDetails}}class _r extends hr{constructor(e,t,i){super(e,t,i)}static fromResult(e){const t=pe.Error;let i=he.NoError;return e.properties&&(i=he[e.properties.getProperty(Ye,he[he.NoError])]),new _r(t,e.errorDetails,i)}}class Br extends Lr{constructor(e,t,i,r){super(e,t),this.privPhrases=[],w.throwIfNullOrUndefined(r,"phrase array"),this.privType=i,r&&r[0]&&(this.privPhrases=r)}get phrases(){return this.privPhrases}get type(){return this.privType}}class qr extends Ai{create(e,t,i,r){let n=e.parameters.getProperty(l.SpeechServiceConnection_Endpoint);if(!n){const t=e.parameters.getProperty(l.SpeechServiceConnection_Region),r=Ai.getHostSuffix(t),s=e.parameters.getProperty(l.SpeechServiceConnection_Host,`wss://${t}.spr-frontend.speech${r}`),o=e.parameters.getProperty(l.SpeechServiceConnection_SpeakerIdMode,"TextIndependentIdentification");n=`${s}/speaker/ws/${this.scenarioToPath(o)}/${i}`}const s={format:"simple",language:e.parameters.getProperty(l.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(e,s,n);const o={};void 0!==t.token&&""!==t.token&&(o[t.headerName]=t.token),o[rt.ConnectionId]=r,o[rt.SpIDAuthKey]=e.parameters.getProperty(l.SpeechServiceConnection_Key),e.parameters.setProperty(l.SpeechServiceConnection_Url,n);const a="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new Ri(n,s,o,new Ti,Pi.fromRecognizerConfig(e),a,r)}scenarioToPath(e){switch(e){case"TextIndependentVerification":case"2":return"verification/text-independent";case"TextDependentVerification":case"1":return"verification/text-dependent";default:return"identification/text-independent"}}}class Ur extends qr{create(e,t,i){return super.create(e,t,"recognition",i)}}class Fr extends qr{create(e,t,i){return super.create(e,t,"profile",i)}}class Kr{constructor(){this.privMap={}}add(e,t){this.privMap[e]=t}getId(e){return this.privMap[e]}complete(e,t){try{this.privMap[e].resolve(t)}catch(t){this.privMap[e].reject(t)}finally{this.privMap[e]=void 0}}}var Hr=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Wr extends ii{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privDeferralMap=new Kr,this.privSpeakerAudioSource=i,this.sendPrePayloadJSONOverride=()=>this.noOp()}set SpeakerAudioSource(e){this.privSpeakerAudioSource=e}processTypeSpecificMessages(e){let t=!1;const i=new Oe;switch(e.messageType===ae.Text&&i.setProperty(l.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"speaker.profiles":const i=JSON.parse(e.textBody);switch(i.operation.toLowerCase()){case"create":this.handleCreateResponse(i,e.requestId);break;case"delete":case"reset":this.handleResultResponse(i,e.requestId);break;case"fetch":const t=JSON.parse(e.textBody);this.handleFetchResponse(t,e.requestId)}t=!0;break;case"speaker.phrases":const r=JSON.parse(e.textBody);this.handlePhrasesResponse(r,e.requestId),t=!0;break;case"speaker.profile.enrollment":const n=JSON.parse(e.textBody),s=new zr(this.enrollmentReasonFrom(n.enrollment?n.enrollment.enrollmentStatus:n.status.statusCode),n.enrollment?JSON.stringify(n.enrollment):void 0,n.status.reason);this.privDeferralMap.getId(e.requestId)&&this.privDeferralMap.complete(e.requestId,s),this.privRequestSession.onSpeechEnded(),t=!0}const r=new M;return r.resolve(t),r.promise}cancelRecognition(e,t,i,r,n){(new Oe).setProperty(Ye,he[r]);const s=new zr(ue.Canceled,n,n);this.privDeferralMap.getId(t)&&this.privDeferralMap.complete(t,s)}createProfile(e,t){return Hr(this,void 0,void 0,(function*(){this.voiceProfileType=e.toString();const i=this.connectImpl();try{const r=new M;return yield i,yield this.sendCreateProfile(r,e,t),this.receiveMessage(),r.promise}catch(e){throw e}}))}resetProfile(e){return Hr(this,void 0,void 0,(function*(){return this.voiceProfileType=e.profileType.toString(),this.sendCommonRequest("reset",e.profileType,e)}))}deleteProfile(e){return Hr(this,void 0,void 0,(function*(){return this.voiceProfileType=e.profileType.toString(),this.sendCommonRequest("delete",e.profileType,e)}))}retrieveEnrollmentResult(e){return Hr(this,void 0,void 0,(function*(){return this.voiceProfileType=e.profileType.toString(),this.privExpectedProfileId=e.profileId,this.sendCommonRequest("fetch",e.profileType,e)}))}getAllProfiles(e){return Hr(this,void 0,void 0,(function*(){return this.voiceProfileType=e.toString(),this.sendCommonRequest("fetch",e)}))}getActivationPhrases(e,t){return Hr(this,void 0,void 0,(function*(){this.voiceProfileType=e.toString();const i=this.connectImpl();try{const r=new M;return yield i,yield this.sendPhrasesRequest(r,e,t),this.receiveMessage(),r.promise}catch(e){throw e}}))}enrollProfile(e){return Hr(this,void 0,void 0,(function*(){this.voiceProfileType=e.profileType.toString();const t=new M;this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privSpeakerAudioSource.events),this.privRecognizerConfig.parameters.setProperty(l.Speech_SessionId,this.privRequestSession.sessionId);const i=this.connectImpl(),r=this.sendPreAudioMessages(e,t),n=yield this.privSpeakerAudioSource.attach(this.privRequestSession.audioNodeId),s=yield this.privSpeakerAudioSource.format,o=yield this.privSpeakerAudioSource.deviceInfo,a=new Ft(n,s.avgBytesPerSec);yield this.privRequestSession.onAudioSourceAttachCompleted(a,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:o};try{yield i,yield r}catch(e){this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,pe.Error,he.ConnectionFailure,e)}const c=new wt(this.privRequestSession.sessionId);return this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,c),this.receiveMessage(),this.sendAudio(a).then((()=>{}),(e=>{this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,pe.Error,he.RuntimeError,e)})),t.promise}))}sendPreAudioMessages(e,t){return Hr(this,void 0,void 0,(function*(){const i=yield this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,t),yield this.sendBaseRequest(i,"enroll",this.scenarioFrom(e.profileType),e)}))}sendPhrasesRequest(e,t,i){return Hr(this,void 0,void 0,(function*(){const r=yield this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,e);const n=this.scenarioFrom(t),s={locale:i,scenario:n};return r.send(new nt(ae.Text,"speaker.profile.phrases",this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(s)))}))}sendCreateProfile(e,t,i){return Hr(this,void 0,void 0,(function*(){const r=yield this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,e);const n=t===qi.TextIndependentIdentification?"TextIndependentIdentification":t===qi.TextIndependentVerification?"TextIndependentVerification":"TextDependentVerification",s={locale:i,number:"1",scenario:n};return r.send(new nt(ae.Text,"speaker.profile.create",this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(s)))}))}sendCommonRequest(e,t,i=undefined){return Hr(this,void 0,void 0,(function*(){const r=this.connectImpl();try{const n=new M;this.privRequestSession.onSpeechContext(),yield r;const s=yield this.fetchConnection();return this.privDeferralMap.add(this.privRequestSession.requestId,n),yield this.sendBaseRequest(s,e,this.scenarioFrom(t),i),this.receiveMessage(),n.promise}catch(e){throw e}}))}sendBaseRequest(e,t,i,r){return Hr(this,void 0,void 0,(function*(){const n={scenario:i};return r?n.profileIds=[r.profileId]:n.maxPageSize=-1,e.send(new nt(ae.Text,`speaker.profile.${t}`,this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(n)))}))}extractSpeakerContext(e){return{features:{interimResult:"enabled",progressiveDetection:"disabled"},profileIds:e.profileIds,scenario:e.scenario}}handlePhrasesResponse(e,t){if(!this.privDeferralMap.getId(t))throw new Error(`Voice Profile get activation phrases request for requestID ${t} not found`);if("success"!==e.status.statusCode.toLowerCase()){const i=ue.Canceled,r=new Br(i,e.status.statusCode,e.passPhraseType,[]);this.privDeferralMap.complete(t,r)}else{if(!(e.phrases&&e.phrases.length>0))throw new Error("Voice Profile get activation phrases failed, no phrases received");{const i=ue.EnrollingVoiceProfile,r=new Br(i,e.status.statusCode,e.passPhraseType,e.phrases);this.privDeferralMap.complete(t,r)}}}handleCreateResponse(e,t){if(!(e.profiles&&e.profiles.length>0))throw new Error("Voice Profile create failed, no profile id received");if(!this.privDeferralMap.getId(t))throw new Error(`Voice Profile create request for requestID ${t} not found`);{const i=e.profiles.map((e=>e.profileId));this.privDeferralMap.complete(t,i)}}handleResultResponse(e,t){if(!this.privDeferralMap.getId(t))throw new Error(`Voice Profile create request for requestID ${t} not found`);{const i="delete"===e.operation.toLowerCase()?ue.DeletedVoiceProfile:ue.ResetVoiceProfile,r="success"===e.status.statusCode.toLowerCase()?i:ue.Canceled,n=new Lr(r,`statusCode: ${e.status.statusCode}, errorDetails: ${e.status.reason}`);this.privDeferralMap.complete(t,n)}}handleFetchResponse(e,t){if(!this.privDeferralMap.getId(t)||!e.profiles[0])throw new Error(`Voice Profile fetch request for requestID ${t} not found`);if(this.privExpectedProfileId&&1===e.profiles.length&&e.profiles[0].profileId===this.privExpectedProfileId){this.privExpectedProfileId=void 0;const i=e.profiles[0],r=new zr(this.enrollmentReasonFrom(i.enrollmentStatus),JSON.stringify(i),e.status.reason);this.privDeferralMap.complete(t,r)}else if(e.profiles.length>0){const i=e.profiles,r=[];for(const t of i)r.push(new zr(this.enrollmentReasonFrom(t.enrollmentStatus),JSON.stringify(t),e.status.reason));this.privDeferralMap.complete(t,r)}}enrollmentReasonFrom(e){switch(e.toLowerCase()){case"enrolled":return ue.EnrolledVoiceProfile;case"invalidlocale":case"invalidphrase":case"invalidaudioformat":case"invalidscenario":case"invalidprofilecount":case"invalidoperation":case"audiotooshort":case"audiotoolong":case"toomanyenrollments":case"storageconflict":case"profilenotfound":case"incompatibleprofiles":case"incompleteenrollment":return ue.Canceled;default:return ue.EnrollingVoiceProfile}}scenarioFrom(e){return e===qi.TextIndependentIdentification?"TextIndependentIdentification":e===qi.TextIndependentVerification?"TextIndependentVerification":"TextDependentVerification"}}var jr,Jr=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Vr extends ai{constructor(e){w.throwIfNullOrUndefined(e,"speechConfig");const t=e;w.throwIfNull(t,"speechConfig"),super(mt.fromStreamInput(ve.createPushStream()),t.properties,new Fr),this.privProperties=t.properties.clone(),this.privVoiceAdapter=this.privReco,this.privDisposedVoiceAdapter=!1}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(l.SpeechServiceAuthorization_Token)}set authorizationToken(e){w.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(l.SpeechServiceAuthorization_Token,e)}createProfileAsync(e,t){return Jr(this,void 0,void 0,(function*(){const i=yield this.privVoiceAdapter.createProfile(e,t);return new Nr(i[0],e)}))}retrieveEnrollmentResultAsync(e){return Jr(this,void 0,void 0,(function*(){return this.privVoiceAdapter.retrieveEnrollmentResult(e)}))}getAllProfilesAsync(e){return Jr(this,void 0,void 0,(function*(){return this.privVoiceAdapter.getAllProfiles(e)}))}getActivationPhrasesAsync(e,t){return Jr(this,void 0,void 0,(function*(){return this.privVoiceAdapter.getActivationPhrases(e,t)}))}enrollProfileAsync(e,t){return Jr(this,void 0,void 0,(function*(){const i=t;return w.throwIfNullOrUndefined(i,"audioConfig"),this.audioConfig=t,this.privVoiceAdapter.SpeakerAudioSource=i,this.privVoiceAdapter.enrollProfile(e)}))}deleteProfileAsync(e){return Jr(this,void 0,void 0,(function*(){return this.privVoiceAdapter.deleteProfile(e)}))}resetProfileAsync(e){return Jr(this,void 0,void 0,(function*(){return this.privVoiceAdapter.resetProfile(e)}))}close(){return Jr(this,void 0,void 0,(function*(){yield this.dispose(!0)}))}createServiceRecognizer(e,t,i,r){return new Wr(e,t,i,r,this)}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return Jr(this,void 0,void 0,(function*(){this.privDisposedVoiceAdapter||(this.privDisposedVoiceAdapter=!0,e&&(yield t.dispose.call(this,e)))}))}createRecognizerConfig(e){return new x(e,this.properties)}getResult(e,t){return new Lr(e.ok?t:ue.Canceled,e.statusText)}}!function(e){e[e.Verify=0]="Verify",e[e.Identify=1]="Identify"}(jr||(jr={}));class Gr{constructor(e,t=ue.RecognizedSpeaker,i=he.NoError,r=""){this.privProperties=new Oe;const n="TextIndependentIdentification"===e.scenario?jr.Identify:jr.Verify;this.privReason=t,this.privReason!==ue.Canceled?n===jr.Identify?(this.privProfileId=e.identificationResult.identifiedProfile.profileId,this.privScore=e.identificationResult.identifiedProfile.score,this.privReason=ue.RecognizedSpeakers):(this.privScore=e.verificationResult.score,"accept"!==e.verificationResult.recognitionResult.toLowerCase()&&(this.privReason=ue.NoMatch),void 0!==e.verificationResult.profileId&&""!==e.verificationResult.profileId&&(this.privProfileId=e.verificationResult.profileId)):(this.privErrorDetails=r,this.privProperties.setProperty(Ye,he[i])),this.privProperties.setProperty(l.SpeechServiceResponse_JsonResult,JSON.stringify(e))}get properties(){return this.privProperties}get reason(){return this.privReason}get profileId(){return this.privProfileId}get errorDetails(){return this.privErrorDetails}get score(){return this.privScore}}class $r extends hr{constructor(e,t,i){super(e,t,i)}static fromResult(e){const t=pe.Error;let i=he.NoError;return e.properties&&(i=he[e.properties.getProperty(Ye,he[he.NoError])]),new $r(t,e.errorDetails,i)}}var Qr=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Zr extends ii{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privSpeakerRecognizer=n,this.privSpeakerAudioSource=i,this.recognizeSpeaker=e=>this.recognizeSpeakerOnce(e),this.sendPrePayloadJSONOverride=()=>this.noOp()}processTypeSpecificMessages(e){let t=!1;const i=new Oe;if(e.messageType===ae.Text&&i.setProperty(l.SpeechServiceResponse_JsonResult,e.textBody),"speaker.response"===e.path.toLowerCase()){const i=JSON.parse(e.textBody);let r;r="success"!==i.status.statusCode.toLowerCase()?new Gr(i,ue.Canceled,he.ServiceError,i.status.reason):new Gr(i,ue.RecognizedSpeaker),this.privResultDeferral&&this.privResultDeferral.resolve(r),t=!0}const r=new M;return r.resolve(t),r.promise}cancelRecognition(e,t,i,r,n){if((new Oe).setProperty(Ye,he[r]),this.privResultDeferral){const e=new Gr({scenario:this.privSpeakerModel.scenario,status:{statusCode:n,reason:n}},ue.Canceled,r,n);try{this.privResultDeferral.resolve(e)}catch(n){this.privResultDeferral.reject(n)}}}recognizeSpeakerOnce(e){return Qr(this,void 0,void 0,(function*(){this.privSpeakerModel=e,this.voiceProfileType=e.scenario,this.privResultDeferral||(this.privResultDeferral=new M),this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privSpeakerAudioSource.events),this.privRecognizerConfig.parameters.setProperty(l.Speech_SessionId,this.privRequestSession.sessionId);const t=this.connectImpl(),i=this.sendPreAudioMessages(this.extractSpeakerContext(e)),r=yield this.privSpeakerAudioSource.attach(this.privRequestSession.audioNodeId),n=yield this.privSpeakerAudioSource.format,s=yield this.privSpeakerAudioSource.deviceInfo,o=new Ft(r,n.avgBytesPerSec);yield this.privRequestSession.onAudioSourceAttachCompleted(o,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:s};try{yield t,yield i}catch(e){this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,pe.Error,he.ConnectionFailure,e)}const a=new wt(this.privRequestSession.sessionId);return this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,a),this.receiveMessage(),this.sendAudio(o).then((()=>{}),(e=>{this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,pe.Error,he.RuntimeError,e)})),this.privResultDeferral.promise}))}sendPreAudioMessages(e){return Qr(this,void 0,void 0,(function*(){const t=yield this.fetchConnection();yield this.sendSpeakerRecognition(t,e)}))}sendSpeakerRecognition(e,t){return Qr(this,void 0,void 0,(function*(){const i=JSON.stringify(t);return e.send(new nt(ae.Text,"speaker.context",this.privRequestSession.requestId,"application/json; charset=utf-8",i))}))}extractSpeakerContext(e){return{features:{interimResult:"enabled",progressiveDetection:"disabled"},profileIds:e.profileIds,scenario:e.scenario}}}var Xr,Yr=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class en extends ai{constructor(e,t){w.throwIfNullOrUndefined(e,"speechConfig");const i=e;w.throwIfNullOrUndefined(i,"speechConfig"),super(t,i.properties,new Ur),this.privAudioConfigImpl=t,w.throwIfNull(this.privAudioConfigImpl,"audioConfig"),this.privDisposedSpeakerRecognizer=!1,this.privProperties=i.properties}get authorizationToken(){return this.properties.getProperty(l.SpeechServiceAuthorization_Token)}set authorizationToken(e){w.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(l.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}recognizeOnceAsync(e){return Yr(this,void 0,void 0,(function*(){return w.throwIfDisposed(this.privDisposedSpeakerRecognizer),this.recognizeSpeakerOnceAsyncImpl(e)}))}close(){return Yr(this,void 0,void 0,(function*(){w.throwIfDisposed(this.privDisposedSpeakerRecognizer),yield this.dispose(!0)}))}recognizeSpeakerOnceAsyncImpl(e){return Yr(this,void 0,void 0,(function*(){w.throwIfDisposed(this.privDisposedSpeakerRecognizer),yield this.implRecognizerStop();const t=yield this.privReco.recognizeSpeaker(e);return yield this.implRecognizerStop(),t}))}implRecognizerStop(){return Yr(this,void 0,void 0,(function*(){this.privReco&&(yield this.privReco.stopRecognizing())}))}createRecognizerConfig(e){return new x(e,this.privProperties)}createServiceRecognizer(e,t,i,r){return new Zr(e,t,i,r,this)}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return Yr(this,void 0,void 0,(function*(){this.privDisposedSpeakerRecognizer||e&&(this.privDisposedSpeakerRecognizer=!0,yield t.dispose.call(this,e))}))}}class tn{constructor(e){if(this.privVoiceProfiles=[],this.privProfileIds=[],w.throwIfNullOrUndefined(e,"VoiceProfiles"),0===e.length)throw new Error("Empty Voice Profiles array");for(const t of e){if(t.profileType!==qi.TextIndependentIdentification)throw new Error("Identification model can only be created from Identification profile: "+t.profileId);this.privVoiceProfiles.push(t),this.privProfileIds.push(t.profileId)}}static fromProfiles(e){return new tn(e)}get voiceProfileIds(){return this.privProfileIds.join(",")}get profileIds(){return this.privProfileIds}get scenario(){return"TextIndependentIdentification"}}class rn{constructor(e){if(w.throwIfNullOrUndefined(e,"VoiceProfile"),e.profileType===qi.TextIndependentIdentification)throw new Error("Verification model cannot be created from Identification profile");this.privVoiceProfile=e}static fromProfile(e){return new rn(e)}get voiceProfile(){return this.privVoiceProfile}get profileIds(){return[this.voiceProfile.profileId]}get scenario(){return this.voiceProfile.profileType===qi.TextDependentVerification?"TextDependentVerification":"TextIndependentVerification"}}!function(e){e[e.AtStart=0]="AtStart",e[e.Continuous=1]="Continuous"}(Xr||(Xr={}));class nn{constructor(){this.privProperties=new Oe,this.privProperties.setProperty(l.SpeechServiceConnection_LanguageIdMode,"AtStart"),this.privLanguageIdMode=Xr.AtStart}static fromOpenRange(){const e=new nn;return e.properties.setProperty(l.SpeechServiceConnection_AutoDetectSourceLanguages,it),e}static fromLanguages(e){w.throwIfArrayEmptyOrWhitespace(e,"languages");const t=new nn;return t.properties.setProperty(l.SpeechServiceConnection_AutoDetectSourceLanguages,e.join()),t}static fromSourceLanguageConfigs(e){if(e.length<1)throw new Error("Expected non-empty SourceLanguageConfig array.");const t=new nn,i=[];return e.forEach((e=>{if(i.push(e.language),void 0!==e.endpointId&&""!==e.endpointId){const i=e.language+l.SpeechServiceConnection_EndpointId.toString();t.properties.setProperty(i,e.endpointId)}})),t.properties.setProperty(l.SpeechServiceConnection_AutoDetectSourceLanguages,i.join()),t}get properties(){return this.privProperties}set mode(e){e===Xr.Continuous?(this.privProperties.setProperty(l.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privProperties.setProperty(l.SpeechServiceConnection_LanguageIdMode,"Continuous")):(this.privProperties.setProperty(l.SpeechServiceConnection_RecognitionEndpointVersion,"1"),this.privProperties.setProperty(l.SpeechServiceConnection_LanguageIdMode,"AtStart")),this.privLanguageIdMode=e}}class sn{constructor(e,t){w.throwIfNullOrUndefined(e,"language"),w.throwIfNullOrUndefined(t,"languageDetectionConfidence"),this.privLanguage=e,this.privLanguageDetectionConfidence=t}static fromResult(e){return new sn(e.language,e.languageDetectionConfidence)}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}}class on{constructor(e,t){w.throwIfNullOrUndefined(e,"language"),this.privLanguage=e,this.privEndpointId=t}static fromLanguage(e,t){return new on(e,t)}get language(){return this.privLanguage}get endpointId(){return this.privEndpointId}}class an{static get requestOptions(){return an.privDefaultRequestOptions}static get configParams(){return an.privDefaultParams}static get restErrors(){return an.privRestErrors}}an.privDefaultRequestOptions={headers:{Accept:"application/json"},ignoreCache:!1,timeout:1e4},an.privRestErrors={authInvalidSubscriptionKey:"You must specify either an authentication token to use, or a Cognitive Speech subscription key.",authInvalidSubscriptionRegion:"You must specify the Cognitive Speech region to use.",invalidArgs:"Required input not found: {arg}.",invalidCreateJoinConversationResponse:"Creating/Joining conversation failed with HTTP {status}.",invalidParticipantRequest:"The requested participant was not found.",permissionDeniedConnect:"Required credentials not found.",permissionDeniedConversation:"Invalid operation: only the host can {command} the conversation.",permissionDeniedParticipant:"Invalid operation: only the host can {command} a participant.",permissionDeniedSend:"Invalid operation: the conversation is not in a connected state.",permissionDeniedStart:"Invalid operation: there is already an active conversation."},an.privDefaultParams={apiVersion:"api-version",authorization:"Authorization",clientAppId:"X-ClientAppId",contentTypeKey:"Content-Type",correlationId:"X-CorrelationId",languageCode:"language",nickname:"nickname",profanity:"profanity",requestId:"X-RequestId",roomId:"roomid",sessionToken:"token",subscriptionKey:"Ocp-Apim-Subscription-Key",subscriptionRegion:"Ocp-Apim-Subscription-Region",token:"X-CapitoToken"};class cn extends an{static get host(){return cn.privHost}static get apiVersion(){return cn.privApiVersion}static get clientAppId(){return cn.privClientAppId}static get defaultLanguageCode(){return cn.privDefaultLanguageCode}static get restPath(){return cn.privRestPath}static get webSocketPath(){return cn.privWebSocketPath}static get transcriptionEventKeys(){return cn.privTranscriptionEventKeys}}cn.privHost="dev.microsofttranslator.com",cn.privRestPath="/capito/room",cn.privApiVersion="2.0",cn.privDefaultLanguageCode="en-US",cn.privClientAppId="FC539C22-1767-4F1F-84BC-B4D811114F15",cn.privWebSocketPath="/capito/translate",cn.privTranscriptionEventKeys=["iCalUid","callId","organizer","FLAC","MTUri","DifferentiateGuestSpeakers","audiorecording","Threadid","OrganizerMri","OrganizerTenantId","UserToken"];class pn{constructor(e=[],t){this.participants=e,this.meId=t}addOrUpdateParticipant(e){if(void 0===e)return;const t=this.getParticipantIndex(e.id);return t>-1?this.participants.splice(t,1,e):this.participants.push(e),this.getParticipant(e.id)}getParticipantIndex(e){return this.participants.findIndex((t=>t.id===e))}getParticipant(e){return this.participants.find((t=>t.id===e))}deleteParticipant(e){this.participants=this.participants.filter((t=>t.id!==e))}get host(){return this.participants.find((e=>!0===e.isHost))}get me(){return this.getParticipant(this.meId)}}const hn="final",un="instant_message",dn="partial",ln="participant_command",vn="ChangeNickname",gn="SetMute",fn="SetProfanityFiltering",mn="SetTranslateToLanguages",Sn="SetUseTTS";var yn,Cn=i(1719),wn=i.n(Cn);!function(e){e.Get="GET",e.Post="POST",e.Delete="DELETE",e.File="file"}(yn||(yn={}));class Rn{constructor(e){if(!e)throw new P("configParams");this.privHeaders=e.headers,this.privIgnoreCache=e.ignoreCache}static extractHeaderValue(e,t){let i="";try{const r=t.trim().split(/[\r\n]+/),n={};r.forEach((e=>{const t=e.split(": "),i=t.shift().toLowerCase(),r=t.join(": ");n[i]=r})),i=n[e.toLowerCase()]}catch(e){}return i}set options(e){this.privHeaders=e.headers,this.privIgnoreCache=e.ignoreCache}setHeaders(e,t){this.privHeaders[e]=t}request(e,t,i={},r=null){const n=new M,s=e===yn.File?"POST":e,o=(e,t={})=>{const i=e;return{data:JSON.stringify(t),headers:JSON.stringify(e.headers),json:t,ok:e.statusCode>=200&&e.statusCode<300,status:e.statusCode,statusText:t.error?t.error.message:i.statusText?i.statusText:i.statusMessage}};return this.privIgnoreCache&&(this.privHeaders["Cache-Control"]="no-cache"),e===yn.Post&&r&&(this.privHeaders["content-type"]="application/json",this.privHeaders["Content-Type"]="application/json"),(r=>{wn()(t,s,this.privHeaders,200,201,202,204,400,401,402,403,404)(""===this.queryParams(i)?"":`?${this.queryParams(i)}`,r).then((t=>{return i=this,r=void 0,a=function*(){if(e===yn.Delete||204===t.statusCode)n.resolve(o(t));else try{const e=yield t.json();n.resolve(o(t,e))}catch(e){n.resolve(o(t))}},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function o(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(n,o)}c((a=a.apply(i,r||[])).next())}));var i,r,s,a})).catch((e=>{n.reject(e)}))})(r),n.promise}queryParams(e={}){return Object.keys(e).map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&")}}class Pn{constructor(){this.privRequestParams=cn.configParams,this.privErrors=cn.restErrors,this.privHost=cn.host,this.privApiVersion=cn.apiVersion,this.privRestPath=cn.restPath,this.privRestAdapter=new Rn({})}createOrJoin(e,t,i,r){try{w.throwIfNullOrUndefined(e,"args");const n=e.getProperty(l.SpeechServiceConnection_RecoLanguage,cn.defaultLanguageCode),s=e.getProperty(l.ConversationTranslator_Name,"conversation_host"),o=e.getProperty(l.ConversationTranslator_Host,this.privHost),a=e.getProperty(l.ConversationTranslator_CorrelationId),c=e.getProperty(l.SpeechServiceConnection_Key),p=e.getProperty(l.SpeechServiceConnection_Region),h=e.getProperty(l.SpeechServiceAuthorization_Token);w.throwIfNullOrWhitespace(n,"languageCode"),w.throwIfNullOrWhitespace(s,"nickname"),w.throwIfNullOrWhitespace(o,"endpointHost");const u={};u[this.privRequestParams.apiVersion]=this.privApiVersion,u[this.privRequestParams.languageCode]=n,u[this.privRequestParams.nickname]=s;const d={};a&&(d[this.privRequestParams.correlationId]=a),d[this.privRequestParams.clientAppId]=cn.clientAppId,void 0!==t?u[this.privRequestParams.roomId]=t:(w.throwIfNullOrUndefined(p,this.privErrors.authInvalidSubscriptionRegion),d[this.privRequestParams.subscriptionRegion]=p,c?d[this.privRequestParams.subscriptionKey]=c:h?d[this.privRequestParams.authorization]=`Bearer ${h}`:w.throwIfNullOrUndefined(c,this.privErrors.authInvalidSubscriptionKey));const v={};v.headers=d,this.privRestAdapter.options=v;const g=`https://${o}${this.privRestPath}`;this.privRestAdapter.request(yn.Post,g,u,null).then((e=>{const t=Rn.extractHeaderValue(this.privRequestParams.requestId,e.headers);if(!e.ok){if(r){let i,n=this.privErrors.invalidCreateJoinConversationResponse.replace("{status}",e.status.toString());try{i=JSON.parse(e.data),n+=` [${i.error.code}: ${i.error.message}]`}catch(t){n+=` [${e.data}]`}t&&(n+=` ${t}`),r(n)}return}const n=JSON.parse(e.data);if(n&&(n.requestId=t),i){try{i(n)}catch(e){r&&r(e)}i=void 0}})).catch((()=>{}))}catch(e){if(r)if(e instanceof Error){const t=e;r(t.name+": "+t.message)}else r(e)}}leave(e,t){return new Promise(((i,r)=>{try{w.throwIfNullOrUndefined(e,this.privErrors.invalidArgs.replace("{arg}","config")),w.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace("{arg}","token"));const r=e.getProperty(l.ConversationTranslator_Host,this.privHost),n=e.getProperty(l.ConversationTranslator_CorrelationId),s={};s[this.privRequestParams.apiVersion]=this.privApiVersion,s[this.privRequestParams.sessionToken]=t;const o={};n&&(o[this.privRequestParams.correlationId]=n);const a={};a.headers=o,this.privRestAdapter.options=a;const c=`https://${r}${this.privRestPath}`;this.privRestAdapter.request(yn.Delete,c,s,null).then((e=>{e.ok,i()})).catch((()=>{}))}catch(e){if(e instanceof Error){const t=e;r(t.name+": "+t.message)}else r(e)}}))}}class In extends ye{constructor(e,t,i,r){super(e,t,i,r);const n=JSON.parse(this.textBody);void 0!==n.type&&(this.privConversationMessageType=n.type)}get conversationMessageType(){return this.privConversationMessageType}}class An{toConnectionMessage(e){const t=new M;try{if(e.messageType===ae.Text){const i=new In(e.messageType,e.textContent,{},e.id);t.resolve(i)}else e.messageType===ae.Binary&&t.resolve(new In(e.messageType,e.binaryContent,void 0,e.id))}catch(e){t.reject(`Error formatting the message. Error: ${e}`)}return t.promise}fromConnectionMessage(e){const t=new M;try{if(e.messageType===ae.Text){const i=`${e.textBody?e.textBody:""}`;t.resolve(new mi(ae.Text,i,e.id))}}catch(e){t.reject(`Error formatting the message. ${e}`)}return t.promise}}class Tn extends Ai{create(e,t,i){const r=e.parameters.getProperty(l.ConversationTranslator_Host,cn.host),n=e.parameters.getProperty(l.ConversationTranslator_CorrelationId,h()),s=`wss://${r}${cn.webSocketPath}`,o=e.parameters.getProperty(l.ConversationTranslator_Token,void 0);w.throwIfNullOrUndefined(o,"token");const a={};a[cn.configParams.apiVersion]=cn.apiVersion,a[cn.configParams.token]=o,a[cn.configParams.correlationId]=n;const c="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new Ri(s,a,{},new An,Pi.fromRecognizerConfig(e),c,i)}}class bn extends Dt{}class En extends wt{constructor(e,t){super(t),this.privExpirationTime=e}get expirationTime(){return this.privExpirationTime}}class kn extends Mt{constructor(e,t,i,r,n,s,o,a,c,p,h){super(t,r,n,s,o,a,void 0,void 0,c,p,h),this.privId=e,this.privOrigLang=i}get participantId(){return this.privId}get originalLang(){return this.privOrigLang}}class xn{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.privSessionId=e,this.privRequestId=u(),this.privRequestCompletionDeferral=new M}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get completionPromise(){return this.privRequestCompletionDeferral.promise}onPreConnectionStart(e,t){this.privSessionId=t}onAuthCompleted(e){e&&this.onComplete()}onConnectionEstablishCompleted(e){200!==e&&403===e&&this.onComplete()}onServiceTurnEndResponse(e){e?this.privRequestId=u():this.onComplete()}dispose(){return e=this,t=void 0,r=function*(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const e of this.privDetachables)yield e.detach()}},new((i=void 0)||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}));var e,t,i,r}onComplete(){}}class Dn extends wt{constructor(e,t){super(t),this.privIsMuted=e}get isMuted(){return this.privIsMuted}}class On extends wt{constructor(e,t){super(t),this.privIsLocked=e}get isMuted(){return this.privIsLocked}}class Nn extends wt{constructor(e,t){super(t),this.privParticipant=e}get participant(){return this.privParticipant}}class zn extends wt{constructor(e,t,i,r){super(r),this.privKey=t,this.privValue=i,this.privParticipantId=e}get value(){return this.privValue}get key(){return this.privKey}get id(){return this.privParticipantId}}class Mn extends wt{constructor(e,t,i,r,n,s,o,a,c){super(c),this.privRoomId=e,this.privSessionToken=t,this.privTranslateTo=i,this.privProfanityFilter=r,this.privRoomProfanityFilter=n,this.privIsRoomLocked=s,this.privIsRoomLocked=o,this.privParticipants=a}get sessionToken(){return this.privSessionToken}get conversationId(){return this.privRoomId}get translateTo(){return this.privTranslateTo}get profanityFilter(){return this.privProfanityFilter}get roomProfanityFilter(){return this.privRoomProfanityFilter}get isRoomLocked(){return this.privIsRoomLocked}get isMuteAll(){return this.privIsMuteAll}get participants(){return this.privParticipants}}class Ln{constructor(e,t,i){this.privPayload=t,this.privCommand=e,this.privSessionId=i}get payload(){return this.privPayload}get command(){return this.privCommand}get sessionId(){return this.privSessionId}}class _n{constructor(e){this.privCommandResponse=(e=>JSON.parse(e))(e)}get type(){return this.privCommandResponse.type}get command(){return this.privCommandResponse.command}get id(){return this.privCommandResponse.id}get nickname(){return this.privCommandResponse.nickname}get participantId(){return this.privCommandResponse.participantId}get roomid(){return this.privCommandResponse.roomid}get value(){return this.privCommandResponse.value}get token(){return this.privCommandResponse.token}static fromJSON(e){return new _n(e)}}class Bn{constructor(e){this.privParticipantsPayloadResponse=(e=>JSON.parse(e))(e)}get roomid(){return this.privParticipantsPayloadResponse.roomid}get id(){return this.privParticipantsPayloadResponse.id}get command(){return this.privParticipantsPayloadResponse.command}get participants(){return this.privParticipantsPayloadResponse.participants}get token(){return this.privParticipantsPayloadResponse.token}get translateTo(){return this.privParticipantsPayloadResponse.translateTo}get profanityFilter(){return this.privParticipantsPayloadResponse.profanityFilter}get roomProfanityFilter(){return this.privParticipantsPayloadResponse.roomProfanityFilter}get roomLocked(){return this.privParticipantsPayloadResponse.roomLocked}get muteAll(){return this.privParticipantsPayloadResponse.muteAll}get type(){return this.privParticipantsPayloadResponse.type}static fromJSON(e){return new Bn(e)}}class qn{constructor(e){this.privParticipantPayloadResponse=(e=>JSON.parse(e))(e)}get nickname(){return this.privParticipantPayloadResponse.nickname}get locale(){return this.privParticipantPayloadResponse.locale}get usetts(){return this.privParticipantPayloadResponse.usetts}get ismuted(){return this.privParticipantPayloadResponse.ismuted}get ishost(){return this.privParticipantPayloadResponse.ishost}get participantId(){return this.privParticipantPayloadResponse.participantId}get avatar(){return this.privParticipantPayloadResponse.avatar}static fromJSON(e){return new qn(e)}}class Un{constructor(e){this.privSpeechResponse=(e=>JSON.parse(e))(e)}get recognition(){return this.privSpeechResponse.recognition}get translations(){return this.privSpeechResponse.translations}get id(){return this.privSpeechResponse.id}get language(){return this.privSpeechResponse.language}get nickname(){return this.privSpeechResponse.nickname}get participantId(){return this.privSpeechResponse.participantId}get roomid(){return this.privSpeechResponse.roomid}get timestamp(){return this.privSpeechResponse.timestamp}get type(){return this.privSpeechResponse.type}get isFinal(){return"final"===this.privSpeechResponse.type}static fromJSON(e){return new Un(e)}}class Fn{constructor(e){this.privTextResponse=(e=>JSON.parse(e))(e)}get originalText(){return this.privTextResponse.originalText}get translations(){return this.privTextResponse.translations}get id(){return this.privTextResponse.id}get language(){return this.privTextResponse.language}get nickname(){return this.privTextResponse.nickname}get participantId(){return this.privTextResponse.participantId}get roomid(){return this.privTextResponse.roomid}get timestamp(){return this.privTextResponse.timestamp}get type(){return this.privTextResponse.type}static fromJSON(e){return new Fn(e)}}var Kn=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Hn extends ii{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privConnectionConfigPromise=void 0,this.privLastPartialUtteranceId="",this.privConversationServiceConnector=n,this.privConversationAuthentication=e,this.receiveMessageOverride=()=>this.receiveConversationMessageOverride(),this.recognizeOverride=()=>this.noOp(),this.postConnectImplOverride=e=>this.conversationConnectImpl(e),this.configConnectionOverride=()=>this.configConnection(),this.disconnectOverride=()=>this.privDisconnect(),this.privConversationRequestSession=new xn(u()),this.privConversationConnectionFactory=t,this.privConversationIsDisposed=!1}isDisposed(){return super.isDisposed()||this.privConversationIsDisposed}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return Kn(this,void 0,void 0,(function*(){if(this.privConversationIsDisposed=!0,void 0!==this.privConnectionConfigPromise){const t=yield this.privConnectionConfigPromise;yield t.dispose(e)}yield t.dispose.call(this,e)}))}sendMessage(e){return Kn(this,void 0,void 0,(function*(){return(yield this.fetchConnection()).send(new In(ae.Text,e))}))}sendMessageAsync(e){return Kn(this,void 0,void 0,(function*(){const t=yield this.fetchConnection();yield t.send(new In(ae.Text,e))}))}privDisconnect(){if(!this.terminateMessageLoop)return this.cancelRecognition(this.privConversationRequestSession.sessionId,this.privConversationRequestSession.requestId,pe.Error,he.NoError,"Disconnecting"),this.terminateMessageLoop=!0,Promise.resolve()}processTypeSpecificMessages(){return Kn(this,void 0,void 0,(function*(){return!0}))}cancelRecognition(e,t,i,r,n){this.terminateMessageLoop=!0;const s=new bn(i,n,r,void 0,e);try{this.privConversationServiceConnector.canceled&&this.privConversationServiceConnector.canceled(this.privConversationServiceConnector,s)}catch(e){}}conversationConnectImpl(e){return Kn(this,void 0,void 0,(function*(){return this.privConnectionLoop=this.startMessageLoop(),e}))}receiveConversationMessageOverride(){return Kn(this,void 0,void 0,(function*(){if(this.isDisposed()||this.terminateMessageLoop)return Promise.resolve();const e=new M;try{const t=yield this.fetchConnection(),i=yield t.read();if(this.isDisposed()||this.terminateMessageLoop)return e.resolve(),Promise.resolve();if(!i)return this.receiveConversationMessageOverride();const r=this.privConversationRequestSession.sessionId,n=i.conversationMessageType.toLowerCase();let s=!1;try{switch(n){case"info":case"participant_command":case"command":const e=_n.fromJSON(i.textBody);switch(e.command.toLowerCase()){case"participantlist":const t=Bn.fromJSON(i.textBody),n=t.participants.map((e=>({avatar:e.avatar,displayName:e.nickname,id:e.participantId,isHost:e.ishost,isMuted:e.ismuted,isUsingTts:e.usetts,preferredLanguage:e.locale})));this.privConversationServiceConnector.participantsListReceived&&this.privConversationServiceConnector.participantsListReceived(this.privConversationServiceConnector,new Mn(t.roomid,t.token,t.translateTo,t.profanityFilter,t.roomProfanityFilter,t.roomLocked,t.muteAll,n,r));break;case"settranslatetolanguages":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new zn(e.participantId,mn,e.value,r));break;case"setprofanityfiltering":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new zn(e.participantId,fn,e.value,r));break;case"setmute":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new zn(e.participantId,gn,e.value,r));break;case"setmuteall":this.privConversationServiceConnector.muteAllCommandReceived&&this.privConversationServiceConnector.muteAllCommandReceived(this.privConversationServiceConnector,new Dn(e.value,r));break;case"roomexpirationwarning":this.privConversationServiceConnector.conversationExpiration&&this.privConversationServiceConnector.conversationExpiration(this.privConversationServiceConnector,new En(e.value,this.privConversationRequestSession.sessionId));break;case"setusetts":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new zn(e.participantId,Sn,e.value,r));break;case"setlockstate":this.privConversationServiceConnector.lockRoomCommandReceived&&this.privConversationServiceConnector.lockRoomCommandReceived(this.privConversationServiceConnector,new On(e.value,r));break;case"changenickname":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new zn(e.participantId,vn,e.nickname,r));break;case"joinsession":const s=qn.fromJSON(i.textBody),o={avatar:s.avatar,displayName:s.nickname,id:s.participantId,isHost:s.ishost,isMuted:s.ismuted,isUsingTts:s.usetts,preferredLanguage:s.locale};this.privConversationServiceConnector.participantJoinCommandReceived&&this.privConversationServiceConnector.participantJoinCommandReceived(this.privConversationServiceConnector,new Nn(o,r));break;case"leavesession":const a={id:e.participantId};this.privConversationServiceConnector.participantLeaveCommandReceived&&this.privConversationServiceConnector.participantLeaveCommandReceived(this.privConversationServiceConnector,new Nn(a,r));break;case"disconnectsession":e.participantId;break;case"token":const c=new si((()=>{const t=e.token;return Promise.resolve(t)}),(()=>{const t=e.token;return Promise.resolve(t)}));this.authentication=c}break;case"partial":case"final":const t=Un.fromJSON(i.textBody),o="final"===n?ue.TranslatedParticipantSpeech:ue.TranslatingParticipantSpeech,a=new kn(t.participantId,this.getTranslations(t.translations),t.language,t.id,o,t.recognition,void 0,void 0,i.textBody,void 0);t.isFinal?((void 0!==a.text&&a.text.length>0||t.id===this.privLastPartialUtteranceId)&&(s=!0),s&&this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new Ln(hn,a,r))):void 0!==a.text&&(this.privLastPartialUtteranceId=t.id,this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new Ln(dn,a,r)));break;case"translated_message":const c=Fn.fromJSON(i.textBody),p=new kn(c.participantId,this.getTranslations(c.translations),c.language,void 0,void 0,c.originalText,void 0,void 0,void 0,i.textBody,void 0);this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new Ln(un,p,r))}}catch(e){}return this.receiveConversationMessageOverride()}catch(e){this.terminateMessageLoop=!0}return e.promise}))}startMessageLoop(){return Kn(this,void 0,void 0,(function*(){if(this.isDisposed())return Promise.resolve();this.terminateMessageLoop=!1;const e=this.receiveConversationMessageOverride();try{return yield e}catch(e){return this.cancelRecognition(this.privRequestSession?this.privRequestSession.sessionId:"",this.privRequestSession?this.privRequestSession.requestId:"",pe.Error,he.RuntimeError,e),null}}))}configConnection(){return this.isDisposed()?Promise.resolve(void 0):void 0!==this.privConnectionConfigPromise?this.privConnectionConfigPromise.then((e=>e.state()===ce.Disconnected?(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection()):this.privConnectionConfigPromise),(()=>(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection()))):this.terminateMessageLoop?Promise.resolve(void 0):(this.privConnectionConfigPromise=this.connectImpl().then((e=>e)),this.privConnectionConfigPromise)}getTranslations(e){let t;if(void 0!==e){t=new ji;for(const i of e)t.set(i.lang,i.translation)}return t}}var Wn,jn=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Jn{static fromConfig(e,t,i){return new Vn(e,t,i)}}class Vn extends ai{constructor(e,t,i){const r=t;w.throwIfNull(r,"speechConfig");const n=e;w.throwIfNull(n,"conversationImpl"),super(i,r.properties,new Tn),this.privConversation=n,this.privIsDisposed=!1,this.privProperties=r.properties.clone(),this.privConnection=nr.fromRecognizer(this),this.privSetTimeout="undefined"!=typeof Blob&&"undefined"!=typeof Worker?Ht.setTimeout:setTimeout,this.privClearTimeout="undefined"!=typeof Blob&&"undefined"!=typeof Worker?Ht.clearTimeout:clearTimeout}set connected(e){this.privConnection.connected=e}set disconnected(e){this.privConnection.disconnected=e}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get properties(){return this.privProperties}isDisposed(){return this.privIsDisposed}connect(e,t,i){try{w.throwIfDisposed(this.privIsDisposed),w.throwIfNullOrWhitespace(e,"token"),this.privReco.conversationTranslatorToken=e,this.resetConversationTimeout(),this.privReco.connectAsync(t,i)}catch(e){if(i)if(e instanceof Error){const t=e;i(t.name+": "+t.message)}else i(e)}}disconnect(e,t){try{w.throwIfDisposed(this.privIsDisposed),void 0!==this.privTimeoutToken&&this.privClearTimeout(this.privTimeoutToken),this.privReco.disconnect().then((()=>{e&&e()}),(e=>{t&&t(e)}))}catch(e){if(t)if(e instanceof Error){const i=e;t(i.name+": "+i.message)}else t(e);this.dispose(!0).catch((e=>{b.instance.onEvent(new at(e))}))}}sendRequest(e,t,i){try{w.throwIfDisposed(this.privIsDisposed),this.sendMessage(e,t,i)}catch(e){if(i)if(e instanceof Error){const t=e;i(t.name+": "+t.message)}else i(e);this.dispose(!0).catch((e=>{b.instance.onEvent(new at(e))}))}}close(){return jn(this,void 0,void 0,(function*(){this.privIsDisposed||(this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close()),this.privConnection=void 0,yield this.dispose(!0))}))}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return jn(this,void 0,void 0,(function*(){this.privIsDisposed||e&&(void 0!==this.privTimeoutToken&&this.privClearTimeout(this.privTimeoutToken),this.privIsDisposed=!0,this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close(),this.privConnection=void 0),yield t.dispose.call(this,e))}))}createRecognizerConfig(e){return new x(e,this.privProperties)}createServiceRecognizer(e,t,i,r){return new Hn(e,t,i,r,this)}sendMessage(e,t,i){((e,t,i)=>{void 0!==e?e.then((()=>{try{t&&t()}catch(e){i&&i(`'Unhandled error on promise callback: ${e}'`)}}),(e=>{try{i&&i(e)}catch(e){}})):i&&i("Null promise")})(this.privReco.sendMessageAsync(e),t,i),this.resetConversationTimeout()}resetConversationTimeout(){void 0!==this.privTimeoutToken&&this.privClearTimeout(this.privTimeoutToken),this.privTimeoutToken=this.privSetTimeout((()=>{this.sendRequest(this.privConversation.getKeepAlive())}),6e4)}}class Gn extends wt{constructor(e,t,i){super(i),this.privReason=e,this.privParticipant=t}get reason(){return this.privReason}get participants(){return this.privParticipant}}!function(e){e[e.JoinedConversation=0]="JoinedConversation",e[e.LeftConversation=1]="LeftConversation",e[e.Updated=2]="Updated"}(Wn||(Wn={}));class $n extends Rt{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}}class Qn{constructor(e){this.privUserId=e}get userId(){return this.privUserId}}class Zn{constructor(e,t,i,r,n,s,o,a){this.privId=e,this.privAvatar=t,this.privDisplayName=i,this.privIsHost=r,this.privIsMuted=n,this.privIsUsingTts=s,this.privPreferredLanguage=o,this.privVoice=a,this.privProperties=new Oe}get avatar(){return this.privAvatar}get displayName(){return this.privDisplayName}get id(){return this.privId}get preferredLanguage(){return this.privPreferredLanguage}get isHost(){return this.privIsHost}get isMuted(){return this.privIsMuted}get isUsingTts(){return this.privIsUsingTts}get voice(){return this.privVoice}get properties(){return this.privProperties}static From(e,t,i){return new Zn(e,"",e,!1,!1,!1,t,i)}}var Xn=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Yn{constructor(){}static createConversationAsync(e,t,i,r){let n,s,o;return w.throwIfNullOrUndefined(e,cn.restErrors.invalidArgs.replace("{arg}","config")),w.throwIfNullOrUndefined(e.region,cn.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),e.subscriptionKey||e.getProperty(l[l.SpeechServiceAuthorization_Token])||w.throwIfNullOrUndefined(e.subscriptionKey,cn.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key")),"string"==typeof t?(n=new es(e,t),L((()=>Xn(this,void 0,void 0,(function*(){})))(),i,r)):(n=new es(e),s=t,o=i,n.createConversationAsync((()=>{s&&s()}),(e=>{o&&o(e)}))),n}}class es extends Yn{constructor(e,t){if(super(),this.privErrors=cn.restErrors,this.onConnected=e=>{var t;this.privIsConnected=!0;try{(null===(t=this.privConversationTranslator)||void 0===t?void 0:t.sessionStarted)&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,e)}catch(e){}},this.onDisconnected=e=>{var t;try{(null===(t=this.privConversationTranslator)||void 0===t?void 0:t.sessionStopped)&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,e)}catch(e){}finally{this.close(!1)}},this.onCanceled=(e,t)=>{var i;try{(null===(i=this.privConversationTranslator)||void 0===i?void 0:i.canceled)&&this.privConversationTranslator.canceled(this.privConversationTranslator,t)}catch(t){}},this.onParticipantUpdateCommandReceived=(e,t)=>{try{const e=this.privParticipants.getParticipant(t.id);if(void 0!==e){switch(t.key){case vn:e.displayName=t.value;break;case Sn:e.isUsingTts=t.value;break;case fn:e.profanity=t.value;break;case gn:e.isMuted=t.value;break;case mn:e.translateToLanguages=t.value}this.privParticipants.addOrUpdateParticipant(e),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new Gn(Wn.Updated,[this.toParticipant(e)],t.sessionId))}}catch(t){}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(e,t)=>{try{this.privParticipants.participants.forEach((e=>e.isMuted=!e.isHost&&t.isMuted)),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new Gn(Wn.Updated,this.toParticipants(!1),t.sessionId))}catch(t){}},this.onParticipantJoinCommandReceived=(e,t)=>{try{const e=this.privParticipants.addOrUpdateParticipant(t.participant);void 0!==e&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new Gn(Wn.JoinedConversation,[this.toParticipant(e)],t.sessionId))}catch(t){}},this.onParticipantLeaveCommandReceived=(e,t)=>{try{const e=this.privParticipants.getParticipant(t.participant.id);void 0!==e&&(this.privParticipants.deleteParticipant(t.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new Gn(Wn.LeftConversation,[this.toParticipant(e)],t.sessionId)))}catch(t){}},this.onTranslationReceived=(e,t)=>{try{switch(t.command){case hn:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new $n(t.payload,void 0,t.sessionId));break;case dn:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new $n(t.payload,void 0,t.sessionId));break;case un:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new $n(t.payload,void 0,t.sessionId))}}catch(t){}},this.onParticipantsListReceived=(e,t)=>{var i;try{if(void 0!==t.sessionToken&&null!==t.sessionToken&&(this.privRoom.token=t.sessionToken),this.privParticipants.participants=[...t.participants],void 0!==this.privParticipants.me&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new Gn(Wn.JoinedConversation,this.toParticipants(!0),t.sessionId)),this.me.isHost){const e=null===(i=this.privConversationTranslator)||void 0===i?void 0:i.properties.getProperty(l.ConversationTranslator_Name);void 0!==e&&e.length>0&&e!==this.me.displayName&&this.changeNicknameAsync(e)}}catch(t){}},this.onConversationExpiration=(e,t)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,t)}catch(t){}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new Oe,this.privManager=new Pn,e.getProperty(l[l.SpeechServiceConnection_RecoLanguage])||e.setProperty(l[l.SpeechServiceConnection_RecoLanguage],cn.defaultLanguageCode),this.privLanguage=e.getProperty(l[l.SpeechServiceConnection_RecoLanguage]),t)this.privConversationId=t;else{0===e.targetLanguages.length&&e.addTargetLanguage(this.privLanguage),e.getProperty(l[l.SpeechServiceResponse_ProfanityOption])||e.setProfanity(lt.Masked);let t=e.getProperty(l[l.ConversationTranslator_Name]);null==t&&(t="Host"),w.throwIfNullOrTooLong(t,"nickname",50),w.throwIfNullOrTooShort(t,"nickname",2),e.setProperty(l[l.ConversationTranslator_Name],t)}this.privConfig=e;const i=e;w.throwIfNull(i,"speechConfig"),this.privProperties=i.properties.clone(),this.privIsConnected=!1,this.privParticipants=new pn,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get conversationId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){var e,t;return!(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isHost)&&(null===(t=this.privParticipants.me)||void 0===t?void 0:t.isMuted)}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get conversationInfo(){const e=this.conversationId,t=this.participants.map((e=>({id:e.id,preferredLanguage:e.preferredLanguage,voice:e.voice}))),i={};for(const e of cn.transcriptionEventKeys){const t=this.properties.getProperty(e,"");""!==t&&(i[e]=t)}return{id:e,participants:t,conversationProperties:i}}get canSend(){var e;return this.privIsConnected&&!(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isMuted)}get canSendAsHost(){var e;return this.privIsConnected&&(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isHost)}get authorizationToken(){return this.privToken}set authorizationToken(e){w.throwIfNullOrWhitespace(e,"authorizationToken"),this.privToken=e}set conversationTranslator(e){this.privConversationTranslator=e}createConversationAsync(e,t){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),t),this.privManager.createOrJoin(this.privProperties,void 0,(i=>{i||this.handleError(new Error(this.privErrors.permissionDeniedConnect),t),this.privRoom=i,this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}startConversationAsync(e,t){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),t),w.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer=Jn.fromConfig(this,this.privConfig),this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}addParticipantAsync(e,t,i){w.throwIfNullOrUndefined(e,"Participant"),L(this.addParticipantImplAsync(e),t,i)}joinConversationAsync(e,t,i,r,n){try{w.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","conversationId")),w.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace("{arg}","nickname")),w.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,e,(e=>{w.throwIfNullOrUndefined(e,this.privErrors.permissionDeniedConnect),this.privRoom=e,this.privConfig.authorizationToken=e.cognitiveSpeechAuthToken,r&&r(e.cognitiveSpeechAuthToken)}),(e=>{this.handleError(e,n)}))}catch(e){this.handleError(e,n)}}deleteConversationAsync(e,t){L(this.deleteConversationImplAsync(),e,t)}deleteConversationImplAsync(){return Xn(this,void 0,void 0,(function*(){w.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),w.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),yield this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}))}endConversationAsync(e,t){L(this.endConversationImplAsync(),e,t)}endConversationImplAsync(){return this.close(!0)}lockConversationAsync(e,t){try{w.throwIfDisposed(this.privIsDisposed),w.throwIfDisposed(this.privConversationRecognizer.isDisposed()),w.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}muteAllParticipantsAsync(e,t){try{w.throwIfDisposed(this.privIsDisposed),w.throwIfDisposed(this.privConversationRecognizer.isDisposed()),w.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),w.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}muteParticipantAsync(e,t,i){try{w.throwIfDisposed(this.privIsDisposed),w.throwIfDisposed(this.privConversationRecognizer.isDisposed()),w.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","userId")),w.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.me.isHost||this.me.id===e||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),i),-1===this.privParticipants.getParticipantIndex(e)&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(e,!0),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}removeParticipantAsync(e,t,i){try{if(w.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&e.hasOwnProperty("id"))L(this.removeParticipantImplAsync(e),t,i);else{w.throwIfDisposed(this.privConversationRecognizer.isDisposed()),w.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),i);let r="";"string"==typeof e?r=e:e.hasOwnProperty("id")?r=e.id:e.hasOwnProperty("userId")&&(r=e.userId),w.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","userId")),-1===this.participants.findIndex((e=>e.id===r))&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(r),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}}catch(e){this.handleError(e,i)}}unlockConversationAsync(e,t){try{w.throwIfDisposed(this.privIsDisposed),w.throwIfDisposed(this.privConversationRecognizer.isDisposed()),w.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}unmuteAllParticipantsAsync(e,t){try{w.throwIfDisposed(this.privIsDisposed),w.throwIfDisposed(this.privConversationRecognizer.isDisposed()),w.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}unmuteParticipantAsync(e,t,i){try{w.throwIfDisposed(this.privIsDisposed),w.throwIfDisposed(this.privConversationRecognizer.isDisposed()),w.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","userId")),w.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.me.isHost||this.me.id===e||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),i),-1===this.privParticipants.getParticipantIndex(e)&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(e,!1),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}sendTextMessageAsync(e,t,i){try{w.throwIfDisposed(this.privIsDisposed),w.throwIfDisposed(this.privConversationRecognizer.isDisposed()),w.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","message")),w.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),e.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(e),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}setTranslatedLanguagesAsync(e,t,i){try{w.throwIfDisposed(this.privIsDisposed),w.throwIfDisposed(this.privConversationRecognizer.isDisposed()),w.throwIfArrayEmptyOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","languages")),w.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(e),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}changeNicknameAsync(e,t,i){try{w.throwIfDisposed(this.privIsDisposed),w.throwIfDisposed(this.privConversationRecognizer.isDisposed()),w.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","nickname")),w.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(e),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}connectTranscriberRecognizer(e){return Xn(this,void 0,void 0,(function*(){this.privTranscriberRecognizer&&(yield this.privTranscriberRecognizer.close()),yield e.enforceAudioGating(),this.privTranscriberRecognizer=e,this.privTranscriberRecognizer.conversation=this}))}getKeepAlive(){const e=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:e,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:"keep_alive"})}addParticipantImplAsync(e){if(void 0!==this.privParticipants.addOrUpdateParticipant(e)&&this.privTranscriberRecognizer){const t=this.conversationInfo;return t.participants=[e],this.privTranscriberRecognizer.pushConversationEvent(t,"join")}}removeParticipantImplAsync(e){this.privParticipants.deleteParticipant(e.id);const t=this.conversationInfo;return t.participants=[e],this.privTranscriberRecognizer.pushConversationEvent(t,"leave")}close(e){var t;return Xn(this,void 0,void 0,(function*(){try{this.privIsConnected=!1,yield null===(t=this.privConversationRecognizer)||void 0===t?void 0:t.close(),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(e){throw e}e&&this.dispose()}))}handleCallback(e,t){if(e){try{e()}catch(e){t&&t(e)}e=void 0}}handleError(e,t){if(t)if(e instanceof Error){const i=e;t(i.name+": "+i.message)}else t(e)}toParticipants(e){const t=this.privParticipants.participants.map((e=>this.toParticipant(e)));return e?t:t.filter((e=>!1===e.isHost))}toParticipant(e){return new Zn(e.id,e.avatar,e.displayName,e.isHost,e.isMuted,e.isUsingTts,e.preferredLanguage,e.voice)}getMuteAllCommand(e){return w.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),w.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:"SetMuteAll",participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:ln,value:e})}getMuteCommand(e,t){return w.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),w.throwIfNullOrWhitespace(e,"participantId"),JSON.stringify({command:gn,participantId:e,roomid:this.privRoom.roomId,type:ln,value:t})}getLockCommand(e){return w.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),w.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:"SetLockState",participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:ln,value:e})}getEjectCommand(e){return w.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),w.throwIfNullOrWhitespace(e,"participantId"),JSON.stringify({command:"EjectParticipant",participantId:e,roomid:this.privRoom.roomId,type:ln})}getSetTranslateToLanguagesCommand(e){return w.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),w.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:mn,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:ln,value:e})}getChangeNicknameCommand(e){return w.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),w.throwIfNullOrWhitespace(e,"nickname"),w.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:vn,nickname:e,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:ln,value:e})}getMessageCommand(e){return w.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),w.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),w.throwIfNullOrWhitespace(e,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:e,type:un})}}class ts extends Ai{constructor(){super(...arguments),this.multiaudioRelativeUri="/speech/recognition/multiaudio"}create(e,t,i){let r=e.parameters.getProperty(l.SpeechServiceConnection_Endpoint,void 0);const n=e.parameters.getProperty(l.SpeechServiceConnection_Region,"centralus"),s="wss://transcribe."+n+".cts.speech"+Ai.getHostSuffix(n)+this.multiaudioRelativeUri,o=e.parameters.getProperty(l.SpeechServiceConnection_Host,s),a={};this.setQueryParams(a,e,r),r||(r=o);const c={};void 0!==t.token&&""!==t.token&&(c[t.headerName]=t.token),c[rt.ConnectionId]=i,e.parameters.setProperty(l.SpeechServiceConnection_Url,r);const p="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new Ri(r,a,c,new Ti,Pi.fromRecognizerConfig(e),p,i)}setQueryParams(e,t,i){const r=t.parameters.getProperty(l.SpeechServiceConnection_EndpointId,void 0),n=t.parameters.getProperty(l.SpeechServiceConnection_RecoLanguage,void 0);r&&!(Ii.CustomSpeechDeploymentId in e)&&(e[Ii.CustomSpeechDeploymentId]=r),n&&!(Ii.Language in e)&&(e[Ii.Language]=n);const s="true"===t.parameters.getProperty(l.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase(),o=t.parameters.getProperty(Xe,dt[dt.Simple])!==dt[dt.Simple];(s||o)&&(e[Ii.Format]=dt[dt.Detailed].toLowerCase()),this.setCommonUrlParams(t,e,i)}}class is extends Ai{constructor(e){super(),w.throwIfNullOrUndefined(e,"convGetter"),this.privConvGetter=e}create(e,t,i){const r="TRUE"===e.parameters.getProperty("ConversationTranslator_MultiChannelAudio","").toUpperCase(),n=this.privConvGetter().room,s=n.cognitiveSpeechRegion||e.parameters.getProperty(l.SpeechServiceConnection_Region,""),o={hostSuffix:Ai.getHostSuffix(s),path:is.CTS_VIRT_MIC_PATH,region:encodeURIComponent(s)};o[Ii.Language]=encodeURIComponent(e.parameters.getProperty(l.SpeechServiceConnection_RecoLanguage,"")),o[Ii.CtsMeetingId]=encodeURIComponent(n.roomId),o[Ii.CtsDeviceId]=encodeURIComponent(n.participantId),o[Ii.CtsIsParticipant]=n.isHost?"":"&"+Ii.CtsIsParticipant;let a="";const c={},p={};if(r){a=e.parameters.getProperty(l.SpeechServiceConnection_Endpoint),a||(a="wss://"+e.parameters.getProperty(l.SpeechServiceConnection_Host,"transcribe.{region}.cts.speech{hostSuffix}")+"{path}"),a=Ki.formatString(a,o);const t=new URL(a);t.searchParams.forEach(((e,t)=>{c[t]=e})),(new ts).setQueryParams(c,e,a),c[Ii.CtsMeetingId]=o[Ii.CtsMeetingId],c[Ii.CtsDeviceId]=o[Ii.CtsDeviceId],n.isHost||(c[Ii.CtsIsParticipant]=""),Ii.Format in c||(c[Ii.Format]="simple"),t.searchParams.forEach(((e,i)=>{t.searchParams.set(i,c[i]),delete c[i]})),a=t.toString()}else{const t=new Hi;a=t.getEndpointUrl(e,!0),a=Ki.formatString(a,o),t.setQueryParams(c,e,a)}p[rt.ConnectionId]=i,p[an.configParams.token]=n.token,t.token&&(p[t.headerName]=t.token);const h="TRUE"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","").toUpperCase();return new Ri(a,c,p,new Ti,Pi.fromRecognizerConfig(e),h,i)}}is.CTS_VIRT_MIC_PATH="/speech/recognition/dynamicaudio";class rs{constructor(e){this.privAudioConfig=e}handleCallback(e,t){if(e){try{e()}catch(e){t&&t(e)}e=void 0}}handleError(e,t){if(t)if(e instanceof Error){const i=e;t(i.name+": "+i.message)}else t(e)}}var ns,ss=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};!function(e){e[e.Inactive=0]="Inactive",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected"}(ns||(ns={}));class os extends cr{constructor(e,t,i,r){super(e,t,new is(r)),this.privSpeechState=ns.Inactive,i&&(this.privTranslator=i,this.sessionStarted=()=>{this.privSpeechState=ns.Connected},this.sessionStopped=()=>{this.privSpeechState=ns.Inactive},this.recognizing=(e,t)=>{this.privTranslator.recognizing&&this.privTranslator.recognizing(this.privTranslator,t)},this.recognized=(e,t)=>ss(this,void 0,void 0,(function*(){var e;(null===(e=t.result)||void 0===e?void 0:e.errorDetails)?(yield this.cancelSpeech(),this.fireCancelEvent(t.result.errorDetails)):this.privTranslator.recognized&&this.privTranslator.recognized(this.privTranslator,t)})),this.canceled=()=>ss(this,void 0,void 0,(function*(){if(this.privSpeechState!==ns.Inactive)try{yield this.cancelSpeech()}catch(e){this.privSpeechState=ns.Inactive}})))}get state(){return this.privSpeechState}set state(e){this.privSpeechState=e}onConnection(){this.privSpeechState=ns.Connected}onDisconnection(){return ss(this,void 0,void 0,(function*(){this.privSpeechState=ns.Inactive,yield this.cancelSpeech()}))}fireCancelEvent(e){try{if(this.privTranslator.canceled){const t=new bn(pe.Error,e,he.RuntimeError);this.privTranslator.canceled(this.privTranslator,t)}}catch(e){}}cancelSpeech(){var e;return ss(this,void 0,void 0,(function*(){try{this.stopContinuousRecognitionAsync(),yield null===(e=this.privReco)||void 0===e?void 0:e.disconnect(),this.privSpeechState=ns.Inactive}catch(e){}}))}}class as extends rs{constructor(e){super(e),this.privErrors=cn.restErrors,this.privIsDisposed=!1,this.privIsSpeaking=!1,this.privPlaceholderKey="abcdefghijklmnopqrstuvwxyz012345",this.privPlaceholderRegion="westus",this.privProperties=new Oe}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get participants(){var e;return null===(e=this.privConversation)||void 0===e?void 0:e.participants}get canSpeak(){return!(!this.privConversation.isConnected||!this.privCTRecognizer||this.privIsSpeaking||this.privCTRecognizer.state===ns.Connected||this.privCTRecognizer.state===ns.Connecting||this.privConversation.isMutedByHost)}setServiceProperty(e,t){const i=JSON.parse(this.privProperties.getProperty(et,"{}"));i[e]=t,this.privProperties.setProperty(et,JSON.stringify(i))}joinConversationAsync(e,t,i,r,n){try{if("string"==typeof e){w.throwIfNullOrUndefined(e,this.privErrors.invalidArgs.replace("{arg}","conversation id")),w.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privConversation&&this.handleError(new Error(this.privErrors.permissionDeniedStart),n);let s=i;null!=s&&""!==s||(s=cn.defaultLanguageCode),this.privSpeechTranslationConfig=qt.fromSubscription(this.privPlaceholderKey,this.privPlaceholderRegion),this.privSpeechTranslationConfig.setProfanity(lt.Masked),this.privSpeechTranslationConfig.addTargetLanguage(s),this.privSpeechTranslationConfig.setProperty(l[l.SpeechServiceConnection_RecoLanguage],s),this.privSpeechTranslationConfig.setProperty(l[l.ConversationTranslator_Name],t);const o=[l.SpeechServiceConnection_Host,l.ConversationTranslator_Host,l.SpeechServiceConnection_Endpoint,l.SpeechServiceConnection_ProxyHostName,l.SpeechServiceConnection_ProxyPassword,l.SpeechServiceConnection_ProxyPort,l.SpeechServiceConnection_ProxyUserName,"ConversationTranslator_MultiChannelAudio","ConversationTranslator_Region"];for(const e of o){const t=this.privProperties.getProperty(e);if(t){const i="string"==typeof e?e:l[e];this.privSpeechTranslationConfig.setProperty(i,t)}}const a=JSON.parse(this.privProperties.getProperty(et,"{}"));for(const e of Object.keys(a))this.privSpeechTranslationConfig.setServiceProperty(e,a[e],kr.UriQueryParameter);this.privConversation=new es(this.privSpeechTranslationConfig),this.privConversation.conversationTranslator=this,this.privConversation.joinConversationAsync(e,t,s,(e=>{e||this.handleError(new Error(this.privErrors.permissionDeniedConnect),n),this.privSpeechTranslationConfig.authorizationToken=e,this.privConversation.room.isHost=!1,this.privConversation.startConversationAsync((()=>{this.handleCallback(r,n)}),(e=>{this.handleError(e,n)}))}),(e=>{this.handleError(e,n)}))}else"object"==typeof e?(w.throwIfNullOrUndefined(e,this.privErrors.invalidArgs.replace("{arg}","conversation id")),w.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privProperties.setProperty(l.ConversationTranslator_Name,t),this.privConversation=e,this.privConversation.conversationTranslator=this,this.privConversation.room.isHost=!0,w.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedConnect),w.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privSpeechTranslationConfig=e.config,this.handleCallback(i,r)):this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","invalid conversation type")),r)}catch(e){this.handleError(e,"string"==typeof i?n:r)}}leaveConversationAsync(e,t){L((()=>ss(this,void 0,void 0,(function*(){yield this.cancelSpeech(),yield this.privConversation.endConversationImplAsync(),yield this.privConversation.deleteConversationImplAsync(),this.dispose()})))(),e,t)}sendTextMessageAsync(e,t,i){try{w.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),w.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}",e)),this.privConversation.sendTextMessageAsync(e,t,i)}catch(e){this.handleError(e,i)}}startTranscribingAsync(e,t){L((()=>ss(this,void 0,void 0,(function*(){try{w.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),w.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),void 0===this.privCTRecognizer&&(yield this.connectTranslatorRecognizer()),w.throwIfNullOrUndefined(this.privCTRecognizer,this.privErrors.permissionDeniedSend),this.canSpeak||this.handleError(new Error(this.privErrors.permissionDeniedSend),t),yield this.startContinuousRecognition(),this.privIsSpeaking=!0}catch(e){throw this.privIsSpeaking=!1,yield this.cancelSpeech(),e}})))(),e,t)}stopTranscribingAsync(e,t){L((()=>ss(this,void 0,void 0,(function*(){try{if(!this.privIsSpeaking)return void(yield this.cancelSpeech());this.privIsSpeaking=!1,yield new Promise(((e,t)=>{this.privCTRecognizer.stopContinuousRecognitionAsync(e,t)}))}catch(e){yield this.cancelSpeech()}})))(),e,t)}isDisposed(){return this.privIsDisposed}dispose(e,t,i){L((()=>ss(this,void 0,void 0,(function*(){this.isDisposed&&!this.privIsSpeaking||(yield this.cancelSpeech(),this.privIsDisposed=!0,this.privSpeechTranslationConfig.close(),this.privSpeechRecognitionLanguage=void 0,this.privProperties=void 0,this.privAudioConfig=void 0,this.privSpeechTranslationConfig=void 0,this.privConversation.dispose(),this.privConversation=void 0)})))(),t,i)}cancelSpeech(){var e;return ss(this,void 0,void 0,(function*(){try{this.privIsSpeaking=!1,yield null===(e=this.privCTRecognizer)||void 0===e?void 0:e.onDisconnection(),this.privCTRecognizer=void 0}catch(e){}}))}connectTranslatorRecognizer(){return ss(this,void 0,void 0,(function*(){try{void 0===this.privAudioConfig&&(this.privAudioConfig=mt.fromDefaultMicrophoneInput()),this.privSpeechTranslationConfig.getProperty(l[l.SpeechServiceConnection_Key])===this.privPlaceholderKey&&this.privSpeechTranslationConfig.setProperty(l[l.SpeechServiceConnection_Key],"");const e=()=>this.privConversation;this.privCTRecognizer=new os(this.privSpeechTranslationConfig,this.privAudioConfig,this,e)}catch(e){throw yield this.cancelSpeech(),e}}))}startContinuousRecognition(){return new Promise(((e,t)=>{this.privCTRecognizer.startContinuousRecognitionAsync(e,t)}))}}class cs extends Dt{}var ps=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class hs extends Vi{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privTranscriberRecognizer=n,this.sendPrePayloadJSONOverride=e=>this.sendTranscriptionStartJSON(e),"true"===this.privRecognizerConfig.parameters.getProperty(l.SpeechServiceResponse_RequestWordLevelTimestamps)&&this.privSpeechContext.setWordLevelTimings()}sendSpeechEventAsync(e,t){return ps(this,void 0,void 0,(function*(){if(this.privRequestSession.isRecognizing){const i=yield this.fetchConnection();yield this.sendSpeechEvent(i,this.createSpeechEventPayload(e,t))}}))}processTypeSpecificMessages(e){return this.processSpeechMessages(e)}handleRecognizedCallback(e,t,i){try{const r=new kt(e,t,i);if(this.privTranscriberRecognizer.recognized(this.privTranscriberRecognizer,r),this.privSuccessCallback){try{this.privSuccessCallback(e)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}catch(e){}}handleRecognizingCallback(e,t,i){try{const r=new kt(e,t,i);this.privTranscriberRecognizer.recognizing(this.privTranscriberRecognizer,r)}catch(e){}}cancelRecognition(e,t,i,r,n){const s=new Oe;if(s.setProperty(Ye,he[r]),this.privTranscriberRecognizer.canceled){const t=new cs(i,n,r,void 0,e);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,t)}catch(e){}}if(this.privSuccessCallback){const e=new At(t,ue.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,n,void 0,s);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch(e){}}}sendTranscriptionStartJSON(e){return ps(this,void 0,void 0,(function*(){yield this.sendSpeechContext(e,!0);const t=this.privTranscriberRecognizer.getConversationInfo(),i=this.createSpeechEventPayload(t,"start");yield this.sendSpeechEvent(e,i),yield this.sendWaveHeader(e)}))}sendSpeechEvent(e,t){const i=JSON.stringify(t);if(i)return e.send(new nt(ae.Text,"speech.event",this.privRequestSession.requestId,"application/json",i))}createSpeechEventPayload(e,t){const i={id:"meeting",name:t,meeting:e.conversationProperties};return i.meeting.id=e.id,i.meeting.attendees=e.participants,i.meeting.record="on"===e.conversationProperties.audiorecording?"true":"false",i}}var us=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class ds extends ai{constructor(e,t){const i=e;w.throwIfNull(i,"speechTranslationConfig");const r=t;w.throwIfNull(r,"audioConfigImpl"),w.throwIfNullOrWhitespace(i.speechRecognitionLanguage,l[l.SpeechServiceConnection_RecoLanguage]),super(t,i.properties,new ts),this.privDisposedRecognizer=!1}get speechRecognitionLanguage(){return w.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(l.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(l.SpeechServiceAuthorization_Token)}set authorizationToken(e){w.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(l.SpeechServiceAuthorization_Token,e)}set conversation(e){w.throwIfNullOrUndefined(e,"Conversation"),this.privConversation=e}getConversationInfo(){return w.throwIfNullOrUndefined(this.privConversation,"Conversation"),this.privConversation.conversationInfo}startContinuousRecognitionAsync(e,t){L(this.startContinuousRecognitionAsyncImpl(v.Conversation),e,t)}stopContinuousRecognitionAsync(e,t){L(this.stopContinuousRecognitionAsyncImpl(),e,t)}close(){return us(this,void 0,void 0,(function*(){this.privDisposedRecognizer||(yield this.dispose(!0))}))}pushConversationEvent(e,t){return us(this,void 0,void 0,(function*(){const i=this.privReco;w.throwIfNullOrUndefined(i,"serviceRecognizer"),yield i.sendSpeechEventAsync(e,t)}))}enforceAudioGating(){return us(this,void 0,void 0,(function*(){const e=this.audioConfig,t=(yield e.format).channels;if(1===t){if("true"!==this.properties.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase())throw new Error("Single channel audio configuration for ConversationTranscriber is currently under private preview, please contact diarizationrequest@microsoft.com for more details")}else if(8!==t)throw new Error(`Unsupported audio configuration: Detected ${t}-channel audio`)}))}connectCallbacks(e){this.canceled=(t,i)=>{e.canceled&&e.canceled(e,i)},this.recognizing=(t,i)=>{e.transcribing&&e.transcribing(e,i)},this.recognized=(t,i)=>{e.transcribed&&e.transcribed(e,i)},this.sessionStarted=(t,i)=>{e.sessionStarted&&e.sessionStarted(e,i)},this.sessionStopped=(t,i)=>{e.sessionStopped&&e.sessionStopped(e,i)}}disconnectCallbacks(){this.canceled=void 0,this.recognizing=void 0,this.recognized=void 0,this.sessionStarted=void 0,this.sessionStopped=void 0}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return us(this,void 0,void 0,(function*(){this.privDisposedRecognizer||(e&&(this.privDisposedRecognizer=!0,yield this.implRecognizerStop()),yield t.dispose.call(this,e))}))}createRecognizerConfig(e){return new x(e,this.properties)}createServiceRecognizer(e,t,i,r){return new hs(e,t,i,r,this)}}var ls,vs,gs,fs=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class ms{constructor(e){this.privAudioConfig=e,this.privProperties=new Oe,this.privRecognizer=void 0,this.privDisposedRecognizer=!1}get speechRecognitionLanguage(){return w.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(l.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get internalData(){return this.privRecognizer.internalData}get connection(){return nr.fromRecognizer(this.privRecognizer)}get authorizationToken(){return this.properties.getProperty(l.SpeechServiceAuthorization_Token)}set authorizationToken(e){w.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(l.SpeechServiceAuthorization_Token,e)}joinConversationAsync(e,t,i){const r=e;w.throwIfNullOrUndefined(r,"Conversation"),this.privRecognizer=new ds(e.config,this.privAudioConfig),w.throwIfNullOrUndefined(this.privRecognizer,"Recognizer"),this.privRecognizer.connectCallbacks(this),L(r.connectTranscriberRecognizer(this.privRecognizer),t,i)}startTranscribingAsync(e,t){this.privRecognizer.startContinuousRecognitionAsync(e,t)}stopTranscribingAsync(e,t){this.privRecognizer.stopContinuousRecognitionAsync(e,t)}leaveConversationAsync(e,t){this.privRecognizer.disconnectCallbacks(),L((()=>fs(this,void 0,void 0,(function*(){})))(),e,t)}close(e,t){w.throwIfDisposed(this.privDisposedRecognizer),L(this.dispose(!0),e,t)}dispose(e){return fs(this,void 0,void 0,(function*(){this.privDisposedRecognizer||(this.privRecognizer&&(yield this.privRecognizer.close(),this.privRecognizer=void 0),e&&(this.privDisposedRecognizer=!0))}))}}class Ss{constructor(){this.synthesisUri="/cognitiveservices/websocket/v1"}create(e,t,i){let r=e.parameters.getProperty(l.SpeechServiceConnection_Endpoint,void 0);const n=e.parameters.getProperty(l.SpeechServiceConnection_Region,void 0),s=Ai.getHostSuffix(n),o=e.parameters.getProperty(l.SpeechServiceConnection_EndpointId,void 0),a=void 0===o?"tts":"voice",c=e.parameters.getProperty(l.SpeechServiceConnection_Host,"wss://"+n+"."+a+".speech"+s);r||(r=c+this.synthesisUri);const p={};void 0!==t.token&&""!==t.token&&(p[t.headerName]=t.token),p[rt.ConnectionId]=i,void 0!==o&&(p[Ii.CustomVoiceDeploymentId]=o),e.parameters.setProperty(l.SpeechServiceConnection_Url,r);const h="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new Ri(r,{},p,new Ti,Pi.fromParameters(e.parameters),h,i)}}!function(e){e[e.Standard=0]="Standard",e[e.Custom=1]="Custom"}(ls||(ls={}));class ys{constructor(e,t){this.privSynthesisServiceType=ls.Standard,this.privSpeechServiceConfig=e||new D(new O(null)),this.privParameters=t}get parameters(){return this.privParameters}get synthesisServiceType(){return this.privSynthesisServiceType}set synthesisServiceType(e){this.privSynthesisServiceType=e}get SpeechServiceConfig(){return this.privSpeechServiceConfig}}class Cs{constructor(e,t){let i=e.parameters.getProperty(l.SpeechServiceConnection_Endpoint,void 0);if(!i){const t=e.parameters.getProperty(l.SpeechServiceConnection_Region,"westus"),r=Ai.getHostSuffix(t);i=e.parameters.getProperty(l.SpeechServiceConnection_Host,`https://${t}.tts.speech${r}`)}this.privUri=`${i}/cognitiveservices/voices/list`;const r=an.requestOptions;this.privRestAdapter=new Rn(r),this.privAuthentication=t}getVoicesList(e){return this.privRestAdapter.setHeaders(rt.ConnectionId,e),this.privAuthentication.fetch(e).then((e=>(this.privRestAdapter.setHeaders(e.headerName,e.token),this.privRestAdapter.request(yn.Get,this.privUri))))}}!function(e){e[e.Unknown=0]="Unknown",e[e.Female=1]="Female",e[e.Male=2]="Male"}(vs||(vs={})),function(e){e[e.OnlineNeural=1]="OnlineNeural",e[e.OnlineStandard=2]="OnlineStandard",e[e.OfflineNeural=3]="OfflineNeural",e[e.OfflineStandard=4]="OfflineStandard"}(gs||(gs={}));class ws{constructor(e){if(this.privStyleList=[],this.privVoicePath="",e&&(this.privName=e.Name,this.privLocale=e.Locale,this.privShortName=e.ShortName,this.privLocaleName=e.LocaleName,this.privLocalName=e.LocalName,this.privVoiceType=e.VoiceType.endsWith("Standard")?gs.OnlineStandard:gs.OnlineNeural,this.privGender="Male"===e.Gender?vs.Male:"Female"===e.Gender?vs.Female:vs.Unknown,e.StyleList&&Array.isArray(e.StyleList)))for(const t of e.StyleList)this.privStyleList.push(t)}get name(){return this.privName}get locale(){return this.privLocale}get shortName(){return this.privShortName}get localName(){return this.privLocalName}get localeName(){return this.privLocaleName}get gender(){return this.privGender}get voiceType(){return this.privVoiceType}get styleList(){return this.privStyleList}get voicePath(){return this.privVoicePath}}class Rs extends xe{constructor(e,t,i){if(Array.isArray(t)){super(e,ue.VoicesListRetrieved,void 0,new Oe),this.privVoices=[];for(const e of t)this.privVoices.push(new ws(e))}else super(e,ue.Canceled,i||"Error information unavailable",new Oe)}get voices(){return this.privVoices}}var Ps,Is,As,Ts=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class bs{constructor(e,t){const i=e;w.throwIfNull(i,"speechConfig"),null!==t&&(this.audioConfig=void 0===t?"undefined"==typeof window?void 0:mt.fromDefaultSpeakerOutput():t),this.privProperties=i.properties.clone(),this.privDisposed=!1,this.privSynthesizing=!1,this.privConnectionFactory=new Ss,this.synthesisRequestQueue=new Q,this.implCommonSynthesizeSetup()}get authorizationToken(){return this.properties.getProperty(l.SpeechServiceAuthorization_Token)}set authorizationToken(e){w.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(l.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}get autoDetectSourceLanguage(){return this.properties.getProperty(l.SpeechServiceConnection_AutoDetectSourceLanguages)===it}static FromConfig(e,t,i){const r=e;return t.properties.mergeTo(r.properties),new bs(e,i)}buildSsml(e){let t=this.properties.getProperty(l.SpeechServiceConnection_SynthLanguage,"en-US"),i=this.properties.getProperty(l.SpeechServiceConnection_SynthVoice,""),r=bs.XMLEncode(e);return this.autoDetectSourceLanguage?t="en-US":i=i||{"af-ZA":"af-ZA-AdriNeural","am-ET":"am-ET-AmehaNeural","ar-AE":"ar-AE-FatimaNeural","ar-BH":"ar-BH-AliNeural","ar-DZ":"ar-DZ-AminaNeural","ar-EG":"ar-EG-SalmaNeural","ar-IQ":"ar-IQ-BasselNeural","ar-JO":"ar-JO-SanaNeural","ar-KW":"ar-KW-FahedNeural","ar-LY":"ar-LY-ImanNeural","ar-MA":"ar-MA-JamalNeural","ar-QA":"ar-QA-AmalNeural","ar-SA":"ar-SA-HamedNeural","ar-SY":"ar-SY-AmanyNeural","ar-TN":"ar-TN-HediNeural","ar-YE":"ar-YE-MaryamNeural","bg-BG":"bg-BG-BorislavNeural","bn-BD":"bn-BD-NabanitaNeural","bn-IN":"bn-IN-BashkarNeural","ca-ES":"ca-ES-JoanaNeural","cs-CZ":"cs-CZ-AntoninNeural","cy-GB":"cy-GB-AledNeural","da-DK":"da-DK-ChristelNeural","de-AT":"de-AT-IngridNeural","de-CH":"de-CH-JanNeural","de-DE":"de-DE-KatjaNeural","el-GR":"el-GR-AthinaNeural","en-AU":"en-AU-NatashaNeural","en-CA":"en-CA-ClaraNeural","en-GB":"en-GB-LibbyNeural","en-HK":"en-HK-SamNeural","en-IE":"en-IE-ConnorNeural","en-IN":"en-IN-NeerjaNeural","en-KE":"en-KE-AsiliaNeural","en-NG":"en-NG-AbeoNeural","en-NZ":"en-NZ-MitchellNeural","en-PH":"en-PH-JamesNeural","en-SG":"en-SG-LunaNeural","en-TZ":"en-TZ-ElimuNeural","en-US":"en-US-JennyNeural","en-ZA":"en-ZA-LeahNeural","es-AR":"es-AR-ElenaNeural","es-BO":"es-BO-MarceloNeural","es-CL":"es-CL-CatalinaNeural","es-CO":"es-CO-GonzaloNeural","es-CR":"es-CR-JuanNeural","es-CU":"es-CU-BelkysNeural","es-DO":"es-DO-EmilioNeural","es-EC":"es-EC-AndreaNeural","es-ES":"es-ES-AlvaroNeural","es-GQ":"es-GQ-JavierNeural","es-GT":"es-GT-AndresNeural","es-HN":"es-HN-CarlosNeural","es-MX":"es-MX-DaliaNeural","es-NI":"es-NI-FedericoNeural","es-PA":"es-PA-MargaritaNeural","es-PE":"es-PE-AlexNeural","es-PR":"es-PR-KarinaNeural","es-PY":"es-PY-MarioNeural","es-SV":"es-SV-LorenaNeural","es-US":"es-US-AlonsoNeural","es-UY":"es-UY-MateoNeural","es-VE":"es-VE-PaolaNeural","et-EE":"et-EE-AnuNeural","fa-IR":"fa-IR-DilaraNeural","fi-FI":"fi-FI-SelmaNeural","fil-PH":"fil-PH-AngeloNeural","fr-BE":"fr-BE-CharlineNeural","fr-CA":"fr-CA-SylvieNeural","fr-CH":"fr-CH-ArianeNeural","fr-FR":"fr-FR-DeniseNeural","ga-IE":"ga-IE-ColmNeural","gl-ES":"gl-ES-RoiNeural","gu-IN":"gu-IN-DhwaniNeural","he-IL":"he-IL-AvriNeural","hi-IN":"hi-IN-MadhurNeural","hr-HR":"hr-HR-GabrijelaNeural","hu-HU":"hu-HU-NoemiNeural","id-ID":"id-ID-ArdiNeural","is-IS":"is-IS-GudrunNeural","it-IT":"it-IT-IsabellaNeural","ja-JP":"ja-JP-NanamiNeural","jv-ID":"jv-ID-DimasNeural","kk-KZ":"kk-KZ-AigulNeural","km-KH":"km-KH-PisethNeural","kn-IN":"kn-IN-GaganNeural","ko-KR":"ko-KR-SunHiNeural","lo-LA":"lo-LA-ChanthavongNeural","lt-LT":"lt-LT-LeonasNeural","lv-LV":"lv-LV-EveritaNeural","mk-MK":"mk-MK-AleksandarNeural","ml-IN":"ml-IN-MidhunNeural","mr-IN":"mr-IN-AarohiNeural","ms-MY":"ms-MY-OsmanNeural","mt-MT":"mt-MT-GraceNeural","my-MM":"my-MM-NilarNeural","nb-NO":"nb-NO-PernilleNeural","nl-BE":"nl-BE-ArnaudNeural","nl-NL":"nl-NL-ColetteNeural","pl-PL":"pl-PL-AgnieszkaNeural","ps-AF":"ps-AF-GulNawazNeural","pt-BR":"pt-BR-FranciscaNeural","pt-PT":"pt-PT-DuarteNeural","ro-RO":"ro-RO-AlinaNeural","ru-RU":"ru-RU-SvetlanaNeural","si-LK":"si-LK-SameeraNeural","sk-SK":"sk-SK-LukasNeural","sl-SI":"sl-SI-PetraNeural","so-SO":"so-SO-MuuseNeural","sr-RS":"sr-RS-NicholasNeural","su-ID":"su-ID-JajangNeural","sv-SE":"sv-SE-SofieNeural","sw-KE":"sw-KE-RafikiNeural","sw-TZ":"sw-TZ-DaudiNeural","ta-IN":"ta-IN-PallaviNeural","ta-LK":"ta-LK-KumarNeural","ta-SG":"ta-SG-AnbuNeural","te-IN":"te-IN-MohanNeural","th-TH":"th-TH-PremwadeeNeural","tr-TR":"tr-TR-AhmetNeural","uk-UA":"uk-UA-OstapNeural","ur-IN":"ur-IN-GulNeural","ur-PK":"ur-PK-AsadNeural","uz-UZ":"uz-UZ-MadinaNeural","vi-VN":"vi-VN-HoaiMyNeural","zh-CN":"zh-CN-XiaoxiaoNeural","zh-HK":"zh-HK-HiuMaanNeural","zh-TW":"zh-TW-HsiaoChenNeural","zu-ZA":"zu-ZA-ThandoNeural"}[t],i&&(r=`<voice name='${i}'>${r}</voice>`),r=`<speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis' xmlns:mstts='http://www.w3.org/2001/mstts' xmlns:emo='http://www.w3.org/2009/10/emotionml' xml:lang='${t}'>${r}</speak>`,r}speakTextAsync(e,t,i,r){this.speakImpl(e,!1,t,i,r)}speakSsmlAsync(e,t,i,r){this.speakImpl(e,!0,t,i,r)}getVoicesAsync(e=""){return Ts(this,void 0,void 0,(function*(){return this.getVoices(e)}))}close(e,t){w.throwIfDisposed(this.privDisposed),L(this.dispose(!0),e,t)}get internalData(){return this.privAdapter}dispose(e){return Ts(this,void 0,void 0,(function*(){this.privDisposed||(e&&this.privAdapter&&(yield this.privAdapter.dispose()),this.privDisposed=!0)}))}createSynthesizerConfig(e){return new ys(e,this.privProperties)}createSynthesisAdapter(e,t,i,r){return new ot(e,t,r,this,this.audioConfig)}implCommonSynthesizeSetup(){let e="undefined"!=typeof window?"Browser":"Node",t="unknown",i="unknown";"undefined"!=typeof navigator&&(e=e+"/"+navigator.platform,t=navigator.userAgent,i=navigator.appVersion);const r=this.createSynthesizerConfig(new D(new O(new z(e,t,i)))),n=this.privProperties.getProperty(l.SpeechServiceConnection_Key,void 0),s=n&&""!==n?new ni(n):new si((()=>{const e=this.privProperties.getProperty(l.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(e)}),(()=>{const e=this.privProperties.getProperty(l.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(e)}));this.privAdapter=this.createSynthesisAdapter(s,this.privConnectionFactory,this.audioConfig,r),this.privAdapter.audioOutputFormat=Le.fromSpeechSynthesisOutputFormat(de[this.properties.getProperty(l.SpeechServiceConnection_SynthOutputFormat,void 0)]),this.privRestAdapter=new Cs(r,s)}speakImpl(e,t,i,r,n){try{w.throwIfDisposed(this.privDisposed);const s=u();let o;o=n instanceof ut?new Ke(n):n instanceof qe?n:void 0!==n?new ft(n):void 0,this.synthesisRequestQueue.enqueue(new Es(s,e,t,(e=>{if(this.privSynthesizing=!1,i)try{i(e)}catch(e){r&&r(e)}i=void 0,this.adapterSpeak().catch((()=>{}))}),(e=>{r&&r(e)}),o)),this.adapterSpeak().catch((()=>{}))}catch(e){if(r)if(e instanceof Error){const t=e;r(t.name+": "+t.message)}else r(e);this.dispose(!0).catch((()=>{}))}}getVoices(e){return Ts(this,void 0,void 0,(function*(){const t=u(),i=yield this.privRestAdapter.getVoicesList(t);if(i.ok&&Array.isArray(i.json)){let r=i.json;return e&&e.length>0&&(r=r.filter((t=>!!t.Locale&&t.Locale.toLowerCase()===e.toLowerCase()))),new Rs(t,r,void 0)}return new Rs(t,void 0,`Error: ${i.status}: ${i.statusText}`)}))}adapterSpeak(){return Ts(this,void 0,void 0,(function*(){if(!this.privDisposed&&!this.privSynthesizing){this.privSynthesizing=!0;const e=yield this.synthesisRequestQueue.dequeue();return this.privAdapter.Speak(e.text,e.isSSML,e.requestId,e.cb,e.err,e.dataStream)}}))}static XMLEncode(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}}class Es{constructor(e,t,i,r,n,s){this.requestId=e,this.text=t,this.isSSML=i,this.cb=r,this.err=n,this.dataStream=s}}!function(e){e.Word="WordBoundary",e.Punctuation="PunctuationBoundary",e.Sentence="SentenceBoundary"}(Ps||(Ps={})),function(e){e[e.FivePoint=1]="FivePoint",e[e.HundredMark=2]="HundredMark"}(Is||(Is={})),function(e){e[e.Phoneme=1]="Phoneme",e[e.Word=2]="Word",e[e.FullText=3]="FullText"}(As||(As={}));class ks{constructor(e,t=Is.FivePoint,i=As.Phoneme,r=!1){w.throwIfNullOrUndefined(e,"referenceText"),this.privProperties=new Oe,this.privProperties.setProperty(l.PronunciationAssessment_ReferenceText,e),this.privProperties.setProperty(l.PronunciationAssessment_GradingSystem,Is[t]),this.privProperties.setProperty(l.PronunciationAssessment_Granularity,As[i]),this.privProperties.setProperty(l.PronunciationAssessment_EnableMiscue,String(r))}static fromJSON(e){w.throwIfNullOrUndefined(e,"json");const t=new ks("");return t.privProperties=new Oe,t.properties.setProperty(l.PronunciationAssessment_Json,e),t}toJSON(){return this.updateJson(),this.privProperties.getProperty(l.PronunciationAssessment_Params)}applyTo(e){this.updateJson(),e.internalData.speechContext.setPronunciationAssessmentParams(this.properties.getProperty(l.PronunciationAssessment_Params))}get referenceText(){return this.properties.getProperty(l.PronunciationAssessment_ReferenceText)}set referenceText(e){w.throwIfNullOrWhitespace(e,"referenceText"),this.properties.setProperty(l.PronunciationAssessment_ReferenceText,e)}set phonemeAlphabet(e){w.throwIfNullOrWhitespace(e,"phonemeAlphabet"),this.privPhonemeAlphabet=e}set enableMiscue(e){const t=e?"true":"false";this.properties.setProperty(l.PronunciationAssessment_EnableMiscue,t)}get enableMiscue(){return"true"===this.properties.getProperty(l.PronunciationAssessment_EnableMiscue,"false").toLowerCase()}set nbestPhonemeCount(e){this.privNBestPhonemeCount=e}get properties(){return this.privProperties}updateJson(){const e=this.privProperties.getProperty(l.PronunciationAssessment_Json,"{}"),t=JSON.parse(e),i=this.privProperties.getProperty(l.PronunciationAssessment_ReferenceText);i&&(t.referenceText=i);const r=this.privProperties.getProperty(l.PronunciationAssessment_GradingSystem);r&&(t.gradingSystem=r);const n=this.privProperties.getProperty(l.PronunciationAssessment_Granularity);n&&(t.granularity=n),this.privPhonemeAlphabet&&(t.phonemeAlphabet=this.privPhonemeAlphabet),this.privNBestPhonemeCount&&(t.nbestPhonemeCount=this.privNBestPhonemeCount),t.dimension="Comprehensive",t.enableMiscue=this.enableMiscue,this.privProperties.setProperty(l.PronunciationAssessment_Params,JSON.stringify(t))}}class xs{constructor(e){const t=JSON.parse(e);w.throwIfNullOrUndefined(t.NBest[0],"NBest"),this.privPronJson=t.NBest[0]}static fromResult(e){w.throwIfNullOrUndefined(e,"result");const t=e.properties.getProperty(l.SpeechServiceResponse_JsonResult);return w.throwIfNullOrUndefined(t,"json"),new xs(t)}get detailResult(){return this.privPronJson}get accuracyScore(){return this.detailResult.PronunciationAssessment.AccuracyScore}get pronunciationScore(){return this.detailResult.PronunciationAssessment.PronScore}get completenessScore(){return this.detailResult.PronunciationAssessment.CompletenessScore}get fluencyScore(){return this.detailResult.PronunciationAssessment.FluencyScore}}class Ds{static SetLoggingLevel(e){this.privListener=new R(e),b.instance.attachConsoleListener(this.privListener)}static StartConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!0)}static StopConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!1)}static SetLogOutputPath(e){if("undefined"!=typeof window)throw new Error("File system logging not available in browser.");this.privListener&&(this.privListener.logPath=e)}}Ds.privListener=void 0,b.instance.attachConsoleListener(new R)},112:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.models=void 0,t.models=[{name:"gpt-3.5-turbo",id:"openai/gpt-3.5-turbo"},{name:"gpt-3.5-turbo-16k",id:"openai/gpt-3.5-turbo-16k"},{name:"gpt-4",id:"openai/gpt-4"},{name:"gpt-4-32k",id:"openai/gpt-4-32k"},{name:"claude-2",id:"anthropic/claude-2"},{name:"claude-instant-v1",id:"anthropic/claude-instant-v1"},{name:"PaLM 2 Bison",id:"google/palm-2-chat-bison"},{name:"Llama v2 13B Chat (beta)",id:"meta-llama/llama-2-13b-chat"}]},2569:function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getSettings=void 0;const s=n(i(3150)),o=i(112);t.getSettings=function(){return r(this,void 0,void 0,(function*(){return yield s.default.storage.sync.get({openApiKey:"",openApiEndpoint:"https://api.openai.com",unsplashApiKey:"",currentLanguage:"",targetLanguage:"",ankiDeckName:"",licenseKey:"",model:o.models[0].id,apiKeySelection:"myOwnOpenAiKey",newLicenseKey:""})}))}},4985:function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(i(3150)),o=i(7574),a=i(9882),c=i(199),p=i(2569),h=i(9882),u=i(9882);let d;try{(0,u.getUserInfo)().then((e=>{d=e.userId}))}catch(e){console.log(e)}let l,v=new AbortController;s.default.runtime.onInstalled.addListener((function(){})),s.default.runtime.setUninstallURL("https://docs.google.com/forms/d/e/1FAIpQLSdobGQN3O0Ck4fVrgfvRZMme3de-2OaEp1pFtibZkU0koc37w/viewform?usp=sf_link"),s.default.contextMenus.create({id:"2",title:"Run last prompt",contexts:["selection"]},(()=>{s.default.runtime.lastError})),s.default.contextMenus.create({id:"1",title:"Open",contexts:["selection"]},(()=>{s.default.runtime.lastError})),s.default.contextMenus.onClicked.addListener((function(e,t){return r(this,void 0,void 0,(function*(){const t="2"===e.menuItemId;g(t)}))})),s.default.commands.onCommand.addListener((function(e){"RunLastPrompt"===e&&g(),"Open"===e&&g(!1)})),s.default.runtime.onConnect.addListener((e=>{"fromPopupCard"===e.name&&(l=e),e.onMessage.addListener((t=>r(void 0,void 0,void 0,(function*(){console.log("接收消息：",t),"StopTheConversation"===t.type&&v.abort(),"getGPTMsg"===t.type&&(0,p.getSettings)().then((i=>{v=new AbortController;let n=t.messages;(0,u.getAIParameter)().then((t=>{var i;const s=null===(i=t.data)||void 0===i?void 0:i.chatCompletions.url;if(t.data&&void 0!==s){let i=t.data.chatCompletions.body;i.messages=n,fetch(s,{signal:v.signal,method:"POST",body:JSON.stringify(i),headers:t.data.chatCompletions.headers}).then((t=>r(void 0,void 0,void 0,(function*(){var i;e.postMessage({type:"sendGPTData",status:"begin",content:""}),200!==t.status&&t.json().then((t=>{e.postMessage({type:"sendGPTData",status:"erro",content:"🥲 "+t.error.message,code:t.error.code})}));const r=(0,o.createParser)((t=>{if("event"===t.type)try{"[DONE]"!==t.data&&void 0!==JSON.parse(t.data).choices[0].delta.content&&e.postMessage({type:"sendGPTData",status:"process",content:JSON.parse(t.data).choices[0].delta.content,chatId:JSON.parse(t.data).id})}catch(e){console.log(" createParser JSON.parse errow")}})),n=null===(i=t.body)||void 0===i?void 0:i.getReader();if(void 0!==n){try{for(;;){const{done:t,value:i}=yield n.read();if(t){console.log("Done"),e.postMessage({type:"sendGPTData",status:"end",content:""});break}const s=(new TextDecoder).decode(i);r.feed(s)}}finally{n.releaseLock()}r.reset()}})))).catch((t=>{if(console.log("error"),console.log(t),t.message.indexOf("aborted")>=0);else{const i=t.message.indexOf("Failed to fetch")>=0?"🥲An error occurred. It might be an **API endpoint error**("+s+"). Please modify and try again.":"🥲An error occurred.";e.postMessage({type:"sendGPTData",status:"erro",content:i+"("+t.message+")",code:t.message})}}))}else e.postMessage({type:"sendGPTData",status:"erro",code:"invalid_api_key",content:"🥲 API Key error. Please modify and try again.."})}))})),"UPDATE_POPUP_CARD"===t.type&&l.postMessage(t)}))))})),s.default.runtime.onMessage.addListener((function(e,t,i){console.log("Message from the content script: "+e.type);const n=e=>r(this,void 0,void 0,(function*(){try{yield i(e)}catch(e){console.error(e)}}));if("getUnsplashImages"===e.type)return console.log("background getUnsplashImages:"),e.keyWord&&(0,a.unsplashSearchPhotos)("t8eOwEDwJEGJe7mYWDleFDBK_EM0SaF1hK_4KYfcD_8",e.keyWord).then((e=>{n({type:"sendImgData",status:"end",imgs:e})})).catch((e=>{console.log(e)})),!0;if("addNote"===e.type){console.log("addNote");const t=(0,c.createApi)({accessKey:"t8eOwEDwJEGJe7mYWDleFDBK_EM0SaF1hK_4KYfcD_8"});return void 0!==e.messages.unsplash_download_location&&""!==e.messages.unsplash_download_location&&t.photos.trackDownload({downloadLocation:e.messages.unsplash_download_location}).then((e=>console.log(e))),(0,a.ankiAction)(e.messages.anki_action_type,6,e.messages.anki_arguments).then((e=>{n({type:"addToAnki",result:"success",data:e.result,error:e.error})})).catch((e=>{console.error(e),n({type:"addToAnki",result:"failure",error:e.error})})),!0}if("setModel"===e.type)return e.messages.isAnkiSpace,(0,a.getDefaultDeckName)().then((e=>r(this,void 0,void 0,(function*(){let t=e.defaultDeckName;""!==t&&void 0!==t||(t="Default");try{const i=yield(0,a.ankiAction)("modelNames",6);if(console.log("modelNames:"),console.log(i),!i.error){let r=[],s=[{modelName:"Scouter",cardTemplates:[{name:"Card1",Front:"{{Front}}",Back:"{{Front}}\n                  <hr id=answer>\n                  {{Back}}"}],inOrderFields:["Front","Back"],isAnkiSpace:!1},{modelName:"Scouter Cloze Text",cardTemplates:[{name:"Card2",Front:"{{cloze:Text}}",Back:"{{cloze:Text}}\n                            <br>{{More}}"}],inOrderFields:["Text","More"],isAnkiSpace:!0}].map((e=>new Promise(((n,s)=>{i.result.includes(e.modelName)?(0,a.ankiAction)("modelFieldNames",6,{modelName:e.modelName}).then((i=>{i.result.length<2?r.push({defaultDeckName:t,modelName:e.modelName,field1:i.result[0],field2:null,isAnkiSpace:e.isAnkiSpace}):r.push({defaultDeckName:t,modelName:e.modelName,field1:i.result[0],field2:i.result[1],isAnkiSpace:e.isAnkiSpace}),n()})):(0,a.ankiAction)("createModel",6,{modelName:e.modelName,inOrderFields:e.inOrderFields,cardTemplates:e.cardTemplates,isCloze:e.isAnkiSpace,css:h.cardStyle}).then((i=>{i.error||r.push({defaultDeckName:t,modelName:e.modelName,field1:i.result.flds[0].name,field2:i.result.flds[1].name,isAnkiSpace:e.isAnkiSpace}),n()}))}))));Promise.all(s).then((()=>{console.log(r),n({type:"setModel",result:"success",data:r,error:e.error})})).catch((e=>{console.error("Error:",e)}))}}catch(e){n({type:"setModel",result:"failure",error:e})}})))),!0;if("guiEditNote"===e.type)return(0,a.ankiAction)(e.messages.anki_action_type,6,e.messages.anki_arguments).then((e=>{n({type:"guiEditNote",result:"success",data:e.result,error:e.error})})).catch((e=>{console.error(e),n({type:"guiEditNote",result:"failure",error:e.error})})),!0;if("ankiAction"===e.type)return(0,a.ankiAction)(e.messages.anki_action_type,6,e.messages.anki_arguments).then((e=>{n(e)})).catch((e=>{n(e)})),!0;if("amplitudeTrack"===e.type&&fetch("https://api.amplitude.com/2/httpapi",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:"ed720e33b4190ef29a0718a040bbb55a",events:[{user_id:d,event_type:e.name}]})}).then((e=>e.json())).then((e=>console.log(e))).catch((e=>{console.error("Error:",e)})),"getUserStatus"===e.type&&(0,p.getSettings)().then((e=>{const t=e.licenseKey,i=(0,u.getBalance)(t);return n(i),console.log(i),!0})),"generationsImages"===e.type){const t=(0,u.generationsImages)(e.data.prompt);return n(t),!0}"UPDATE_POPUP_CARD"===e.type&&(console.log("sendMessage"),l.postMessage(e))}));const g=e=>{let t=e;void 0===t&&(t=!0),s.default.tabs.query({active:!0,currentWindow:!0}).then((e=>{var i;const r=e[0];let n=null!==(i=r.id)&&void 0!==i?i:-1;r&&void 0!==r.id&&s.default.tabs.sendMessage(n,{type:"open-scouter",runPrompt:t})}))}},1214:function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.fetchcurrentLanguage=t.languageCodes=t.lang=void 0;const s=n(i(3150));t.lang={Arabic:{name:"العربية",id:"Arabic",Prompt1:{explanation:"استخدام اللغة العربية لتفسير معنى الكلمات ودورها النحوي في الجملة"},Prompt2:{translate:"ترجمة الجمل إلى العربية",explanation:"شرح المعرفة النحوية"},Prompt3:{validation:"بوصفك خبيرًا في اللغة، يرجى التحقق من الجمل التي قدمتها. إذا كانت الجملة غير صحيحة، فأشر على الخطأ باللغة العربية وقدم الجملة المصححة. الجملة:"},audioURL:"https://dict.youdao.com/dictvoice?le=ar&type=0&audio="},"Chinese Simplified":{name:"简体中文",id:"Chinese Simplified",Prompt1:{explanation:"使用中文解释单词在句子中的含义和语法作用"},Prompt2:{translate:"将句子翻译为中文",explanation:"解释语法知识"},Prompt3:{validation:"作为一个语言专家，请检查我提供的句子。如果句子不正确，那么用中文指出错误，并提供修改后的句子。句子："},audioURL:"https://dict.youdao.com/dictvoice?le=zh&type=0&audio="},"Chinese Traditional":{name:"繁體中文",id:"Chinese Traditional",Prompt1:{explanation:"使用繁體中文解釋單詞在句子中的含義和語法作用"},Prompt2:{translate:"將句子翻譯為繁體中文",explanation:"解釋語法知識"},Prompt3:{validation:"作為一個語言專家，請檢查我提供的句子。如果句子不正確，那麼用繁體中文指出錯誤，並提供修改後的句子。句子："},audioURL:"https://dict.youdao.com/dictvoice?le=zh&type=0&audio="},Dutch:{name:"Nederlands",id:"Dutch",Prompt1:{explanation:"Gebruik het Nederlands om de betekenis van woorden en hun grammaticale rol in de zin uit te leggen"},Prompt2:{translate:"Vertaal de zin naar het Nederlands",explanation:"Leg de grammaticale kennis uit"},Prompt3:{validation:"Als taalexpert, controleer de zin die ik heb gegeven. Als de zin onjuist is, wijs dan de fout aan in het Nederlands en geef de gecorrigeerde zin. Zin:"},audioURL:"https://dict.youdao.com/dictvoice?le=nl&type=0&audio="},English:{name:"English",id:"English",Prompt1:{explanation:"Use English to explain the meaning and grammatical role of words in sentences"},Prompt2:{translate:"Translate sentences into English",explanation:"Explain grammatical knowledge"},Prompt3:{validation:"As a language expert, please check the sentences I provided. If the sentence is incorrect, then point out the error in English and provide the corrected sentence. Sentence:"},audioURL:"https://dict.youdao.com/dictvoice?type=0&audio="},French:{name:"Français",id:"French",Prompt1:{explanation:"Utilisez le français pour expliquer la signification des mots et leur rôle grammatical dans la phrase"},Prompt2:{translate:"Traduisez la phrase en français",explanation:"Expliquez les connaissances grammaticales"},Prompt3:{validation:"En tant qu'expert en langues, veuillez vérifier la phrase que j'ai fournie. Si la phrase est incorrecte, veuillez indiquer l'erreur en français et fournir la phrase corrigée.La phrase: "},audioURL:"https://dict.youdao.com/dictvoice?le=fr&type=0&audio="},German:{name:"Deutsch",id:"German",Prompt1:{explanation:"Verwenden Sie Deutsch, um die Bedeutung von Wörtern und ihre grammatikalische Rolle im Satz zu erklären"},Prompt2:{translate:"Übersetzen Sie den Satz ins Deutsche",explanation:"Erklären Sie grammatikalische Kenntnisse"},Prompt3:{validation:"Als Sprachexperte überprüfen Sie bitte den von mir bereitgestellten Satz. Wenn der Satz falsch ist, geben Sie bitte den Fehler auf Deutsch an und geben Sie den korrigierten Satz an. Der Satz:"},audioURL:"https://dict.youdao.com/dictvoice?le=de&type=0&audio="},Hindi:{name:"हिन्दी",id:"Hindi",Prompt1:{explanation:"शब्दों के अर्थ और वाक्य में उनकी व्याकरणिक भूमिका का विवरण देने के लिए हिंदी का उपयोग करें"},Prompt2:{translate:"वाक्य का हिंदी में अनुवाद करें",explanation:"व्याकरण ज्ञान का विवरण दें"},Prompt3:{validation:"भाषा विशेषज्ञ के रूप में, कृपया मैंने पेश किए गए वाक्यों की जांच करें। यदि वाक्य गलत है, तो कृपया हिंदी में त्रुटि बताएं और सही किए गए वाक्य प्रदान करें। वाक्य:"},audioURL:"https://dict.youdao.com/dictvoice?le=hi&type=0&audio="},Indonesian:{name:"Bahasa Indonesia",id:"Indonesian",Prompt1:{explanation:"Menggunakan bahasa Indonesia untuk menjelaskan makna kata dan peran gramatikalnya dalam kalimat"},Prompt2:{translate:"Menerjemahkan kalimat ke dalam bahasa Indonesia",explanation:"Menjelaskan pengetahuan tata bahasa"},Prompt3:{validation:"Sebagai ahli bahasa, mohon periksa kalimat yang saya berikan. Jika kalimat tidak benar, tolong tunjukkan kesalahannya dalam bahasa Indonesia dan berikan kalimat yang benar. Kalimat:"},audioURL:"https://dict.youdao.com/dictvoice?le=id&type=0&audio="},Italian:{name:"Italiano",id:"Italian",Prompt1:{explanation:"Usa l'italiano per spiegare il significato delle parole e il loro ruolo grammaticale nella frase"},Prompt2:{translate:"Tradurre la frase in italiano",explanation:"Spiegazione della conoscenza grammaticale"},Prompt3:{validation:"In quanto esperto di lingua, controlla la frase che ho fornito. Se la frase non è corretta, indica l'errore in italiano e fornisci la frase corretta. Frase:"},audioURL:"https://dict.youdao.com/dictvoice?le=it&type=0&audio="},Japanese:{name:"日本語",id:"Japanese",Prompt1:{explanation:"単語の意味と文法上の役割を説明するために日本語を使用する"},Prompt2:{translate:"文を日本語に翻訳する",explanation:"文法的な知識の説明"},Prompt3:{validation:"言語の専門家として、提供された文章を確認してください。文章が正しくない場合は、日本語でエラーを指摘し、修正後の文章を提供してください。文章："},audioURL:"https://dict.youdao.com/dictvoice?le=jap&type=0&audio="},Korean:{name:"한국어",id:"Korean",Prompt1:{explanation:"단어의 의미와 문장에서의 문법적 역할을 설명하기 위해 한국어를 사용합니다."},Prompt2:{translate:"문장을 한국어로 번역하세요.",explanation:"문법 지식 설명"},Prompt3:{validation:"언어 전문가로서 제시한 문장을 확인해 주세요. 만약 문장이 틀렸다면, 한국어로 오류를 지적하고 수정된 문장을 제시해 주세요. 문장: "},audioURL:"https://dict.youdao.com/dictvoice?le=ko&type=0&audio="},Portuguese:{name:"Português",id:"Portuguese",Prompt1:{explanation:"Usar o português para explicar o significado das palavras e o papel gramatical delas na frase"},Prompt2:{translate:"Traduza a frase para o português",explanation:"Explicação do conhecimento gramatical"},Prompt3:{validation:"Como especialista em linguagem, verifique a frase que eu forneci. Se a frase estiver incorreta, indique o erro em português e forneça a frase corrigida. Frase: "},audioURL:"https://dict.youdao.com/dictvoice?le=pt&type=0&audio="},Russian:{name:"Русский",id:"Russian",Prompt1:{explanation:"Используйте русский язык, чтобы объяснить значение слов и их грамматическую роль в предложении"},Prompt2:{translate:"Перевести предложение на русский язык",explanation:"Объяснение грамматических знаний"},Prompt3:{validation:"В качестве эксперта по языку, пожалуйста, проверьте предложение, которое я представил. Если предложение неверное, то пожалуйста, указывайте ошибку на русском языке и предоставляйте исправленное предложение. Предложение:"},audioURL:"https://dict.youdao.com/dictvoice?le=ru&type=0&audio="},Spanish:{name:"Español",id:"Spanish",Prompt1:{explanation:"Utilice el español para explicar el significado de las palabras y su función gramatical en la oración"},Prompt2:{translate:"Traducir la oración al español",explanation:"Explicación de conocimientos gramaticales"},Prompt3:{validation:"Como experto en idiomas, por favor, compruebe la oración que he proporcionado. Si la oración es incorrecta, por favor, indique el error en español y proporcione la oración corregida. Oración:"},audioURL:"https://dict.youdao.com/dictvoice?le=es&type=0&audio="},Turkish:{name:"Türkçe",id:"Turkish",Prompt1:{explanation:"Kelimelerin anlamını ve cümledeki dilbilgisel rolünü açıklamak için Türkçeyi kullanın"},Prompt2:{translate:"Cümleyi Türkçeye çevirin",explanation:"Dilbilgisi bilgisi açıklaması"},Prompt3:{validation:"Dil uzmanı olarak, lütfen sunduğum cümleyi kontrol edin. Eğer cümle yanlışsa, lütfen hatayı Türkçe olarak belirtin ve düzeltilmiş cümleyi sağlayın. Cümle:"},audioURL:"https://dict.youdao.com/dictvoice?le=tr&type=0&audio="}},t.languageCodes={Arabic:"ar-AE-FatimaNeural","Chinese Simplified":"zh-CN-XiaoxiaoNeural","Chinese Traditional":"zh-TW-HsiaoChenNeural",Dutch:"nl-NL-ColetteNeural",English:"en-US-AriaNeural",French:"fr-FR-DeniseNeural",German:"de-DE-KatjaNeural",Hindi:"hi-IN-MadhurNeural",Indonesian:"id-ID-ArdiNeural",Italian:"it-IT-ElsaNeural",Japanese:"ja-JP-NanamiNeural",Korean:"ko-KR-SunHiNeural",Portuguese:"pt-BR-FranciscaNeural",Russian:"ru-RU-SvetlanaNeural",Spanish:"es-ES-ElviraNeural",Turkish:"tr-TR-AhmetNeural"},t.fetchcurrentLanguage=()=>r(void 0,void 0,void 0,(function*(){let e=null;return yield s.default.storage.sync.get({currentLanguage:"中文",targetLanguage:"English"}).then((i=>{let r=t.lang["Chinese Simplified"],n=t.lang.English;r=o(i.currentLanguage),n=o(i.targetLanguage),e={current:r,target:n}})),e}));const o=e=>{switch(e){case"Arabic":return t.lang.Arabic;case"Chinese Simplified":default:return t.lang["Chinese Simplified"];case"Chinese Traditional":return t.lang["Chinese Traditional"];case"Dutch":return t.lang.Dutch;case"English":return t.lang.English;case"French":return t.lang.French;case"German":return t.lang.German;case"Hindi":return t.lang.Hindi;case"Indonesian":return t.lang.Indonesian;case"Italian":return t.lang.Italian;case"Japanese":return t.lang.Japanese;case"Korean":return t.lang.Korean;case"Portuguese":return t.lang.Portuguese;case"Russian":return t.lang.Russian;case"Spanish":return t.lang.Spanish;case"Turkish":return t.lang.Turkish}}},9882:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&r(t,e,i);return n(t,e),t},o=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.cardStyle=t.getUserInfo=t.getBalance=t.playTextToSpeech=t.getDefaultDeckName=t.getAIParameter=t.generationsImages=t.unsplashSearchPhotos=t.ankiAction=void 0;const c=a(i(3150)),p=i(199),h=s(i(5047)),u=i(7429),d=i(2569),l=i(1214);function v(e,t,i={}){return new Promise(((r,n)=>{fetch("http://127.0.0.1:8765",{method:"POST",body:JSON.stringify({action:e,version:t,params:i})}).then((e=>e.json())).then((e=>{r(e)})).catch((e=>{console.log("util"),n({result:[],error:"Please open the Anki client and install the Anki-Connect plugin before trying again."})}))}))}function g(){return new Promise(((e,t)=>{(0,d.getSettings)().then((t=>{const i=t.apiKeySelection,r=t.licenseKey;let n=t.openApiKey;t.currentLanguage,t.targetLanguage;const s=t.model;let o=t.openApiEndpoint;n.length<5&&r.length<5&&e({result:"failure",apiKeySelection:i,data:null}),o.length<5&&(o="https://api.openai.com");let a,c={},p="";"licenseKey"===i?(o="https://openrouter.ai/api/v1/chat/completions",p="https://openrouter.ai/api/v1/images/generations",n=r,c={Authorization:"Bearer "+n,"Content-Type":"application/json","HTTP-Referer":"https://notes.dabing.one/","X-Title":"Scouter"},a={model:s,messages:[],temperature:.7,max_tokens:420,top_p:1,frequency_penalty:0,presence_penalty:2,stream:!0}):o.indexOf("azure.com")>-1?(p=o.split("/openai/")[0]+"/openai/images/generations:submit?api-version=2023-06-01-preview",c={"api-key":n,"Content-Type":"application/json"},a={model:"gpt-35-turbo",messages:[],temperature:.7,max_tokens:420,top_p:1,frequency_penalty:0,presence_penalty:2,stream:!0}):(c={Authorization:"Bearer "+n,"Content-Type":"application/json"},"/"===o.slice(-1)&&(o=o.slice(0,-1)),p=o+"/v1/images/generations",o+="/v1/chat/completions",a={model:"gpt-3.5-turbo",messages:[],temperature:.7,max_tokens:420,top_p:1,frequency_penalty:0,presence_penalty:2,stream:!0}),e({result:"success",apiKeySelection:i,data:{chatCompletions:{url:o,headers:c,body:a},imagesGenerations:{url:p,headers:c}}})}))}))}t.ankiAction=v,t.unsplashSearchPhotos=function(e,t){return new Promise(((i,r)=>{(0,p.createApi)({accessKey:e}).search.getPhotos({query:t}).then((e=>{var t,r;0===(null===(t=e.response)||void 0===t?void 0:t.results.length)?i([]):i(null===(r=e.response)||void 0===r?void 0:r.results)})).catch((e=>{r(e)}))}))},t.generationsImages=function(e){return console.log("generationsImages"),new Promise(((t,i)=>{g().then((i=>{var r;const n=null===(r=i.data)||void 0===r?void 0:r.imagesGenerations.url;if(i.data&&void 0!==n){("licenseKey"===i.apiKeySelection||(null==n?void 0:n.indexOf("api.aiproxy"))>=0)&&t({succeeded:!1,data:[]});const r={prompt:e,n:2,size:"512x512"},s=i.data.imagesGenerations.headers;fetch(n,{method:"POST",body:JSON.stringify(r),headers:s}).then((e=>o(this,void 0,void 0,(function*(){e.json().then((e=>{if("notRunning"===e.status){const i=n.split("/openai/")[0]+"/openai/operations/images/"+e.id+"?api-version=2023-06-01-preview",r=setInterval((()=>{fetch(i,{method:"GET",headers:s}).then((e=>e.json())).then((e=>{"succeeded"===e.status&&(t({succeeded:!0,data:e.result}),clearInterval(r))}))}),1e3)}else t({succeeded:!0,data:e})}))})))).catch((e=>{console.log(e)}))}}))}))},t.getAIParameter=g,t.getDefaultDeckName=function(){return new Promise(((e,t)=>{let i="";c.default.storage.sync.get(["ankiDeckName"]).then((t=>o(this,void 0,void 0,(function*(){i=t.ankiDeckName?t.ankiDeckName:yield v("deckNames",6).then((e=>e.result[0])).catch((e=>"")),e({defaultDeckName:i})}))))}))},t.playTextToSpeech=(e,t,i)=>{if(navigator.userAgent.indexOf("Firefox")>=0){const t=l.lang[i].audioURL;let r=new Audio(t+e);r.addEventListener("loadeddata",(e=>{r.play()}))}else{const i=h.AudioConfig.fromDefaultSpeakerOutput(),r=h.SpeechConfig.fromSubscription("51675ff213a64c3896bc95141c6c54dd","eastus");r.speechSynthesisVoiceName=t,r.speechSynthesisOutputFormat=h.SpeechSynthesisOutputFormat.Audio16Khz128KBitRateMonoMp3;const n=new h.SpeechSynthesizer(r,i);n.speakTextAsync(e,(function(e){e.reason===h.ResultReason.SynthesizingAudioCompleted||console.error("Speech synthesis canceled, "+e.errorDetails+"\nDid you set the speech resource key and region values?"),n.close()}),(function(e){n.close()}))}},t.getBalance=e=>new Promise(((t,i)=>{fetch("https://openrouter.ai/api/v1/auth/key",{headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"}}).then((e=>{e.json().then((e=>{t(e)}))}))})),t.getUserInfo=()=>new Promise(((e,t)=>{c.default.storage.sync.get(["userId","newLicenseKey"]).then((i=>o(void 0,void 0,void 0,(function*(){c.default.runtime.lastError&&t(chrome.runtime.lastError);let r,n=!1;if(i.newLicenseKey){const e="https://6r4atckmdr.us.aircode.run/index",t={Authorization:"Bearer "+i.newLicenseKey,"Content-Type":"application/json"};yield fetch(e,{headers:t}).then((e=>o(void 0,void 0,void 0,(function*(){yield e.json().then((e=>{n=e.verified}))}))))}i.userId?r=i.userId:(r=(0,u.v4)(),c.default.storage.sync.set({userId:r}).then((()=>{chrome.runtime.lastError&&t(c.default.runtime.lastError)}))),e({userId:r,verified:n})}))))})),t.cardStyle="\n\n  .card {\n    font-family: arial;\n    font-size: 18px;\n    color: rgb(0 0 0 / 84%);\n    background-color: white;\n    text-align: left;\n    line-height: 1.6;\n  }\n\n  blockquote {\n    border-left: 5px solid #ccc;\n    padding: 8px 16px;\n    margin-left:0;\n    margin-right:0;\n\t\tbackground-color: rgb(0 0 0 / 4%);\n  }\n\n  a {\n    text-decoration: underline;\n  }\n\n  img {\n    max-height: 320px;\n  }\n\n  .ankiSpace {\n    color:#F08A24;\n  }\n\n  .keyWord {\n    color:#F08A24;\n  }\n\n  table {\n    border: 1px solid #ccc;\n    border-collapse: collapse;\n    margin:0;\n    padding:0;\n    width: 100%;\n  }\n\n  table tr {\n    border: 1px solid #ddd;\n    padding: 5px;\n  }\n\n  table th, table td {\n    padding: 10px;\n    text-align: left;\n  }\n\n  table th {\n    letter-spacing: 1px;\n    text-transform: uppercase;\n  }"},199:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Language:()=>u,OrderBy:()=>d,_internals:()=>re,createApi:()=>ne});var r=i(7811);function n(){return n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},n.apply(this,arguments)}function s(e,t){if(null==e)return{};var i,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)i=s[r],t.indexOf(i)>=0||(n[i]=e[i]);return n}var o=c((function(e){return"string"==typeof e?e:null})),a=function(e){return null!=e};function c(e){return function(t){return a(e(t))}}var p=function(e){return Object.keys(e).reduce((function(t,i){var r,s=e[i];return n({},t,a(s)?((r={})[i]=s,r):{})}),{})};function h(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var r=t.length-1;return function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];for(var s=t[0].apply(this,i),o=1;o<=r;o++)s=t[o].call(this,s);return s}}var u,d,l=c((function(e){return a(e)&&"object"==typeof e&&!Array.isArray(e)?e:null})),v=c((function(e){return Array.isArray(e)&&e.every(o)&&e.length>0?e:null})),g=c((function(e){return l(e)&&"errors"in e&&v(e.errors)?{errors:e.errors}:null})),f=function(e){this.message=e},m=function(e){if(function(e){var t=e.headers.get("content-type");return a(t)&&"application/json"===(0,r.Q)(t).type}(e))return e.json().catch((function(e){throw new f("unable to parse JSON response.")}));throw new f("expected JSON response from server.")},S=function(){return function(e){var t=e.response;return m(t)}},y=function(e){return function(t,i){void 0===i&&(i={});var r=e(t),o=r.headers,a=r.query;return n({},s(r,["headers","query"]),i,{query:a,headers:n({},o,i.headers)})}},C=function(e){return e},w=function(e){var t=e.accessKey,i=e.apiVersion,r=void 0===i?"v1":i,o=e.apiUrl,c=void 0===o?"https://api.unsplash.com":o,p=e.headers,u=e.fetch,d=s(e,["accessKey","apiVersion","apiUrl","headers","fetch"]);return function(e){var i=e.handleResponse;return h(e.handleRequest,(function(e){var s=e.pathname,o=e.query,h=e.method,l=void 0===h?"GET":h,v=e.headers,S=e.body,y=e.signal,C=function(e){var t=e.pathname,i=e.query;return function(e){var r=new URL(e);return function(e){return function(t){"/"===t.pathname?t.pathname=e:t.pathname+=e}}(t)(r),function(e){return function(t){Object.keys(e).forEach((function(i){return t.searchParams.set(i,e[i].toString())}))}}(i)(r),r.toString()}}({pathname:s,query:o})(c),w=n({method:l,headers:n({},p,v,{"Accept-Version":r},a(t)?{Authorization:"Client-ID "+t}:{}),body:S,signal:y},d);return(null!=u?u:fetch)(C,w).then(function(e){return function(t){return(t.ok?e({response:t}).then((function(e){return{type:"success",status:t.status,response:e,originalResponse:t}})):m(t).then((function(e){return n({type:"error",status:t.status},function(e){return g(e)?{errors:e.errors,source:"api"}:{errors:["Responded with a status code outside the 2xx range, and the response body is not recognisable."],source:"decoding"}}(e),{originalResponse:t})}))).catch((function(e){if(e instanceof f)return{type:"error",source:"decoding",status:t.status,originalResponse:t,errors:[e.message]};throw e}))}}(i))}))}},R="x-total",P=function(e){var t=e.headers.get(R);if(a(t)){var i=parseInt(t);if(Number.isInteger(i))return i;throw new f("expected "+R+" header to be valid integer.")}throw new f("expected "+R+" header to exist.")},I=function(){return function(e){var t=e.response;return S()({response:t}).then((function(e){return{results:e,total:P(t)}}))}},A=function(e){return a(e)?{collections:e.join()}:{}},T=function(e){return a(e)?{topics:e.join()}:{}},b=function(e){var t=e.page,i=e.perPage,r=e.orderBy;return p({per_page:i,order_by:r,page:t})},E="/collections",k=function(){var e=function(e){var t=e.collectionId;return E+"/"+t+"/photos"};return{getPathname:e,handleRequest:y((function(t){var i=t.collectionId,r=t.orientation,o=s(t,["collectionId","orientation"]);return{pathname:e({collectionId:i}),query:p(n({},b(o),{orientation:r}))}})),handleResponse:I()}}(),x=function(){var e=function(e){var t=e.collectionId;return E+"/"+t};return{getPathname:e,handleRequest:y((function(t){var i=t.collectionId;return{pathname:e({collectionId:i}),query:{}}})),handleResponse:S()}}(),D=function(){var e=function(){return E};return{getPathname:e,handleRequest:y((function(t){return void 0===t&&(t={}),{pathname:e(),query:b(t)}})),handleResponse:I()}}(),O=function(){var e=function(e){var t=e.collectionId;return E+"/"+t+"/related"};return{getPathname:e,handleRequest:y((function(t){var i=t.collectionId;return{pathname:e({collectionId:i}),query:{}}})),handleResponse:S()}}(),N={__proto__:null,getPhotos:k,get:x,list:D,getRelated:O},z="/photos",M=function(){return{getPathname:function(e){return z},handleRequest:y((function(e){return void 0===e&&(e={}),{pathname:z,query:p(b(e))}})),handleResponse:I()}}(),L=function(){var e=function(e){var t=e.photoId;return z+"/"+t};return{getPathname:e,handleRequest:y((function(t){var i=t.photoId;return{pathname:e({photoId:i}),query:{}}})),handleResponse:S()}}(),_=function(){var e=function(e){var t=e.photoId;return z+"/"+t+"/statistics"};return{getPathname:e,handleRequest:y((function(t){var i=t.photoId;return{pathname:e({photoId:i}),query:{}}})),handleResponse:S()}}(),B=function(){var e=function(){return z+"/random"};return{getPathname:e,handleRequest:y((function(t){var i=void 0===t?{}:t,r=i.collectionIds,o=i.contentFilter,a=i.topicIds,c=s(i,["collectionIds","contentFilter","topicIds"]);return{pathname:e(),query:p(n({},c,{content_filter:o},A(r),T(a))),headers:{"cache-control":"no-cache"}}})),handleResponse:S()}}(),q={handleRequest:y((function(e){var t=function(e){var t=new URL(e),i=t.pathname;return{query:function(e){var t={};return e.forEach((function(e,i){t[i]=e})),t}(t.searchParams),pathname:"/"===i?void 0:i}}(e.downloadLocation),i=t.pathname,r=t.query;if(!a(i))throw new Error("Could not parse pathname from url.");return{pathname:i,query:p(r)}})),handleResponse:S()},U={__proto__:null,list:M,get:L,getStats:_,getRandom:B,trackDownload:q},F="/search",K=function(){var e=function(){return F+"/photos"};return{getPathname:function(t){return e()},handleRequest:y((function(t){var i=t.query,r=t.page,o=t.perPage,a=t.orderBy,c=t.collectionIds,h=t.lang,u=t.contentFilter,d=s(t,["query","page","perPage","orderBy","collectionIds","lang","contentFilter"]);return{pathname:e(),query:p(n({query:i,content_filter:u,lang:h,order_by:a},b({page:r,perPage:o}),A(c),d))}})),handleResponse:S()}}(),H=function(){var e=function(){return F+"/collections"};return{getPathname:function(t){return e()},handleRequest:y((function(t){var i=t.query,r=s(t,["query"]);return{pathname:e(),query:n({query:i},b(r))}})),handleResponse:S()}}(),W=function(){var e=function(){return F+"/users"};return{getPathname:function(t){return e()},handleRequest:y((function(t){var i=t.query,r=s(t,["query"]);return{pathname:e(),query:n({query:i},b(r))}})),handleResponse:S()}}(),j={__proto__:null,getPhotos:K,getCollections:H,getUsers:W},J="/users",V=function(){var e=function(e){var t=e.username;return J+"/"+t};return{getPathname:e,handleRequest:y((function(t){var i=t.username;return{pathname:e({username:i}),query:{}}})),handleResponse:S()}}(),G=function(){var e=function(e){var t=e.username;return J+"/"+t+"/photos"};return{getPathname:e,handleRequest:y((function(t){var i=t.username,r=t.stats,o=t.orientation,a=s(t,["username","stats","orientation"]);return{pathname:e({username:i}),query:p(n({},b(a),{orientation:o,stats:r}))}})),handleResponse:I()}}(),$=function(){var e=function(e){var t=e.username;return J+"/"+t+"/likes"};return{getPathname:e,handleRequest:y((function(t){var i=t.username,r=t.orientation,o=s(t,["username","orientation"]);return{pathname:e({username:i}),query:p(n({},b(o),{orientation:r}))}})),handleResponse:I()}}(),Q=function(){var e=function(e){var t=e.username;return J+"/"+t+"/collections"};return{getPathname:e,handleRequest:y((function(t){var i=t.username,r=s(t,["username"]);return{pathname:e({username:i}),query:b(r)}})),handleResponse:I()}}(),Z={__proto__:null,get:V,getPhotos:G,getLikes:$,getCollections:Q},X="/topics",Y=function(e){var t=e.topicIdOrSlug;return X+"/"+t},ee=C({getPathname:Y,handleRequest:function(e){var t=e.page,i=e.perPage,r=e.orderBy,s=e.topicIdsOrSlugs;return{pathname:X,query:p(n({},b({page:t,perPage:i}),{ids:null==s?void 0:s.join(","),order_by:r}))}},handleResponse:I()}),te=C({getPathname:Y,handleRequest:function(e){var t=e.topicIdOrSlug;return{pathname:Y({topicIdOrSlug:t}),query:{}}},handleResponse:S()}),ie=function(){var e=h(Y,(function(e){return e+"/photos"}));return{getPathname:e,handleRequest:function(t){var i=t.topicIdOrSlug,r=t.orientation,o=s(t,["topicIdOrSlug","orientation"]);return{pathname:e({topicIdOrSlug:i}),query:p(n({},b(o),{orientation:r}))}},handleResponse:I()}}(),re={__proto__:null,collections:N,photos:U,search:j,users:Z,topics:{__proto__:null,list:ee,get:te,getPhotos:ie},trackNonHotLinkedPhotoView:function(e){var t=e.appId;return function(e){var i=e.photoId,r=Array.isArray(i)?i:[i];if(r.length>20)throw new Error("You cannot track more than 20 photos at once. Please try again with fewer photos.");return fetch("views.unsplash.com/v?photo_id="+r.join()+"&app_id="+t)}}};!function(e){e.Afrikaans="af",e.Amharic="am",e.Arabic="ar",e.Azerbaijani="az",e.Belarusian="be",e.Bulgarian="bg",e.Bengali="bn",e.Bosnian="bs",e.Catalan="ca",e.Cebuano="ceb",e.Corsican="co",e.Czech="cs",e.Welsh="cy",e.Danish="da",e.German="de",e.Greek="el",e.English="en",e.Esperanto="eo",e.Spanish="es",e.Estonian="et",e.Basque="eu",e.Persian="fa",e.Finnish="fi",e.French="fr",e.Frisian="fy",e.Irish="ga",e.ScotsGaelic="gd",e.Galician="gl",e.Gujarati="gu",e.Hausa="ha",e.Hawaiian="haw",e.Hindi="hi",e.Hmong="hmn",e.Croatian="hr",e.HaitianCreole="ht",e.Hungarian="hu",e.Armenian="hy",e.Indonesian="id",e.Igbo="ig",e.Icelandic="is",e.Italian="it",e.Hebrew="iw",e.Japanese="ja",e.Javanese="jw",e.Georgian="ka",e.Kazakh="kk",e.Khmer="km",e.Kannada="kn",e.Korean="ko",e.Kurdish="ku",e.Kyrgyz="ky",e.Latin="la",e.Luxembourgish="lb",e.Lao="lo",e.Lithuanian="lt",e.Latvian="lv",e.Malagasy="mg",e.Maori="mi",e.Macedonian="mk",e.Malayalam="ml",e.Mongolian="mn",e.Marathi="mr",e.Malay="ms",e.Maltese="mt",e.Myanmar="my",e.Nepali="ne",e.Dutch="nl",e.Norwegian="no",e.Nyanja="ny",e.Oriya="or",e.Punjabi="pa",e.Polish="pl",e.Pashto="ps",e.Portuguese="pt",e.Romanian="ro",e.Russian="ru",e.Kinyarwanda="rw",e.Sindhi="sd",e.Sinhala="si",e.Slovak="sk",e.Slovenian="sl",e.Samoan="sm",e.Shona="sn",e.Somali="so",e.Albanian="sq",e.Serbian="sr",e.Sesotho="st",e.Sundanese="su",e.Swedish="sv",e.Swahili="sw",e.Tamil="ta",e.Telugu="te",e.Tajik="tg",e.Thai="th",e.Turkmen="tk",e.Filipino="tl",e.Turkish="tr",e.Tatar="tt",e.Uighur="ug",e.Ukrainian="uk",e.Urdu="ur",e.Uzbek="uz",e.Vietnamese="vi",e.Xhosa="xh",e.Yiddish="yi",e.Yoruba="yo",e.ChineseSimplified="zh",e.ChineseTraditional="zh-TW",e.Zulu="zu"}(u||(u={})),function(e){e.LATEST="latest",e.POPULAR="popular",e.VIEWS="views",e.DOWNLOADS="downloads",e.OLDEST="oldest"}(d||(d={}));var ne=h(w,(function(e){return{photos:{get:e(L),list:e(M),getStats:e(_),getRandom:e(B),trackDownload:e(q)},users:{getPhotos:e(G),getCollections:e(Q),getLikes:e($),get:e(V)},search:{getCollections:e(H),getPhotos:e(K),getUsers:e(W)},collections:{getPhotos:e(k),get:e(x),list:e(D),getRelated:e(O)},topics:{list:e(ee),get:e(te),getPhotos:e(ie)}}}))},7429:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return c.default}});var r=d(i(3990)),n=d(i(8237)),s=d(i(5355)),o=d(i(3764)),a=d(i(6314)),c=d(i(8464)),p=d(i(6435)),h=d(i(4008)),u=d(i(8222));function d(e){return e&&e.__esModule?e:{default:e}}},4163:(e,t)=>{"use strict";function i(e){return 14+(e+64>>>9<<4)+1}function r(e,t){const i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function n(e,t,i,n,s,o){return r((a=r(r(t,e),r(n,o)))<<(c=s)|a>>>32-c,i);var a,c}function s(e,t,i,r,s,o,a){return n(t&i|~t&r,e,t,s,o,a)}function o(e,t,i,r,s,o,a){return n(t&r|i&~r,e,t,s,o,a)}function a(e,t,i,r,s,o,a){return n(t^i^r,e,t,s,o,a)}function c(e,t,i,r,s,o,a){return n(i^(t|~r),e,t,s,o,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let i=0;i<t.length;++i)e[i]=t.charCodeAt(i)}return function(e){const t=[],i=32*e.length,r="0123456789abcdef";for(let n=0;n<i;n+=8){const i=e[n>>5]>>>n%32&255,s=parseInt(r.charAt(i>>>4&15)+r.charAt(15&i),16);t.push(s)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[i(t)-1]=t;let n=1732584193,p=-271733879,h=-1732584194,u=271733878;for(let t=0;t<e.length;t+=16){const i=n,d=p,l=h,v=u;n=s(n,p,h,u,e[t],7,-680876936),u=s(u,n,p,h,e[t+1],12,-389564586),h=s(h,u,n,p,e[t+2],17,606105819),p=s(p,h,u,n,e[t+3],22,-1044525330),n=s(n,p,h,u,e[t+4],7,-176418897),u=s(u,n,p,h,e[t+5],12,1200080426),h=s(h,u,n,p,e[t+6],17,-1473231341),p=s(p,h,u,n,e[t+7],22,-45705983),n=s(n,p,h,u,e[t+8],7,1770035416),u=s(u,n,p,h,e[t+9],12,-1958414417),h=s(h,u,n,p,e[t+10],17,-42063),p=s(p,h,u,n,e[t+11],22,-1990404162),n=s(n,p,h,u,e[t+12],7,1804603682),u=s(u,n,p,h,e[t+13],12,-40341101),h=s(h,u,n,p,e[t+14],17,-1502002290),p=s(p,h,u,n,e[t+15],22,1236535329),n=o(n,p,h,u,e[t+1],5,-165796510),u=o(u,n,p,h,e[t+6],9,-1069501632),h=o(h,u,n,p,e[t+11],14,643717713),p=o(p,h,u,n,e[t],20,-373897302),n=o(n,p,h,u,e[t+5],5,-701558691),u=o(u,n,p,h,e[t+10],9,38016083),h=o(h,u,n,p,e[t+15],14,-660478335),p=o(p,h,u,n,e[t+4],20,-405537848),n=o(n,p,h,u,e[t+9],5,568446438),u=o(u,n,p,h,e[t+14],9,-1019803690),h=o(h,u,n,p,e[t+3],14,-187363961),p=o(p,h,u,n,e[t+8],20,1163531501),n=o(n,p,h,u,e[t+13],5,-1444681467),u=o(u,n,p,h,e[t+2],9,-51403784),h=o(h,u,n,p,e[t+7],14,1735328473),p=o(p,h,u,n,e[t+12],20,-1926607734),n=a(n,p,h,u,e[t+5],4,-378558),u=a(u,n,p,h,e[t+8],11,-2022574463),h=a(h,u,n,p,e[t+11],16,1839030562),p=a(p,h,u,n,e[t+14],23,-35309556),n=a(n,p,h,u,e[t+1],4,-1530992060),u=a(u,n,p,h,e[t+4],11,1272893353),h=a(h,u,n,p,e[t+7],16,-155497632),p=a(p,h,u,n,e[t+10],23,-1094730640),n=a(n,p,h,u,e[t+13],4,681279174),u=a(u,n,p,h,e[t],11,-358537222),h=a(h,u,n,p,e[t+3],16,-722521979),p=a(p,h,u,n,e[t+6],23,76029189),n=a(n,p,h,u,e[t+9],4,-640364487),u=a(u,n,p,h,e[t+12],11,-421815835),h=a(h,u,n,p,e[t+15],16,530742520),p=a(p,h,u,n,e[t+2],23,-995338651),n=c(n,p,h,u,e[t],6,-198630844),u=c(u,n,p,h,e[t+7],10,1126891415),h=c(h,u,n,p,e[t+14],15,-1416354905),p=c(p,h,u,n,e[t+5],21,-57434055),n=c(n,p,h,u,e[t+12],6,1700485571),u=c(u,n,p,h,e[t+3],10,-1894986606),h=c(h,u,n,p,e[t+10],15,-1051523),p=c(p,h,u,n,e[t+1],21,-2054922799),n=c(n,p,h,u,e[t+8],6,1873313359),u=c(u,n,p,h,e[t+15],10,-30611744),h=c(h,u,n,p,e[t+6],15,-1560198380),p=c(p,h,u,n,e[t+13],21,1309151649),n=c(n,p,h,u,e[t+4],6,-145523070),u=c(u,n,p,h,e[t+11],10,-1120210379),h=c(h,u,n,p,e[t+2],15,718787259),p=c(p,h,u,n,e[t+9],21,-343485551),n=r(n,i),p=r(p,d),h=r(h,l),u=r(u,v)}return[n,p,h,u]}(function(e){if(0===e.length)return[];const t=8*e.length,r=new Uint32Array(i(t));for(let i=0;i<t;i+=8)r[i>>5]|=(255&e[i/8])<<i%32;return r}(e),8*e.length))}},4790:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};t.default=i},6314:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default="00000000-0000-0000-0000-000000000000"},8222:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,n=(r=i(6435))&&r.__esModule?r:{default:r};t.default=function(e){if(!(0,n.default)(e))throw TypeError("Invalid UUID");let t;const i=new Uint8Array(16);return i[0]=(t=parseInt(e.slice(0,8),16))>>>24,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=255&t,i[4]=(t=parseInt(e.slice(9,13),16))>>>8,i[5]=255&t,i[6]=(t=parseInt(e.slice(14,18),16))>>>8,i[7]=255&t,i[8]=(t=parseInt(e.slice(19,23),16))>>>8,i[9]=255&t,i[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,i[11]=t/4294967296&255,i[12]=t>>>24&255,i[13]=t>>>16&255,i[14]=t>>>8&255,i[15]=255&t,i}},58:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},3319:(e,t)=>{"use strict";let i;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!i&&(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!i))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(r)};const r=new Uint8Array(16)},3757:(e,t)=>{"use strict";function i(e,t,i,r){switch(e){case 0:return t&i^~t&r;case 1:case 3:return t^i^r;case 2:return t&i^t&r^i&r}}function r(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){const t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let i=0;i<t.length;++i)e.push(t.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const s=e.length/4+2,o=Math.ceil(s/16),a=new Array(o);for(let t=0;t<o;++t){const i=new Uint32Array(16);for(let r=0;r<16;++r)i[r]=e[64*t+4*r]<<24|e[64*t+4*r+1]<<16|e[64*t+4*r+2]<<8|e[64*t+4*r+3];a[t]=i}a[o-1][14]=8*(e.length-1)/Math.pow(2,32),a[o-1][14]=Math.floor(a[o-1][14]),a[o-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<o;++e){const s=new Uint32Array(80);for(let t=0;t<16;++t)s[t]=a[e][t];for(let e=16;e<80;++e)s[e]=r(s[e-3]^s[e-8]^s[e-14]^s[e-16],1);let o=n[0],c=n[1],p=n[2],h=n[3],u=n[4];for(let e=0;e<80;++e){const n=Math.floor(e/20),a=r(o,5)+i(n,c,p,h)+u+t[n]+s[e]>>>0;u=h,h=p,p=r(c,30)>>>0,c=o,o=a}n[0]=n[0]+o>>>0,n[1]=n[1]+c>>>0,n[2]=n[2]+p>>>0,n[3]=n[3]+h>>>0,n[4]=n[4]+u>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}},4008:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.unsafeStringify=o;var r,n=(r=i(6435))&&r.__esModule?r:{default:r};const s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));function o(e,t=0){return(s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]).toLowerCase()}t.default=function(e,t=0){const i=o(e,t);if(!(0,n.default)(i))throw TypeError("Stringified UUID is invalid");return i}},3990:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,n=(r=i(3319))&&r.__esModule?r:{default:r},s=i(4008);let o,a,c=0,p=0;t.default=function(e,t,i){let r=t&&i||0;const h=t||new Array(16);let u=(e=e||{}).node||o,d=void 0!==e.clockseq?e.clockseq:a;if(null==u||null==d){const t=e.random||(e.rng||n.default)();null==u&&(u=o=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==d&&(d=a=16383&(t[6]<<8|t[7]))}let l=void 0!==e.msecs?e.msecs:Date.now(),v=void 0!==e.nsecs?e.nsecs:p+1;const g=l-c+(v-p)/1e4;if(g<0&&void 0===e.clockseq&&(d=d+1&16383),(g<0||l>c)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=l,p=v,a=d,l+=122192928e5;const f=(1e4*(268435455&l)+v)%4294967296;h[r++]=f>>>24&255,h[r++]=f>>>16&255,h[r++]=f>>>8&255,h[r++]=255&f;const m=l/4294967296*1e4&268435455;h[r++]=m>>>8&255,h[r++]=255&m,h[r++]=m>>>24&15|16,h[r++]=m>>>16&255,h[r++]=d>>>8|128,h[r++]=255&d;for(let e=0;e<6;++e)h[r+e]=u[e];return t||(0,s.unsafeStringify)(h)}},8237:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(i(7925)),n=s(i(4163));function s(e){return e&&e.__esModule?e:{default:e}}var o=(0,r.default)("v3",48,n.default);t.default=o},7925:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0,t.default=function(e,t,i){function r(e,r,o,a){var c;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}(e)),"string"==typeof r&&(r=(0,s.default)(r)),16!==(null===(c=r)||void 0===c?void 0:c.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let p=new Uint8Array(16+e.length);if(p.set(r),p.set(e,r.length),p=i(p),p[6]=15&p[6]|t,p[8]=63&p[8]|128,o){a=a||0;for(let e=0;e<16;++e)o[a+e]=p[e];return o}return(0,n.unsafeStringify)(p)}try{r.name=e}catch(e){}return r.DNS=o,r.URL=a,r};var r,n=i(4008),s=(r=i(8222))&&r.__esModule?r:{default:r};const o="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=o;const a="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=a},5355:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(i(4790)),n=o(i(3319)),s=i(4008);function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t,i){if(r.default.randomUUID&&!t&&!e)return r.default.randomUUID();const o=(e=e||{}).random||(e.rng||n.default)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=o[e];return t}return(0,s.unsafeStringify)(o)}},3764:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(i(7925)),n=s(i(3757));function s(e){return e&&e.__esModule?e:{default:e}}var o=(0,r.default)("v5",80,n.default);t.default=o},6435:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,n=(r=i(58))&&r.__esModule?r:{default:r};t.default=function(e){return"string"==typeof e&&n.default.test(e)}},8464:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,n=(r=i(6435))&&r.__esModule?r:{default:r};t.default=function(e){if(!(0,n.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},3150:function(e,t){var i,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(void 0===globalThis.browser||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const t="The message port closed before a response was received.",i=e=>{const i={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(i).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class r extends WeakMap{constructor(e,t=undefined){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const n=(t,i)=>(...r)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):i.singleCallbackArg||r.length<=1&&!1!==i.singleCallbackArg?t.resolve(r[0]):t.resolve(r)},s=e=>1==e?"argument":"arguments",o=(e,t,i)=>new Proxy(t,{apply:(t,r,n)=>i.call(r,e,...n)});let a=Function.call.bind(Object.prototype.hasOwnProperty);const c=(e,t={},i={})=>{let r=Object.create(null),p={has:(t,i)=>i in e||i in r,get(p,h,u){if(h in r)return r[h];if(!(h in e))return;let d=e[h];if("function"==typeof d)if("function"==typeof t[h])d=o(e,e[h],t[h]);else if(a(i,h)){let t=((e,t)=>function(i,...r){if(r.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${s(t.minArgs)} for ${e}(), got ${r.length}`);if(r.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${s(t.maxArgs)} for ${e}(), got ${r.length}`);return new Promise(((s,o)=>{if(t.fallbackToNoCallback)try{i[e](...r,n({resolve:s,reject:o},t))}catch(n){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,n),i[e](...r),t.fallbackToNoCallback=!1,t.noCallback=!0,s()}else t.noCallback?(i[e](...r),s()):i[e](...r,n({resolve:s,reject:o},t))}))})(h,i[h]);d=o(e,e[h],t)}else d=d.bind(e);else if("object"==typeof d&&null!==d&&(a(t,h)||a(i,h)))d=c(d,t[h],i[h]);else{if(!a(i,"*"))return Object.defineProperty(r,h,{configurable:!0,enumerable:!0,get:()=>e[h],set(t){e[h]=t}}),d;d=c(d,t[h],i["*"])}return r[h]=d,d},set:(t,i,n,s)=>(i in r?r[i]=n:e[i]=n,!0),defineProperty:(e,t,i)=>Reflect.defineProperty(r,t,i),deleteProperty:(e,t)=>Reflect.deleteProperty(r,t)},h=Object.create(e);return new Proxy(h,p)},p=e=>({addListener(t,i,...r){t.addListener(e.get(i),...r)},hasListener:(t,i)=>t.hasListener(e.get(i)),removeListener(t,i){t.removeListener(e.get(i))}}),h=new r((e=>"function"!=typeof e?e:function(t){const i=c(t,{},{getContent:{minArgs:0,maxArgs:0}});e(i)})),u=new r((e=>"function"!=typeof e?e:function(t,i,r){let n,s,o=!1,a=new Promise((e=>{n=function(t){o=!0,e(t)}}));try{s=e(t,i,n)}catch(e){s=Promise.reject(e)}const c=!0!==s&&((p=s)&&"object"==typeof p&&"function"==typeof p.then);var p;if(!0!==s&&!c&&!o)return!1;return(c?s:a).then((e=>{r(e)}),(e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",r({__mozWebExtensionPolyfillReject__:!0,message:t})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)})),!0})),d=({reject:i,resolve:r},n)=>{e.runtime.lastError?e.runtime.lastError.message===t?r():i(new Error(e.runtime.lastError.message)):n&&n.__mozWebExtensionPolyfillReject__?i(new Error(n.message)):r(n)},l=(e,t,i,...r)=>{if(r.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${s(t.minArgs)} for ${e}(), got ${r.length}`);if(r.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${s(t.maxArgs)} for ${e}(), got ${r.length}`);return new Promise(((e,t)=>{const n=d.bind(null,{resolve:e,reject:t});r.push(n),i.sendMessage(...r)}))},v={devtools:{network:{onRequestFinished:p(h)}},runtime:{onMessage:p(u),onMessageExternal:p(u),sendMessage:l.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:l.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},g={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return i.privacy={network:{"*":g},services:{"*":g},websites:{"*":g}},c(e,v,i)};e.exports=i(chrome)}else e.exports=globalThis.browser},void 0===(r=i.apply(t,[e]))||(e.exports=r)},3108:()=>{},3034:()=>{},2505:()=>{},146:()=>{},173:()=>{},1137:()=>{},592:()=>{}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i(4985)})();